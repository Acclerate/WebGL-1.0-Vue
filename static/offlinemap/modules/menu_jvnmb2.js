/**/ï»¿_jsload&&_jsload('menu', 'e9.extend(hG.prototype,{initialize:function(e,kD){if(this._container){return false}this._map=e;var kF=this._overlay=kD===true?false:(kD||null);this._render();var kJ=this;this._container.style.cursor=e.config.defaultCursor;if(kF&&kF._config.clickable){this._container.style.cursor="pointer"}e9.on(document,"mousedown",function(i){if(!kJ._container){return}kJ.hide()});e9.on(this._container,"mousemove",al);e9.on(this._container,"click",function(i){kJ.hide();al(i)});var kI=this._opts.container;if(!kI&&!kF&&kF!==false){kI=this._map.container;e.addEventListener("onspotmouseover",function(i){kJ.spots=i.spots});var T;e.addEventListener("onspotmouseout",function(i){T=i.spots;delete kJ.spots});e.addEventListener("onspotclick",function(i){kJ.spots=i.spots});e.addEventListener("rightclickex",function(kP){if(this.getMapType()===BMAP_EARTH_MAP){return}if(!kJ._container||kP.infoWindow||!kJ._enable){return}if(e.currentOperation!==ep.idle){return}if(!kJ.spots&&T&&T.length>0){var kR=kP.pixel;var kQ=T[0];var kO=kQ.pt;var i=this.pointToPixelIn(kO);var kN=kQ.bd;if(kR.x-i.x<kN[2]&&kR.x-i.x>kN[0]&&i.y-kR.y<kN[3]&&i.y-kR.y>kN[1]){kJ.spots=T}}kJ._showMenu(kP,kI);delete kJ.spots});e.addEventListener("forcedown",function(kP){if(this.getMapType()===BMAP_EARTH_MAP){return}if(!kJ._container||kP.infoWindow||!kJ._enable){return}if(!kJ.spots&&T&&T.length>0){var kR=kP.pixel;var kQ=T[0];var kO=kQ.pt;var i=this.pointToPixelIn(kO);var kN=kQ.bd;if(kR.x-i.x<kN[2]&&kR.x-i.x>kN[0]&&i.y-kR.y<kN[3]&&i.y-kR.y>kN[1]){kJ.spots=T}}kJ._showMenu(kP,kI);delete kJ.spots})}else{if(this._overlay){kI=this._map.container;this._overlay.addEventListener("rightclick",function(i){if(!kJ._container){return}kJ.showOverlayMenu(i,kJ._overlay)})}else{if(this._overlay!==false){e9.on(kI,"contextmenu",function(kN){if(e.getMapType()===BMAP_EARTH_MAP){return}if(e.currentOperation!==ep.idle){return}if(!kJ._container||!kJ._enable){return}kN=window.event||kN;var i=kN.target||kN.srcElement;while(i&&!e9.hc(i,"pop")){i=i.parentNode}if(i&&e9.hc(i,"pop")){kJ.hide();return}kJ._showMenu(kN,kI,true);return d(kN)})}}}var kL=[];for(var kG=this._items.length-1;kG>=0;kG--){var kM=this._items[kG];if(kM._insertIndex!==-1){kL=kL.concat(this._items.splice(kG,1))}}for(var kG=0,kC=this._items.length;kG<kC;kG++){var kM=this._items[kG];if(kM._type==="menuitem"){kM.initialize(e,this)}if(kM._type==="divider"){this._dividers[kM._dIndex].dom=bS(this._container,"<div class=\'BMap_cmDivider\'></div>")}}for(var kG=kL.length-1;kG>=0;kG--){var kM=kL[kG];if(kM._type==="menuitem"){kM.initialize(e,this)}if(kM._type==="divider"){for(var kE=0,kK=this._items.length;kE<kK;kE++){if(kE===kM._insertIndex){var kH=this._items[kE]._container||this._dividers[this._items[kE]._dIndex].dom;this._dividers[kM._dIndex].dom=f1(kH,"<div class=\'BMap_cmDivider\'></div>");break}}}}for(var kG=kL.length-1;kG>=0;kG--){var kM=kL[kG];this._items.splice(kM._insertIndex,0,kM)}this._updateShadowSize()},_draw:function(){if(this._map){this.initialize(this._map,this._overlay);if(this._isOpen){this._isOpen=false;this.show()}}},remove:function(){if(this._container&&this._container.parentNode){this._container.parentNode.removeChild(this._container);this._container=null}this._map=null},_render:function(){this._container=bS(this._map.container,"<div unselectable=\'on\'></div>");this._container.className="BMap_contextMenu";this._container.style.fontSize="12px";return this._container},addItem:function(kD,e){if(!kD||kD._type!="menuitem"||kD._text==""||kD._width<=0){return}for(var kC=0,T=this._items.length;kC<T;kC++){if(this._items[kC]===kD){return}}if(e===undefined||e>this._items.length-1){e=-1}kD._insertIndex=e;kD.initialize(this._map,this);if(e===-1){this._items.push(kD);this._rItems.push(kD)}else{this._items.splice(e,0,kD);this._rItems.splice(e,0,kD)}e9.ac(kD.getDom(),"BMap_cmLstItem");if(this._items.length>1){this._items[this._items.length-2]._type=="menuitem"&&e9.rc(this._items[this._items.length-2].getDom(),"BMap_cmLstItem")}else{this._items[0]._type=="menuitem"&&e9.ac(this._items[0].getDom(),"BMap_cmFstItem")}this._updateShadowSize()},removeItem:function(kC){if(!kC||kC._type!="menuitem"){return}for(var T=0,e=this._items.length;T<e;T++){if(this._items[T]===kC){this._items[T].remove();this._items.splice(T,1);delete kC._insertIndex;e--}}for(var T=0,e=this._rItems.length;T<e;T++){if(this._rItems[T]===kC){this._rItems[T].remove();this._rItems.splice(T,1);delete kC._insertIndex;e--}}if(!this._container){return}if(this._items.length>0){this._items[this._items.length-1]._type=="menuitem"&&e9.ac(this._items[this._items.length-1].getDom(),"BMap_cmLstItem")}this._updateShadowSize()},addSeparator:function(e){if(e===undefined||e>this._items.length-1){e=-1}var kG={_type:"divider",_dIndex:this._dividers.length,_insertIndex:e};this._dividers.push({dom:null});if(!this._container){return}var kF="<div class=\'BMap_cmDivider\'></div>";if(e===-1){this._dividers[this._dividers.length-1].dom=bS(this._container,kF)}else{var kD=this._items;for(var kE=0,kC=kD.length;kE<kC;kE++){if(kE===e){var T=kD[kE]._container||this._dividers[kD[kE]._dIndex].dom;this._dividers[this._dividers.length-1].dom=f1(T,kF);break}}}if(e===-1){this._items.push(kG)}else{this._items.splice(e,0,kG)}this._updateShadowSize()},removeSeparator:function(T){if(!this._dividers[T]){return}if(this._dividers[T].dom&&this._dividers[T].dom.parentNode){this._dividers[T].dom.parentNode.removeChild(this._dividers[T].dom)}for(var kC=0,e=this._items.length;kC<e;kC++){if(this._items[kC]&&this._items[kC]._type=="divider"&&this._items[kC]._dIndex==T){this._items.splice(kC,1);e--}if(this._items[kC]&&this._items[kC]._type=="divider"&&this._items[kC]._dIndex>T){this._items[kC]._dIndex--}}this._dividers.splice(T,1);this._updateShadowSize()},setPosition:function(e,i){this._left=e;this._top=i;this._container.style.left=e+"px";this._container.style.top=i+"px"},show:function(){if(this._isOpen==true){return}if(this._rItems.length==0){return}this._isOpen=true;if(this._container){this._container.style.visibility="visible"}var e=new fW("onopen");e.point=this.curPoint;e.pixel=this.curPixel;this.dispatchEvent(e)},hide:function(){if(this._isOpen==false){return}this._isOpen=false;if(this._container){this._container.style.visibility="hidden"}var e=new fW("onclose");e.point=this.curPoint;e.pixel=this.curPixel;this.dispatchEvent(e)},setCursor:function(e){if(!e){return}this._opts.cursor=e;if(this._container){this._container.style.cursor=this._opts.cursor}},_updateShadowSize:function(){if(this._container){this._container.offsetWidth+"px";this._container.offsetHeight+"px"}},_showMenu:function(kE,kH,kG){if(this._rItems.length==0){return}if(!this._opts.marker&&kE.overlay&&kE.overlay instanceof ke){return}var kI=this;var kK=kE.layerX||kE.offsetX;var kJ=kE.layerY||kE.offsetY;var kM=kE.target||kE.srcElement;if(kG){var kF=kM;if(kH==kI._map.container&&kF!==kI._map.maskLayer&&kF.nodeName.toLowerCase()!="svg"){while(kF&&!e9.hc(kF,"shadow")){kF=kF.parentNode}if(!e9.hc(kF,"shadow")||kF.getAttribute("type")!="infowindow_shadow"){kI.hide();return}}while(kM&&kM!=kI._map.container){if(!(kM.clientWidth==0&&kM.clientHeight==0&&kM.offsetParent&&kM.offsetParent.nodeName.toLowerCase()=="td")){if(kM.nodeName.toLowerCase()=="svg"){kK+=parseInt(kM.getAttribute("viewBox").split(" ")[0])||0;kJ+=parseInt(kM.getAttribute("viewBox").split(" ")[1])||0}else{kK+=kM.offsetLeft;kJ+=kM.offsetTop}}kM=kM.offsetParent||kM.parentNode}kI.curPixel=new fv(kK,kJ)}else{kI.curPixel=kE.pixel}if(this.spots&&this.spots.length>0){var kD=this.spots[0];var kN=kD.userdata.iconPoint;kI.curPoint=kN;kI.curPixel=kI._map.pointToPixelIn(kN)}else{if(kE.overlay&&kE.overlay instanceof ke){kI.curPoint=kE.overlay.getPoint();kI.curPixel=kI._map.pointToPixelIn(kI.curPoint)}else{kI.curPoint=kI._map.pixelToPointIn(kI.curPixel)}}if(kI.curPoint.lng<ev[kI._map.mapType].bounds[0]||kI.curPoint.lng>ev[kI._map.mapType].bounds[2]||kI.curPoint.lat<ev[kI._map.mapType].bounds[1]||kI.curPoint.lat>ev[kI._map.mapType].bounds[3]){return}var kC=kI.getDom().offsetHeight;var kL=kI.getDom().offsetWidth;var T=kE.offsetX;var i=kE.offsetY;if(kG){T=kK;i=kJ}if(kE.offsetX+kL>this._map.width){T-=kL}if(kE.offsetY+kC>this._map.height){i-=kC}kI.setPosition(T,i);kI.show()},showOverlayMenu:function(kG,T,kH){if(this._rItems.length==0||!this._map){return}var kD=this;if(T){kD.tempOverlay=T}kD.curPixel=kG.pixel;if(T instanceof u){kD.curPixel=kD._map.pointToPixel(T.getPosition());kG.pixel=kD.curPixel;if(kH){kH.x&&(kG.pixel.x+=kH.x);kH.y&&(kG.pixel.y+=kH.y)}}kD.curPoint=kD._map.pixelToPointIn(kD.curPixel);var kC=kD.getDom().offsetHeight;var i=kD.getDom().offsetWidth;var kF=kG.pixel.x;var kE=kG.pixel.y;if(kG.pixel.x+i>this._map.width){kF=kG.pixel.x-i}if(kG.pixel.y+kC>this._map.height){kE=kG.pixel.y-kC}kD.setPosition(kF,kE);kD.show()}});e9.extend(ii.prototype,{initialize:function(e,i){if(this._container){return false}this._map=e;this._contextmenu=i;if(i.getDom()){this._render();this._bind();if(!this._enabled){this._enabled=true;this.disable()}}return true},remove:function(){var e=this;if(this._container&&this._container.parentNode){this._container.parentNode.removeChild(this._container);this._container=null}this._contextmenu=null;this._map=null},_draw:function(){if(this._contextmenu&&this._map){this.initialize(this._map,this._contextmenu)}},_render:function(){var kE="<div"+(this._opts.id?" id=\'"+this._opts.id+"\'":"")+" unselectable=\'on\'><span>"+this._text+"</span></div>";var kI=this._insertIndex;var kD=this._contextmenu.getDom();var kF=this._contextmenu._items;var T=this._contextmenu._dividers;if(kI===-1){this._container=bS(kD,kE)}else{for(var kC=0,e=kF.length;kC<e;kC++){if(kC===kI){var kG=kF[kC]._container||T[kF[kC]._dIndex].dom;this._container=f1(kG,kE);break}}}kD.style.borderRadius="4px";var kH=this._container.style;kH.padding="8px 8px";kH.MozUserSelect="none";kH.lineHeight="22px";kH.width=this._opts.width+"px";if(this._enabled){kH.color="#656565";kH.cursor="pointer"}else{kH.color="#aaa";kH.cursor=this._map.config.defaultCursor}return this._container},_bind:function(){var e=this;e9.on(this._container,"click",function(i){if(!e._enabled){al(i);return}if(e._callback&&e._callback.call){var T=jy.convertMC2LL(e._contextmenu.curPoint);e._callback.call(e,T,e._contextmenu.curPixel,e._contextmenu._overlay||e._contextmenu.tempOverlay)}});e9.on(this._container,"mousedown",function(i){al(i)});e9.on(this._container,"mouseover",function(){if(!e._enabled){return}e._container.style.color="#3385ff";e._container.style.backgroundColor="#F0F8FF"});e9.on(this._container,"mouseout",function(){if(!e._enabled){return}e._container.style.color="#656565";e._container.style.backgroundColor="#fff"})},setText:function(e){if(!e){return}this._text=e+"";if(this._container){this._container.innerHTML="<span>"+this._text+"</span>"}},enable:function(){this._enabled=true;if(this._container){this._container.style.color="#656565";this._container.style.cursor="pointer"}},disable:function(){this._enabled=false;if(this._container){this._container.style.color="#aaa";this._container.style.cursor=this._map.config.defaultCursor}}});');
