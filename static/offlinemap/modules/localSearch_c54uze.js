/**/﻿_jsload&&_jsload('localSearch', 'function eT(e,kD,i){dh.call(this);if(!e){return}this.container=(typeof(e)=="object")?e:e9.G(e);this.page=1;this.pageCount=100;this.argName="pg";this.pagecap=4;this.callback=kD;this.update=true;var T={page:1,totalCount:100,pageCount:100,pagecap:4,argName:"pg",update:true};if(!i){i=T}for(var kC in i){if(typeof(i[kC])!="undefined"){this[kC]=i[kC]}}this.render()}e9.extend(eT.prototype,{render:function(){this.initialize()},initialize:function(){this.checkPages();this.container.innerHTML=this.createHtml()},checkPages:function(){if(isNaN(parseInt(this.page))){this.page=1}if(isNaN(parseInt(this.pageCount))){this.pageCount=1}if(this.page<1){this.page=1}if(this.pageCount<1){this.pageCount=1}if(this.page>this.pageCount){this.page=this.pageCount}this.page=parseInt(this.page);this.pageCount=parseInt(this.pageCount)},getPage:function(){var i=location.search;var T=new RegExp("[?&]?"+this.argName+"=([^&]*)[&$]?","gi");var e=i.match(T);this.page=RegExp.$1},createHtml:function(){var kI=[];var kC=this.page-1;var kF=this.page+1;kI.push(\'<p style="margin:0;padding:0;white-space:nowrap">\');if(kC<1){}else{if(this.page>=this.pagecap){var T=\'<span style="margin-right:3px"><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp1}">首页</a></span>\';kI.push(T.replace("{temp1}","BMapGL.I(\'"+this.hashCode+"\').toPage(1);"))}var T=\'<span style="margin-right:3px"><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp2}">上一页</a></span>\';kI.push(T.replace("{temp2}","BMapGL.I(\'"+this.hashCode+"\').toPage("+kC+");"))}if(this.page<this.pagecap){if(this.page%this.pagecap==0){var kD=this.page-this.pagecap-1}else{var kD=this.page-this.page%this.pagecap+1}var kG=kD+this.pagecap-1}else{var kH=Math.floor(this.pagecap/2);var kE=this.pagecap%2-1;if(this.pageCount>this.page+kH){var kG=this.page+kH;var kD=this.page-kH-kE}else{var kG=this.pageCount;var kD=this.page-kH-kE}}if(this.page>this.pageCount-this.pagecap&&this.page>=this.pagecap){var kD=this.pageCount-this.pagecap+1;var kG=this.pageCount}for(var e=kD;e<=kG;e++){if(e>0){if(e==this.page){kI.push(\'<span style="margin-right:3px">\'+e+"</span>")}else{if(e>=1&&e<=this.pageCount){var T=\'<span><a style="color:#7777cc;margin-right:3px" href="javascript:void(0)" onclick="{temp3}">[\'+e+"]</a></span>";kI.push(T.replace("{temp3}","BMapGL.I(\'"+this.hashCode+"\').toPage("+e+");"))}}}}if(kF>this.pageCount){}else{var T=\'<span><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp4}">下一页</a></span>\';kI.push(T.replace("{temp4}","BMapGL.I(\'"+this.hashCode+"\').toPage("+kF+");"))}kI.push("</p>");return kI.join("")},toPage:function(i){var e=i?i:1;if(typeof(this.callback)=="function"){this.callback(e);this.page=e}if(this.update){this.render()}}});cJ.isReqDataMap=function(i,e){if(!i||typeof e=="undefined"){return false}if(i==L&&e!=iD&&e!=gd&&e!=fB&&e!=iZ&&e!=aF){return false}if(i==c0&&e!=ch){return false}if(i==dy&&e!=bd){return false}if(i==f2&&e!=bl){return false}if(i==ew&&e!=aA){return false}if(i==be&&e!=j2){return false}return true};e9.extend(cJ.prototype,{_check:function(){for(var T=0,e=this._queryList.length;T<e;T++){var kC=this._queryList[T];this[kC.method].apply(this,kC.arguments)}delete this._queryList;this.initialize()},initialize:function(){var e=this;this.renderMap=new cS(e);this.renderList=new ae(e)},search:function(e,i){if(!e||(e instanceof Array&&(e.length<1||e.length>10))){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(aK.CBK_SEARCH_COMPLETE);return}i=i||{};if(i.customData){this._createCustomSearchInstance();this.customSearch.search({keyword:e,searchType:"local",customData:i.customData});this._useCustomdata=true;return}else{this._useCustomdata=false}var kC=arguments[2]||{};var T=this;this._getIdByLoc(this._loc,function(kH){kH=kH||1;T._isMultiKey=T._isKeywordArray(e);var kG;if(!T._isMultiKey){kG={qt:i.forceLocal?dG:L,c:kH,wd:e,rn:T.getPageCapacity()}}else{var kF=e.join("$$");var kD=e.length;kG={qt:ew,c:kH,wd:kF,wdn:kD,rn:T.getPageCapacity()}}if(T._opts.reqFrom){e9.extend(kG,{from:T._opts.reqFrom})}e9.extend(kG,kC.params);if(i.log){kG.log="center"}var kE={params:kG,options:i,userKw:kC.userKw||e};e9.extend(kE,kC);kl.request(function(kJ,kI){T._rawDataCbk(kJ,kI)},kG,kE)})},_isKeywordArray:function(e){if(e&&e instanceof Array){return true}else{return false}},searchInBounds:function(i,kE,T){if(!i||!kE||(i instanceof Array&&(i.length<1||i.length>10))){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(aK.CBK_SEARCH_COMPLETE);return}kE=new ik(gb(kE.getSouthWest(),BMapGL.coordType),gb(kE.getNorthEast(),BMapGL.coordType));var T=T||{};var e=T.limit&&true;var kD=this;if(T.customData){this._createCustomSearchInstance();this.customSearch.search({keyword:i,bounds:kE,searchType:"bound",customData:T.customData});this._useCustomdata=true;return}else{this._useCustomdata=false}var kC=arguments[2]||{};this._getIdByLoc(this._loc,function(kM){kM=kM||1;var kL=kE.getSouthWest();var kK=kE.getNorthEast();kL=jy.convertLL2MC(kL);kK=jy.convertLL2MC(kK);var kG="("+kL.lng+","+kL.lat+";"+kK.lng+","+kK.lat+")";kD._isMultiKey=kD._isKeywordArray(i);var kJ;if(!kD._isMultiKey){kJ={qt:dy,c:kM,wd:i,ar:kG,rn:kD._opts.pageCapacity,l:18,limit:e}}else{var kI=i.join("$$");var kF=i.length;kJ={qt:f2,c:kM,wd:kI,wdn:kF,ar:kG,rn:kD.getPageCapacity(),l:18,limit:e}}if(kD._opts.reqFrom){e9.extend(kJ,{from:kD._opts.reqFrom})}e9.extend(kJ,kC.params);var kH;if(kC&&kC.center&&kC.radius){kH={params:kJ,bounds:kE,center:kC.center,radius:kC.radius,userKw:kC.userKw||i}}else{kH={params:kJ,bounds:kE,userKw:kC.userKw||i}}kl.request(function(kO,kN){kD._rawDataCbk(kO,kN)},kJ,kH)})},searchNearby:function(kD,i,e,kE){if(!kD||!i||(!(i instanceof cG||i instanceof cA)&&typeof i=="object"&&!i.uid)||(kD instanceof Array&&(kD.length<1||kD.length>10))){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(aK.CBK_SEARCH_COMPLETE);return}i=gb(i,BMapGL.coordType);var kE=kE||{};var kC=kE.limit&&true;if(kE.customData){this._createCustomSearchInstance();this.customSearch.search({keyword:kD,center:i,radius:e,searchType:"nearby",customData:kE.customData});this._useCustomdata=true;return}else{this._useCustomdata=false}e=e||cJ.DEFAULT_RADIUS;e=e<0?cJ.DEFAULT_RADIUS:(e>cJ.MAX_RADIUS?cJ.MAX_RADIUS:e);var kG=this;var kF=arguments[3]||{};var T={};if(i instanceof cG||i instanceof cA){T=jy.convertLL2MC(i);kF.center=i;kF.radius=e;kF.limit=kC}this._getIdByLoc(this._loc,function(kL){kL=kL||1;kG._isMultiKey=kG._isKeywordArray(kD);var kJ;if(!kG._isMultiKey){kJ={qt:c0,c:kL,wd:kD,rn:kG.getPageCapacity(),uid:i.uid||"",r:e,limit:kC||"",nb_x:T.lng,nb_y:T.lat,}}else{kJ={qt:be,c:kL,wd:kD.join("$$"),wdn:kD.length,rn:kG.getPageCapacity(),uid:i.uid||"",r:e,limit:kC||"",nb_x:T.lng,nb_y:T.lat,}}if(typeof i==="string"){if(!kG._isMultiKey){kJ.qt=L;kJ.wd=i+" "+kD;kJ.limit=kC}else{kJ.qt=ew;var kH=[];for(var kI=0;kI<kD.length;kI++){var kK=i+" "+kD[kI];kH.push(kK)}kJ.wd=kH.join("$$");kJ.wdn=kH.length;kJ.limit=kC}delete kJ.r;delete kJ.uid}if(kG._opts.reqFrom){e9.extend(kJ,{from:kG._opts.reqFrom})}e9.extend(kJ,kF.params);kl.request(function(kN,kM){kG._rawDataCbk(kN,kM)},kJ,{params:kJ,center:i,radius:e,userKw:kF.userKw||kD})})},_rawDataCbk:function(kN,kD){var kM=this;if(kN.result["type"]==bl||kN.result["type"]==aA||kN.result["type"]==j2){kM._isMultiKey=true}else{kM._isMultiKey=false}this.clearResults();kM._json=kN;this._ud=kD;var T=kN.result;var kK=kD.params.qt;if(!kM._isMultiKey){if(T.error!=0||!cJ.isReqDataMap(kK,T.type)){var kF=kN.current_city;this._results=new iI({keyword:kD.userKw,city:kF.name,province:kF.up_province_name||"",ccode:kF.code,pc:kM.getPageCapacity(),center:kD.center,radius:kD.radius,bounds:((kD.center&&kD.radius)?undefined:kD.bounds),moreUrl:this._getMoreUrl(kD,kF)});this._results._qt=kD.params.qt;this._setStatus(BMAP_STATUS_UNKNOWN_LOCATION);this._triggerCbk(aK.CBK_SEARCH_COMPLETE,this._results);kM.renderList.dispatchEvent(new fW("onrender"));return}}else{if(T.error!=0||!cJ.isReqDataMap(kK,T.type)){var kF=kN.current_city;this._arrResults=[];var kC=kD.userKw;for(var kJ=0,kG=kC.length;kJ<kG;kJ++){var kI=new iI({keyword:kC[kJ],city:kF.name,province:kF.up_province_name||"",ccode:kF.code,pc:kM.getPageCapacity(),center:kD.center,radius:kD.radius,bounds:((kD.center&&kD.radius)?undefined:kD.bounds),moreUrl:""});kI._qt=kD.params.qt;this._arrResults.push(kI)}this._setStatus(BMAP_STATUS_UNKNOWN_LOCATION);this._triggerCbk(aK.CBK_SEARCH_COMPLETE,this._arrResults);kM.renderList.dispatchEvent(new fW("onrender"));return}}kM._processRaw(kD);kM.renderMap.dispatchEvent(new fW("onrender"));kM.renderList.dispatchEvent(new fW("onrender"));var e=this._ud.center;if(e&&typeof e!="string"&&!(e instanceof cG||e instanceof cA)){this.renderMap.addCenterPoi(e)}var kL=this._json.result&&this._json.result.type;var kE={};switch(kL){case iD:case ch:case bd:case bl:case aA:case j2:kE.points=this._arrPoints;break;case fB:kE.center=this._results.getPoiIn(0)["point"];kE.level=this._json.content["level"];break;case aF:kE.center=this._results.getPoiIn(0)["point"];kE.level=13;break;case iZ:kE.center=this._results.getPoiIn(0)["point"];kE.level=parseInt(this._json.content[1]);break;default:break}this.renderMap.getBestViewport(kE);var kH;if(!this._isMultiKey){kH=this._results}else{kH=this._getMaxResults()}if(this._opts.renderOptions.selectFirstResult&&kH&&kH.getNumPois()>0){var kM=this;setTimeout(function(){kM.select(0)},240)}},_processRaw:function(kG){var k0=this._json.result,lb=this._json.content,kW=this._json.current_city,lc=k0.type,kK=this,kH=k0.page_num||0,kT=0,k1=0,kN=[],kY=[],e=[],la=[],kV=[],kP=[];if(this._json.psrs&&this._json.psrs["SEResult"]){var kD=this._json.psrs["SEResult"];if(kD.length>0){for(var k8=0,kL=kD.length;k8<kL;++k8){kP.push(kD[k8])}}}var k3=this._json.suggest_query;if(k3){for(var k8=0,kL=k3.length;k8<kL;++k8){k3[k8]&&k3[k8]["query"]&&kP.push(k3[k8]["query"])}}kP=bP.unique(kP);if(lc!=gd&&lc!=iZ){var kR;if(!this._isMultiKey){k1=k0.count-(kH==0?(k0.spec_dispnum||0):0);kT=k0.total<760?k0.total:760;kR=kH==0?(k0.spec_dispnum||0):0}if(lc!=fB){if(!this._isMultiKey){for(var k8=kR;k8<k0.count;k8++){if(lb&&lb[k8]){var kE=lb[k8];if(kE.addr===null){continue}var kO=this._formatAddr(kE.addr,kE.poiType);var kS=[];if(kE.cla&&kE.cla["length"]>0){var kC=kE.cla["length"];while(kC--){var kZ=kE.cla[kC][1];kZ=kZ.replace("<b>","").replace("</b>","");kS.unshift(kZ)}}var kX={title:kE.name,uid:kE.uid,adcode:kE.admin_info?kE.admin_info["area_id"]:"",point:bP.parseGeo(kE.geo,true).point,url:aK._getPoiUrl(kE.uid,kW.code),detailUrl:"//api.map.baidu.com/place/detail?uid="+kE.uid+"&output=html&source=jsapi",address:kO,city:kW.name,province:kW.up_province_name||"",phoneNumber:kE.tel,postcode:kE.zip,type:kE.poiType||BMAP_POI_TYPE_NORMAL,isAccurate:(kE.acc_flag&&kE.acc_flag==1)?true:false};if(kS.length>0){kX.tags=kS}kN.push(kX);kY.push(kX.point);this._arrPois.push(kX)}}}else{var kJ=k0.result_array;var k2=kG.userKw.length;for(var k8=0;k8<k2;k8++){la[k8]=[];kV[k8]=[];e[k8]=[];if(!kJ[k8]){continue}if(kJ[k8]["type"]==gd){if(lb&&lb[k8]){for(var k6=0;k6<lb[k8].length;k6++){var T=lb[k8][k6];e[k8].push({city:T.name,_code:T.code,numResults:T.num})}}if(this._json.more_city&&this._json.more_city[k8]){var kM=this._json.more_city[k8];for(var k6=0,k4=kM.length;k6<k4;k6++){for(var k5=0,kU=kM[k6]["city"]["length"];k5<kU;k5++){var T=kM[k6]["city"][k5];e[k8].push({city:T.name,_code:T.code,numResults:T.num})}}}continue}var kQ=kJ[k8]["count"];var kI=kJ[k8]["page_num"]||0;var k9=kJ[k8]["total"]>760?760:kJ[k8]["total"];var kF={count:kQ,pagenum:kI,total:k9};kV[k8].push(kF);for(var k6=0;k6<kQ;k6++){if(lb&&lb[k8]&&lb[k8][k6]){var kE=lb[k8][k6];if(kE.addr===null){continue}var kO=this._formatAddr(kE.addr,kE.poiType);var kS=[];if(kE.cla&&kE.cla["length"]>0){var kC=kE.cla["length"];while(kC--){var kZ=kE.cla[kC][1];kZ=kZ.replace("<b>","").replace("</b>","");kS.unshift(kZ)}}var kX={title:kE.name,uid:kE.uid,adcode:kE.admin_info?kE.admin_info["area_id"]:"",point:bP.parseGeo(kE.geo,true).point,url:aK._getPoiUrl(kE.uid,kW.code),detailUrl:"//api.map.baidu.com/place/detail?uid="+kE.uid+"&output=html&source=jsapi",address:kO,city:kW.name,province:kW.up_province_name||"",phoneNumber:kE.tel,postcode:kE.zip,type:kE.poiType||BMAP_POI_TYPE_NORMAL,isAccurate:(kE.acc_flag&&kE.acc_flag==1)?true:false,tags:kS};la[k8].push(kX);kY.push(kX.point);this._arrPois.push(kX)}}}}}else{k1=kT=1;var kX={title:lb.cname,uid:lb.uid,point:bP.parseGeo(lb.geo,true).point,address:lb.cname,url:E.mapHost+"?s="+encodeURIComponent("s&wd="+k0.wd)};kN.push(kX);this._arrPois.push(kX);kY.push(kX.point)}}else{if(lc==iZ){k1=kT=1;var kX={title:k0.wd,point:bP.parseGeoStr(lb[0]),url:E.mapHost+"?s="+encodeURIComponent("s&wd="+k0.wd)};kN.push(kX);this._arrPois.push(kX);kY.push(kX.point)}if(lc==gd){k1=kT=0;for(var k8=0;k8<lb.length;k8++){e.push({city:lb[k8]["name"],_code:lb[k8]["code"],numResults:lb[k8]["num"]})}if(this._json.more_city){var kM=this._json.more_city;for(var k8=0,k4=kM.length;k8<k4;k8++){for(var k6=0,kU=kM[k8]["city"]["length"];k6<kU;k6++){var lb=kM[k8].city[k6];e.push({city:lb.name,_code:lb.code,numResults:lb.num})}}}}}this._arrPoints=kY;if(!this._isMultiKey){this._results=new iI({keyword:kG.userKw,count:k1,total:kT,pageIdx:k0.page_num,city:kW.name,province:kW.up_province_name||"",ccode:kW.code,pois:kN,cityList:e,pc:kK.getPageCapacity(),center:kG.center,radius:kG.radius,bounds:((kG.center&&kG.radius)?undefined:kG.bounds),moreUrl:this._getMoreUrl(kG,kW),suggestions:kP});this._results._qt=kG.params.qt;if(kT==0&&lc!=gd){this._setStatus(BMAP_STATUS_UNKNOWN_LOCATION)}else{if(lc!=gd){this._setStatus(BMAP_STATUS_SUCCESS)}else{this._setStatus(BMAP_STATUS_CITY_LIST)}}this._triggerCbk(aK.CBK_SEARCH_COMPLETE,this._results)}else{this._arrResults=[];var k2=kG.userKw.length;var k7=true;for(var k8=0;k8<k2;k8++){if(kV[k8].length>0&&kV[k8][0].total>0){k7=false}var kN=new iI({keyword:kG.userKw[k8]||"",count:kV[k8].length>0?kV[k8][0].count:0,total:kV[k8].length>0?kV[k8][0].total:0,pageIdx:kV[k8].length>0?kV[k8][0].pagenum:0,city:kW.name,province:kW.up_province_name||"",ccode:kW.code,pois:la[k8]||[],cityList:e[k8]||[],pc:kK.getPageCapacity(),center:kG.center,radius:kG.radius,bounds:((kG.center&&kG.radius)?undefined:kG.bounds),moreUrl:"",suggestions:kP});kN._qt=kG.params.qt;this._arrResults.push(kN)}if(k7){this._setStatus(BMAP_STATUS_UNKNOWN_LOCATION)}else{this._setStatus(BMAP_STATUS_SUCCESS)}this._triggerCbk(aK.CBK_SEARCH_COMPLETE,this._arrResults)}},_getMoreUrl:function(i,kC){var kG="";var kE=typeof i.center=="string"?(i.center+" "+i.userKw):i.userKw;var kH=kC.name,kF,kJ,e,T="";if(typeof i.center=="object"&&!(i.center instanceof cG||i.center instanceof cA)){kJ=i.center.point;kF=i.radius}if(i.bounds&&!i.center){e=i.bounds}if(i.center&&(i.center instanceof cG||i.center instanceof cA)){kJ=i.center;kF=i.radius}if(window._BMapSecurityConfig&&window._BMapSecurityConfig["serviceHost"]){kG=window._BMapSecurityConfig["serviceHost"]+"/place/search?res=jsapi&query="+kE+"&region="+kH+"&output=html"}else{kG=E.apiHost+"/place/search?res=jsapi&query="+kE+"&region="+kH+"&output=html"}if(kJ){kG+="&location="+kJ.lat+","+kJ.lng+"&radius="+kF}if(e){var kI=e.getSouthWest();var kD=e.getNorthEast();kG+="&bounds="+kI.lat+","+kI.lng+","+kD.lat+","+kD.lng}return kG},_formatAddr:function(i,e){e=e||BMAP_POI_TYPE_NORMAL;if(e==BMAP_POI_TYPE_BUSSTOP||e==BMAP_POI_TYPE_SUBSTOP){return bP.unique(i.split(";")).join("; ")}return i},_chkMultiKeyResults:function(kD){for(var kC=0,e=kD.length;kC<e;kC++){var T=kD[kC];if(T.getCurrentNumPois()>0){return true}}return false},_clearOverlays:function(){for(var T=0,e=this._overlays.length;T<e;T++){this._overlays[T].remove();this._overlays[T]=null}this._overlays.length=0;for(var T=0,e=this._arrPois.length;T<e;T++){this._arrPois[T]=null}this._arrPois.length=0;if(this._centerMkr){this._centerMkr.remove();this._centerMkr=null}},_getMaxResults:function(){if(!this._isMultiKey){return this._results}var kE;var e=-1;for(var kD=0,T=this._arrResults.length;kD<T;kD++){var kC=this._arrResults[kD];if(kC.getNumPages()>e){kE=kC;e=kC.getNumPages()}}return kE},clearResults:function(){delete this._json;delete this._status;delete this._results;if(this._isMultiKey){delete this._arrResults}delete this._ud;this._curIndex=-1;this._setStatus();this._clearOverlays();if(this._opts.renderOptions.panel){this._opts.renderOptions.panel.innerHTML=""}},gotoPage:function(i){if(this._useCustomdata){this.customSearch.gotoPage(i);return}if(this._ud){var e;if(!this._isMultiKey){e=this._results}else{e=this._getMaxResults()}if(typeof i=="number"&&!isNaN(i)&&i>=0&&i<=e.getNumPages()-1){this._ud.params.pn=i;var T=this._ud.params.qt;switch(T){case L:case dG:this.search(this._ud.params.wd,this._ud.options,this._ud);break;case dy:this.searchInBounds(this._ud.params.wd,this._ud.bounds,this._ud);break;case c0:this.searchNearby(this._ud.params.wd,this._ud.center,this._ud.radius,this._ud);break;case f2:this.searchInBounds(this._ud.userKw,this._ud.bounds,this._ud);break;case ew:this.search(this._ud.userKw,this._ud.options,this._ud);break;case be:this.searchNearby(this._ud.userKw,this._ud.center,this._ud.radius,this._ud);break;default:break}}else{this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(aK.CBK_SEARCH_COMPLETE)}}},_createCustomSearchInstance:function(){if(!this.customSearch){var e=this;this.customSearch=new CustomSearch(e)}},select:function(e){this.renderMap.select(e);this.renderList.select(e);this._curIndex=e}});function iI(e){this["keyword"]=e.keyword||"";this._pageIndex=e.pageIdx||0;this._currentNumPois=e.count||0;this._numPois=e.total||0;this._numPages=Math.ceil(e.total/e.pc);this["center"]=e.center;this["radius"]=e.radius;this["bounds"]=e.bounds;this["city"]=e.city;this["province"]=e.province;this["viewport"]=e.viewport;this["moreResultsUrl"]=e.moreUrl;this._pois=e.pois&&e.pois.slice(0)||[];this._cityList=e.cityList&&e.cityList.slice(0);this["suggestions"]=e.suggestions||[]}e9.extend(iI.prototype,{getPoi:function(kC){if(this._pois[kC]){var T={};for(var e in this._pois[kC]){if(this._pois[kC].hasOwnProperty(e)){T[e]=this._pois[kC][e]}}T.point=js(T.point,BMapGL.coordType);return T}},getPoiIn:function(e){return this._pois[e]},getCenter:function(){return js(this.center,BMapGL.coordType)},getBounds:function(){return new ik(js(this.bounds.getSouthWest(),BMapGL.coordType),js(this.bounds.getNorthEast(),BMapGL.coordType))},getNumPois:function(){return this._numPois},getNumPages:function(){return this._numPages},getCurrentNumPois:function(){return this._currentNumPois},getPageIndex:function(){return this._pageIndex},getCityList:function(){return this._cityList},toString:function(){return"LocalResult"}});function cS(e){dh.call(this);this.localSearch=e;this.map=e._opts.renderOptions.map;this._overlays=e._overlays;this.initialize()}cS.inherits(dh,"RenderMap");e9.extend(cS.prototype,{initialize:function(){this.addEventListener("onrender",this._render)},_render:function(){if(!this.map){return}var kE=this;var kF=this.localSearch._arrPois;var kD=[];for(var kC=0,e=kF.length;kC<e;kC++){var kG=kF[kC];kD.push(kG.point);var T=this._addPoi(kG.point,kC,kG.title);if(!T){continue}kG.marker=T;(function(){var i=kC;T.addEventListener("click",function(){kE.localSearch.select(i)})})();this._overlays.push(T)}this.localSearch._triggerCbk(aK.CBK_MARKERS_SET,kF)},addCenterPoi:function(kC){var e=kC;var i=this;if(e&&typeof e!="string"&&!(e instanceof cG||e instanceof cA)){var T=this.localSearch._centerMkr=fQ.addCenterPoi(this.map,e.point,e.title);T.addEventListener("click",function(){i.localSearch.select(-1);i.localSearch._curIndex="c";var kD=i._createInfoWindowByPoi(kC);T.openInfoWindow(kD)})}},_addPoi:function(T,e,kC){if(this.localSearch._opts.pageCapacity<=cJ.DEFAULT_PAGE_CAPACITY&&!this.localSearch._isMultiKey){return fQ.addSearchPoi(this.map,T,e,kC)}else{return fQ.addSearchInBoundsPoi(this.map,T,kC)}},select:function(kD){if(this.map&&kD>-1&&this._overlays[kD]){if(b5()){var i=null;for(var kC=0,e=this._overlays.length;kC<e;kC++){i=this._overlays[kC];if(kD==kC){i.setIcon(i.icoActive)}else{i.setIcon(i.icoDefault)}i.draw}}else{for(var kC=0,e=this._overlays.length;kC<e;kC++){i=this._overlays[kC];i.setTop(false)}}this.map.closeInfoWindow();var kF=this.localSearch._arrPois[kD];if(!kF){return}var T=this._createInfoWindowByPoi(kF);var kE=this._overlays[kD];kE.setTop(true);kE.openInfoWindow(T)}},_createInfoWindowByPoi:function(T){var e=fQ.createSearchInfoWnd({title:T.title,addr:T.address,tel:T.phoneNumber,url:T.url,detailUrl:T.detailUrl,uid:T.uid,poiType:T.type});var i=this;e.addEventListener("close",function(){i.localSearch.renderList.clearSelected()});e.addEventListener("open",function(){i.localSearch._triggerCbk(aK.CBK_INFO_HTML_SET,T,fQ.getInfoWindowDom(i.map))});return e},getBestViewport:function(i){var e=this.localSearch._opts.renderOptions;if(this.map){if(i.points){var kE=i.points;var kC=!e.autoViewport,kD=!e.selectFirstResult&&e.autoViewport,T=this.map.getViewport(kE,{margins:[30,30,30,30]});if(!kC){this.map.setViewport(T,{enableAnimation:kD})}}else{i.level=bP.getBestLevel(i.level,this.map);if(e.autoViewport){this.map.centerAndZoom(i.center,i.level)}}}}});function ae(e){dh.call(this);this.localSearch=e;this.panel=e._opts.renderOptions.panel;this.initialize()}ae.inherits(dh,"RenderList");e9.extend(ae.prototype,{initialize:function(){this.addEventListener("render",this._render)},_render:function(){if(!this.panel){return}var T=b6("div",{style:"font:12px "+E.fontFamily+";border:1px solid #999;"});var kE=b6("div",{style:"background:#fff"});var kG=b6("ol",{style:"list-style:none;padding:0;margin:0"});var kD=this.localSearch.getStatus();var e=null;if(kD==BMAP_STATUS_SUCCESS){for(var kF=0,kC=this.localSearch._arrPois.length;kF<kC;kF++){var kI=this._createItem(kF);kG.appendChild(kI)}}else{if(kD==BMAP_STATUS_CITY_LIST){if(kD==BMAP_STATUS_CITY_LIST&&!this.localSearch._isMultiKey){for(var kF=0,kC=Math.min(6,this.localSearch._results.getCityList().length);kF<kC;kF++){var kI=this._createCityItem(kF);kG.appendChild(kI)}}}else{var kH="";switch(kD){case BMAP_STATUS_UNKNOWN_LOCATION:kH="抱歉，未找到相关地点。";break;case BMAP_STATUS_INVALID_KEY:kH="抱歉，您所提供的key无效。";break}var kI=b6("li",{style:"margin:2px 0;padding:0 5px 0 3px;overflow:hidden;line-height:17px"});kI.innerHTML=kH;kG.appendChild(kI)}}kE.appendChild(kG);T.appendChild(kE);e=this._createResultsControl();T.appendChild(e);this.panel.appendChild(T);this.localSearch._triggerCbk(aK.CBK_RESULTS_HTML_SET,T)},_createItem:function(kE){var e=this.localSearch._arrPois;if(!e||!e[kE]){return}var T=e[kE],kL=b6("li",{style:"margin:2px 0;padding:0 5px 5px 0px;cursor:pointer;overflow:hidden;line-height:17px;*zoom:1;"});if(this.localSearch._curIndex>-1&&kE==this.localSearch._curIndex){kL.style.backgroundColor="#f0f0f0"}var i=E.staticHost+"/wolfman/static/common/images/";i+="markers_new2x_2960fb4.png";var kC="-139px";var kD=kE==0?"0px":"-"+kE*18+"px";if(this.localSearch._opts.pageCapacity>cJ.DEFAULT_PAGE_CAPACITY||this.localSearch._isMultiKey){kD="-180px"}var kK=[\'<span style="background:url(\'+i+") "+kD+" "+kC+\' no-repeat;background-size: 300px 300px;width:18px;height:27px;cursor:pointer;float:left;*zoom:1;overflow:hidden;margin:2px 3px 0 5px;*margin-right:0px;display:inline;">&nbsp;</span>\'];var kJ,kH,kF;if(!this.localSearch._isMultiKey){kF=this.localSearch._results.keyword}else{kF=this.localSearch._ud.userKw.join("|")}var kI=new RegExp(kF,"ig");if(T.title){kJ=T.title.replace(kI,"<b>$&</b>")}if(T.type==BMAP_POI_TYPE_BUSSTOP){kJ+="-公交车站"}else{if(T.type==BMAP_POI_TYPE_SUBSTOP){kJ+="-地铁站"}}kK.push(\'<div style="zoom:1;overflow:hidden;padding:0 5px;">\');kK.push(\'<div style="line-height:20px;font-size:12px;"><span style="color:#00c;">\'+kJ+"</span>");if(T.detailUrl){kK.push(\'<a target="_blank" href="\'+T.detailUrl+\'" style="margin-left:5px;font-size:12px;color:#3d6dcc;font-weight:normal;text-decoration:none;">详情&raquo;</a>\')}kK.push("</div>");if(T.address){kH=T.address.replace(kI,"<b>$&</b>");kK.push(\'<div style="padding:2px 0;line-height:18px;*zoom:1;overflow:hidden;"><b style="float:left;font-weight:bold;*zoom:1;overflow:hidden;padding-right:5px;*margin-right:-3px;">地址:</b><span style="color:#666;display:block;zoom:1;overflow:hidden;">\'+kH+"</span></div>")}if(T.phoneNumber){kK.push(\'<div style="padding:2px 0;line-height:18px;*zoom:1;overflow:hidden;"><b style="float:left;font-weight:bold;*zoom:1;overflow:hidden;padding-right:5px;*margin-right:-3px;">电话:</b><span style="color:#666;">\'+T.phoneNumber+"</span></div>")}kK.push("</div>");kL.innerHTML=kK.join("");var kG=this;kL.onclick=function(){kG.localSearch.select(kE)};return kL},_createResultsControl:function(){var i=this;var kD=b6("div",{style:"white-space:nowrap;text-align:right;background:#e5ecf9;margin-top:5px;padding:2px;overflow:hidden;zoom:1;"});if(!this.localSearch._isMultiKey&&!this.localSearch._useCustomdata){var T=b6("a",{style:"color:#7777cc;float:right;",href:this.localSearch._results.moreResultsUrl,target:"_blank",title:"到百度地图查看更多结果"});T.innerHTML="更多结果&#187;";kD.appendChild(T)}var e=b6("div",{style:"float:left;margin-right:5px"});var kC=this.localSearch._getMaxResults();if(this.localSearch._arrPois.length>0){var kE=new eT(e,function(kF){i.localSearch.gotoPage(kF-1)},{pageCount:kC.getNumPages(),page:kC.getPageIndex()+1,update:false})}kD.appendChild(e);return kD},clearSelected:function(){if(this.panel){if(typeof this.localSearch._curIndex=="number"&&this.localSearch._curIndex!=-1&&this.panel.getElementsByTagName("li")[this.localSearch._curIndex]){this.panel.getElementsByTagName("li")[this.localSearch._curIndex].childNodes[1].style.backgroundColor=""}}this.localSearch._curIndex=-1},select:function(i){if(this.panel){var e=this.localSearch._curIndex;if(typeof e=="number"&&e!=-1&&this.panel.getElementsByTagName("li")[e]){this.panel.getElementsByTagName("li")[e].childNodes[1].style.backgroundColor=""}if(typeof i=="number"&&i!=-1&&this.panel.getElementsByTagName("li")[i]){this.panel.getElementsByTagName("li")[i].childNodes[1].style.backgroundColor="#f0f0f0"}}},_createCityItem:function(e){var kC=b6("li",{style:"margin:2px 0;padding:0 5px 0 3px;cursor:pointer;overflow:hidden;line-height:17px"});kC._index=e;var kD=this.localSearch._results.getCityList();kC.innerHTML=\'<span style="color:#00c;text-decoration:underline"333>\'+kD[e]["city"]+\'</span> <span style="color:#666">(共\'+kD[e]["numResults"]+"条结果)</span>";var T=this.localSearch;var i=T._results;kC.onclick=function(){T.setLocation(i.getCityList()[e]["city"]);T.search(i.keyword)};return kC}});');
