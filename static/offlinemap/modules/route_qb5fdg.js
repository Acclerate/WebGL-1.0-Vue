/**/﻿_jsload&&_jsload('route', 'function eT(e,kD,i){dh.call(this);if(!e){return}this.container=(typeof(e)=="object")?e:e9.G(e);this.page=1;this.pageCount=100;this.argName="pg";this.pagecap=4;this.callback=kD;this.update=true;var T={page:1,totalCount:100,pageCount:100,pagecap:4,argName:"pg",update:true};if(!i){i=T}for(var kC in i){if(typeof(i[kC])!="undefined"){this[kC]=i[kC]}}this.render()}e9.extend(eT.prototype,{render:function(){this.initialize()},initialize:function(){this.checkPages();this.container.innerHTML=this.createHtml()},checkPages:function(){if(isNaN(parseInt(this.page))){this.page=1}if(isNaN(parseInt(this.pageCount))){this.pageCount=1}if(this.page<1){this.page=1}if(this.pageCount<1){this.pageCount=1}if(this.page>this.pageCount){this.page=this.pageCount}this.page=parseInt(this.page);this.pageCount=parseInt(this.pageCount)},getPage:function(){var i=location.search;var T=new RegExp("[?&]?"+this.argName+"=([^&]*)[&$]?","gi");var e=i.match(T);this.page=RegExp.$1},createHtml:function(){var kI=[];var kC=this.page-1;var kF=this.page+1;kI.push(\'<p style="margin:0;padding:0;white-space:nowrap">\');if(kC<1){}else{if(this.page>=this.pagecap){var T=\'<span style="margin-right:3px"><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp1}">首页</a></span>\';kI.push(T.replace("{temp1}","BMapGL.I(\'"+this.hashCode+"\').toPage(1);"))}var T=\'<span style="margin-right:3px"><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp2}">上一页</a></span>\';kI.push(T.replace("{temp2}","BMapGL.I(\'"+this.hashCode+"\').toPage("+kC+");"))}if(this.page<this.pagecap){if(this.page%this.pagecap==0){var kD=this.page-this.pagecap-1}else{var kD=this.page-this.page%this.pagecap+1}var kG=kD+this.pagecap-1}else{var kH=Math.floor(this.pagecap/2);var kE=this.pagecap%2-1;if(this.pageCount>this.page+kH){var kG=this.page+kH;var kD=this.page-kH-kE}else{var kG=this.pageCount;var kD=this.page-kH-kE}}if(this.page>this.pageCount-this.pagecap&&this.page>=this.pagecap){var kD=this.pageCount-this.pagecap+1;var kG=this.pageCount}for(var e=kD;e<=kG;e++){if(e>0){if(e==this.page){kI.push(\'<span style="margin-right:3px">\'+e+"</span>")}else{if(e>=1&&e<=this.pageCount){var T=\'<span><a style="color:#7777cc;margin-right:3px" href="javascript:void(0)" onclick="{temp3}">[\'+e+"]</a></span>";kI.push(T.replace("{temp3}","BMapGL.I(\'"+this.hashCode+"\').toPage("+e+");"))}}}}if(kF>this.pageCount){}else{var T=\'<span><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp4}">下一页</a></span>\';kI.push(T.replace("{temp4}","BMapGL.I(\'"+this.hashCode+"\').toPage("+kF+");"))}kI.push("</p>");return kI.join("")},toPage:function(i){var e=i?i:1;if(typeof(this.callback)=="function"){this.callback(e);this.page=e}if(this.update){this.render()}}});function dr(e){this["city"]=e.city;this._start=e.start;this._end=e.end;this._plans=e.plans;this["moreResultsUrl"]=e.url;this["taxiFare"]=e.taxiFare||null;this._startStatus=e.startStatus||BMAP_ROUTE_STATUS_NORMAL;this._endStatus=e.endStatus||BMAP_ROUTE_STATUS_NORMAL}e9.extend(dr.prototype,{getStart:function(){if(this._start){return this._start}},getEnd:function(){if(this._end){return this._end}},getStartStatus:function(){return this._startStatus},getEndStatus:function(){return this._endStatus},getNumPlans:function(){return this._plans.length},getPlan:function(e){if(this._plans[e]){return this._plans[e]}},});function ih(e){dr.call(this,e);this["waypoints"]=e.waypoints||[];this["policy"]=e.policy}e9.inherit(ih,dr,"DrivingRouteResult");function t(e){dr.call(this,e)}e9.inherit(t,dr,"WalkingRouteResult");function fw(e){dr.call(this,e)}e9.inherit(fw,dr,"RidingRouteResult");function b2(e){dr.call(this,e);this["waypoints"]=e.waypoints||[]}e9.inherit(b2,dr,"TruckRouteResult");function dK(e){dr.call(this,e);this["policy"]=e.policy;this["transitType"]=e.transitType;this["intercityPolicy"]=e.intercityPolicy;this["transitTypePolicy"]=e.transitTypePolicy}e9.inherit(dK,dr,"TransitRouteResult");e9.extend(dK.prototype,{getTransitType:function(){return this["transitType"]}});function gW(e){this._routes=e.routes.slice(0);this._distance=e.distance||0;this._duration=e.duration||0;this._dragPois=e.dragPois||[]}e9.extend(gW.prototype,{getRoute:function(e){if(this._routes[e]){return this._routes[e]}},getNumRoutes:function(){return this._routes.length},getDistance:function(e){if(e===false){return this._distance}else{return i6(this._distance)}},getDuration:function(e){if(e===false){return this._duration}else{return aI(this._duration,"nav")}},getDragPois:function(){return this._dragPois}});function eO(e){gW.call(this,e);this._lines=e.lines;this._description=e.description;this._duration=e.duration||0;this._totalType=e.totalType||[];this._total=e.total||[]}e9.inherit(eO,gW,"TransitRoutePlan");e9.extend(eO.prototype,{getNumLines:function(){return this._lines.length},getLine:function(e){if(this._lines[e]){return this._lines[e]}},getDescription:function(e){if(e===false){return bP.removeHtml(this._description)}else{return this._description}},getDuration:function(e){if(e===false){return this._duration}else{return aI(this._duration,"bustime")}},getLinesTitle:function(){var kC="";var e=this._lines.length-1;for(var T=0;T<e;T++){if(this._lines[T]&&this._lines[T]["title"]){kC+=this._lines[T]["title"]+" → "}}kC+=this._lines[e]["title"];return kC},getBusName:function(e){return e.substring(0,e.indexOf("("))},getWalkDistance:function(){var T=0;var e=this._routes.length;for(var kC=0;kC<e;kC++){T+=this._routes[kC].getDistance(false)}return i6(T)},getNumTotal:function(){return this._totalType.length},getTotalType:function(e){return this._totalType[e]},getTotal:function(e){return this._total[e]}});function cM(e){gW.call(this,e);this._lines=e.lines;this._description=e.description;this._duration=e.duration||0;this._total=e.total||[];this._distance=e.distance||0;this._toll=e.toll||0;this._tollDistance=e.tollDistance||0;this._oilCost=e.oilCost||0;this._description=e.description||0;this._stepNum=this._lines.length||0}e9.inherit(cM,gW,"TruckRoutePlan");e9.extend(cM.prototype,{getNumLines:function(){return this._lines.length},getLine:function(e){if(this._lines[e]){return this._lines[e]}},getDuration:function(e){if(e===false){return this._duration}else{return aI(this._duration,"trucktime")}},getTollDistance:function(){return this._tollDistance},getRoute:function(e){return this._lines[e]},getToll:function(){return this._toll},getOilCost:function(){return this._oilCost},plan2LineLayerData:function(){var kK={type:"FeatureCollection",features:[{type:"Feature",properties:{name:"demo1"},geometry:{type:"MultiLineString",coordinates:[]}}]};var kG=[];var e=[];var kC=[];var kI=-10;var T=0;for(var kH=0;kH<this._lines.length;kH++){if(kH===0&&this._lines[0].trafficCondition.length){kI=this._lines[0].trafficCondition[0].status}var kN=this._lines[kH];var kL=kN.points.map(function(i){return i});var kJ=kN.trafficCondition;for(var kF=0;kF<kJ.length;kF++){var kD=kJ[kF];if(kD.status!==kI&&kC.length){var kE=kK.features[0].geometry.coordinates.length;kK.features[0].geometry.coordinates[kE]=kC;kG[kE]={status:kI,distance:T,coordinates:kC};T=0;kC=[];kI=kD.status}var kM=kL.splice(0,kD.geo_cnt);kM.push(kL[0]);kM.forEach(function(i){if(e.length>0&&i.similar(e[length-1])){i=e[length-1]}e.push(i);kC.push([i.lng,i.lat])});T+=kD.distance}}if(kC){var kE=kK.features[0].geometry.coordinates.length;kK.features[0].geometry.coordinates[kE]=kC;kC=[];kG[kE]={status:kI,distance:T,coordinates:kC};T=0}return{geoMultiLineData:kK,trafficConditionData:kG}},plan2MultiPolyline:function(){var T=[];for(var e=0;e<this._lines.length;e++){if(T[this._lines[e].legIndex]){T[this._lines[e].legIndex]=T[this._lines[e].legIndex].concat(this._lines[e].points)}else{T[this._lines[e].legIndex]=this._lines[e].points}}return T},plan2Polyline:function(){var e=[];for(var T=0;T<this._lines.length;T++){e=e.concat(this._lines[T].points)}return e}});function de(e){gW.call(this,e);this._lines=e.lines;this._description=e.description;this._duration=e.duration||0;this._total=e.total||[];this._distance=e.distance||0;this._toll=e.toll||0;this._tollDistance=e.tollDistance||0;this._description=e.description||0;this._stepNum=this._lines.length||0}e9.inherit(de,gW,"DrivingRoutePlan");e9.extend(de.prototype,{getNumLines:function(){return this._lines.length},getLine:function(e){if(this._lines[e]){return this._lines[e]}},getDuration:function(e){if(e===false){return this._duration}else{return aI(this._duration,"nav")}},getTollDistance:function(){return this._tollDistance},getRoute:function(e){if(this._routes[e]){return this._routes[e]}},getToll:function(){return this._toll},plan2LineLayerData:function(){var kK={type:"FeatureCollection",features:[{type:"Feature",properties:{name:"demo1"},geometry:{type:"MultiLineString",coordinates:[]}}]};var kG=[];var e=[];var kC=[];var kI=-10;var T=0;for(var kH=0;kH<this._lines.length;kH++){if(kH===0&&this._lines[0].trafficCondition.length){kI=this._lines[0].trafficCondition[0].status}var kN=this._lines[kH];var kL=kN.points.map(function(i){return i});var kJ=kN.trafficCondition;for(var kF=0;kF<kJ.length;kF++){var kD=kJ[kF];if(kD.status!==kI&&kC.length){var kE=kK.features[0].geometry.coordinates.length;kK.features[0].geometry.coordinates[kE]=kC;kG[kE]={status:kI,distance:T,coordinates:kC};T=0;kC=[];kI=kD.status}var kM=kL.splice(0,kD.geo_cnt);kM.push(kL[0]);kM.forEach(function(i){if(e.length>0&&i.similar(e[length-1])){i=e[length-1]}e.push(i);kC.push([i.lng,i.lat])});T+=kD.distance}}if(kC){var kE=kK.features[0].geometry.coordinates.length;kK.features[0].geometry.coordinates[kE]=kC;kC=[];kG[kE]={status:kI,distance:T,coordinates:kC};T=0}return{geoMultiLineData:kK,trafficConditionData:kG}},plan2MultiPolyline:function(){var T=[];for(var e=0;e<this._lines.length;e++){if(T[this._lines[e].legIndex]){T[this._lines[e].legIndex]=T[this._lines[e].legIndex].concat(this._lines[e].points)}else{T[this._lines[e].legIndex]=this._lines[e].points}}return T},plan2Polyline:function(){var e=[];for(var T=0;T<this._lines.length;T++){e=e.concat(this._lines[T].points)}return e}});function dP(e){this._steps=e.steps&&e.steps.slice(0)||[];this._distance=e.distance||0;this._index=e.index||0;this._points=e.points.slice(0);this._planIndex=e.planIndex||0;this._rt=e.rt;if(this._distance===0&&this._points.length>2){this._points.length=2}}e9.extend(dP.prototype,{getNumSteps:function(){return this._steps.length},getStep:function(e){if(this._steps[e]){return this._steps[e]}},getDistance:function(e){if(e===false){return this._distance}else{return i6(this._distance)}},getIndex:function(){return this._index},getPolyline:function(){return this._polyline},getPath:function(){return this._points.map(function(e){return js(e,BMapGL.coordType)})},getPathIn:function(){return this._points},getRouteType:function(){return this._rt},getPlanIndex:function(){return this._planIndex}});function km(e){this["title"]=e.title;this.uid=e.uid;this["type"]=e.type;this._stops=e.stops.slice(0);this._points=e.points.slice(0);this._distance=e.distance||0;this._numViaStops=e.numViaStops||0;this._status=e.status||{}}e9.extend(km.prototype,{getNumViaStops:function(){return this._numViaStops},getGetOnStop:function(){return this._stops[0]},getGetOffStop:function(){return this._stops[1]},getPathIn:function(){return this._points},getPath:function(){return this._points.map(function(e){return js(e,BMapGL.coordType)})},getPolyline:function(){return this._polyline},getDistance:function(e){if(e===false){return this._distance}else{return i6(this._distance)}},getTitle:function(){return this["title"]}});function dX(e){this._path=e.path;this._point=e.point;this._index=e.index;this._description=e.description;this._distance=e.distance||0;this._routeIndex=e.routeIndex||0;this._planIndex=e.planIndex||0}e9.extend(dX.prototype,{getPosition:function(){return this._point},getPos:function(){return js(this._point,BMapGL.CoordType)},getIndex:function(){return this._index},getDescription:function(e){if(e===false){return bP.removeHtml(this._description)}else{return this._description}},getDistance:function(e){if(e===false){return this._distance}else{return i6(this._distance)}},getRouteIndex:function(){return this._routeIndex},getPlanIndex:function(){return this._planIndex}});j9._genTitle=function(kD,kF,kC){var i="-21px";var e="";if(kC===0){e+=";border-top:1px solid #e4e6e7";i="5px"}var kE="nav-ed";if(kC===0){kE="nav-st"}var T=["<div style=\'"+e+"\'><div style=\'cursor:pointer;padding:8px 0 8px 10px;line-height:15px\'"];T.push("onclick=\'"+kF+"\'>");T.push("<span class=\'navtrans-navlist-icon "+kE+"\'></span>");T.push("<div style=\'overflow:hidden;line-height:20px;\'>"+kD);T.push("</div></div></div>");return T.join("")};j9._genResultTitle=function(T,i,e){return\'<h1 style="margin:0;border-top:1px solid #e4e6e7;\'+(e?"border-bottom:1px solid #e4e6e7;padding:10px 0 10px 7px;":"padding:10px 0 9px 7px;")+"font:bold 16px "+E.fontFamily+\'"> \'+i+"前往 "+T+" 的路线</h1>"};e9.extend(j9.prototype,{search:function(i,e){if(!i||!e){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(aK.CBK_SEARCH_COMPLETE);return false}return true},clearResults:function(){delete this._results;delete this._ud;delete this._json;delete this._boundsPoints;delete this._segPolylinePoints;var e=this._opts.renderOptions;this._setStatus();if(e.panel){e.panel.innerHTML=""}if(e.map){e.map.closeInfoWindow()}this._clearOverlays();this._curIndex=-1},_formatDestQuery:function(i,T){var e;T=T||{};if(typeof i==="string"){e=[2,"","",i,0,""]}else{if(i instanceof cG||i instanceof cA){var kC=jy.convertLL2MC(i);e=[1,"",kC.lng+","+kC.lat,(T.wd||""),0,""]}else{var kC=jy.convertLL2MC(i.point);e=[1,""+i.uid,kC.lng+","+kC.lat,i.title,0,""]}}return e.join("$$")+"$$"},_formatDestQuery30:function(i,T){var e;T=T||{};if(typeof i==="string"){e=i}else{if(i instanceof cG||i instanceof cA){e=i.lat.toFixed(6)+","+i.lng.toFixed(6)}else{e=pt.lat.toFixed(6)+","+pt.lng.toFixed(6)}}return e},_formatDestUri:function(T,i){var e;if(typeof T==="string"){e=T}else{if(T instanceof cG||T instanceof cA){var kC=T;e=kC.lat+","+kC.lng}else{var kC=T.point;e=kC.lat+","+kC.lng}}if(typeof T!=="string"&&i&&i!==""&&typeof(i)==="string"){e="name:"+i+"|latlng:"+e}return e},getTPointQueryParam:function(e){var kC="";var T="1";var i=this._formatDestQuery(e);return i+kC+"$$"+T+"$$"},_getUriByOptions:function(i){var e;i=i||{};if(typeof dest==="string"){e=dest}else{if(dest instanceof cG||dest instanceof cA){var T=dest;e=T.lat+","+T.lng}else{var T=dest.point;e=T.lat+","+T.lng}}return e},_getCoordType:function(){switch(BMapGL.coordType){case BMAP_COORD_BD09:return"bd09ll";case BMAP_COORD_GCJ02:return"gcj02";case BMAP_COORD_WGS84:return"wgs84";default:return"bd09ll"}}});var dA=0;var ie=1;function i6(e){if(typeof e==="string"){e=parseFloat(e)}var i;if(!e||e<0){i="0米"}else{if(e<=10){i="10米"}else{i=e<1000?Math.round(e/10)*10+"米":(e/1000).toFixed(1)+"公里"}}if(i==="1000米"){i="1.0公里"}return i}function aI(kH,kC){if(kH===0){kH=1}if(!kH||isNaN(kH)){return""}var e="";var i=60;var kD=i*24;var T=Math.ceil(kH/i);if(kC==="bustime"){var kG=T%10;var kE=parseInt(T/10,10);T=kG!==0?(kG>5?(++kE*10):kE?(kE*10):5):T}var kI=parseInt(T/kD,10);T%=kD;var kF=parseInt(T/i,10);T%=i;if(kI>=1){e+=kI+"天"}if(kF>=1){e+=kF+"小时"}if(T>=1){if(kC&&kC==="nav"&&kI>=1){return e}else{e+=T+"分钟"}}return e}function aq(e){var T=e.getSouthWest();var i=e.getNorthEast();return[T,i]}e9.extend(eY.prototype,{_asyncSearch:function(){for(var T=0,e=this._queryList.length;T<e;T++){var kD=this._queryList[T];this[kD.method].apply(this,kD.arguments)}delete this._queryList;var kC=this;if(this._opts.renderOptions.map){this._opts.renderOptions.map.addEventListener("onpoiselected",function(i){kC.preciseSearch(i)})}},_internalSearch:function(kC,e){var i=this;function T(kF){var kD=kF.split("$$");var kE=kD[0];var kG=null;if(/[0-2]/.test(kE)&&kD.length===7){kG=kD[+kE+1]}return kG}this._getIdByLoc(this._loc,function(kG){var kE={qt:i.QUERY_TYPE,c:kG,sn:kC,en:e,sy:i._opts.policy||0,ext:1};if(kE.sy===BMAP_TRANSIT_POLICY_AVOID_SUBWAYS){kE.f="[0,2,4,7,5,8,9,10,11]"}var kF=T(kC);var kD=T(e);kl.request(function(kI,kH){i._rawDataCbk(kI,kH)},kE,{start:kF,end:kD})})},search:function(T,e){if(j9.prototype.search.call(this,T,e)===true){var i=this;this._getIdByLoc(this._loc,function(kE){if(!kE){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(aK.CBK_SEARCH_COMPLETE);return}if(typeof e==="string"||typeof T==="string"){i._setStatus(BMAP_STATUS_INVALID_REQUEST);i._triggerCbk(aK.CBK_SEARCH_COMPLETE);return}else{var kD;kD={output:"json",qt:ki,};kD.origin=i._formatDestQuery30(T);kD.destination=i._formatDestQuery30(e);kD.mode="transit";kD.tactics_incity=i._opts.policy||0;kD.trans_type_intercity=i._opts.transitTypePolicy||0;kD.tactics_intercity=i._opts.intercityPolicy||0;kD.ret_coordtype=i._getCoordType();kD.coord_type=i._getCoordType()}var kC={start:T,end:e,_from:"search",policy:kD.tactics_incity,intercityPolicy:kD.tactics_intercity,transitTypePolicy:kD.trans_type_intercity};kl.request(function(kG,kF){i._rawDataCbk(kG,kF)},kD,kC)})}},preciseSearch:function(kC){if(kC.sType!==this.QUERY_TYPE){return}var kD=kC.paramInfo;kD.qt=this.QUERY_TYPE;var T=this;kD.sy=T._opts.policy||0;var i={start:kD.sq,end:kD.eq,_from:"preciseSearch"};if(this._opts._enableTraffic){i.reqURL=E.mapHost+"mobile/webapp/interface/wiseBus/";i.enableTraffic=true}kl.request(function(kE,e){T._rawDataCbk(kE,i)},kD,i)},_rawDataCbk:function(i,e){var kD=this._opts.renderOptions.map;this.clearResults();this._json=i;var kC=i.result;var kE=i.content;this._ud=e;if(kC.error!==0){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(aK.CBK_SEARCH_COMPLETE,{})}else{if(kE.status!==0){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(aK.CBK_SEARCH_COMPLETE,{})}else{if(kE.type===cK){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(aK.CBK_SEARCH_COMPLETE,{})}else{if(kE.type===iF){var T=kE.result;if(T.routes===null||T.routes.length===0){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(aK.CBK_SEARCH_COMPLETE,{});return}if(T.origin["city_id"]===T.destination["city_id"]||T.origin["city_name"]===T.destination["city_name"]){this._json.content["transitType"]=BMAP_TRANSIT_TYPE_IN_CITY;this._processRawInCity()}else{this._json.content["transitType"]=BMAP_TRANSIT_TYPE_CROSS_CITY;this._processRawCrossCity()}this._renderList();this["_selectPlan"](0);return}}}}return},_getRouteStatus:function(T,i){var e=BMAP_ROUTE_STATUS_NORMAL;if(i===0){if(T>0){e=BMAP_ROUTE_STATUS_ADDRESS}else{e=BMAP_ROUTE_STATUS_EMPTY}}return e},_processRawInCity:function(){var k4=this;var k1=this._json.content;var kU=k1.result;var kJ={};var kH={};if(typeof this._ud.start==="object"&&!(this._ud.start instanceof cG||this._ud.start instanceof cA)){e9.extend(kJ,this._ud.start)}else{kJ.title="起点";kJ.city=kU.origin["city_name"];kJ.point=new cG(kU.origin["location"]["lng"],kU.origin["location"]["lat"])}if(typeof this._ud.end==="object"&&!(this._ud.end instanceof cG||this._ud.end instanceof cA)){e9.extend(kH,this._ud.end)}else{kH.title="终点";kH.city=kU.destination["city_name"];kH.point=new cG(kU.destination["location"]["lng"],kU.destination["location"]["lat"])}var kN=k1.result["routes"];var k0=[];var kS=0;this._boundsPoints=[];for(var kX=0;kX<kN.length;kX++){if(kS>this._opts.pageCapacity-1){break}this._boundsPoints[kS]=[];var kZ="<table class=\'trans-plan-content\'>";var kL=kN[kX];var kI=kL.distance;var e=kL.duration;var kC="";var kY=kL.steps;var kO=0;var kV=0;var k3=[];var kM=[];var kK=[];var kD=[];for(var kW=0;kW<kY.length;kW++){var kT=kY[kW][0];var kF=[];kF.push(new cG(kT.start_location["lng"],kT.start_location["lat"]));kF=kF.concat(bP.pathToPoints(kT.path));kF.push(new cG(kT.end_location["lng"],kT.end_location["lat"]));if(kT.vehicle_info["type"]===a0){var k2=new dP({distance:kT.distance,points:kF,rt:BMAP_ROUTE_TYPE_WALKING,index:kO,planIndex:kX});kO++;k3.push(k2);kK.push(k2);var kG="";if(kW===kY.length-1){kG=kH.title}else{kG=kY[kW+1][0]["vehicle_info"]["detail"]["on_station"]}kZ+="<tr><td><span class=\'navtrans-bus-icon walk\'></span><div class=\'navtrans-bus-desc\'>步行约"+i6(kT.distance)+"，到达<span class=\'navtrans-busstation\'>"+kG+"</span></div></td></tr>";kD.push(BMAP_TRANSIT_PLAN_TYPE_ROUTE)}else{if(kT.vehicle_info["type"]===iG){var kP=kT.vehicle_info["detail"];var kQ={title:kP.on_station,point:new cG(kT.start_location["lng"],kT.start_location["lat"])};var kE={title:kP.off_station,point:new cG(kT.end_location["lng"],kT.end_location["lat"])};var kR=new km({title:kP.name,distance:kT.distance,points:kF,stops:[kQ,kE],type:this._getLineType(kP.type,false),numViaStops:kP.stop_num});kM.push(kR);kK.push(kR);kZ+="<tr><td><span class=\'navtrans-bus-icon bus\'></span><div class=\'navtrans-bus-desc\'>乘坐<span class=\'navtrans-busstation\'>"+kP.name+"</span>，经过"+kP.stop_num+"站，到达<span class=\'navtrans-busstation\'>"+kE.title+"</span></div></td></tr>";kD.push(BMAP_TRANSIT_PLAN_TYPE_LINE)}}}kZ+="</table>";var T=new eO({routes:k3,lines:kM,total:kK,distance:kI,duration:e,description:kZ,totalType:kD});k0.push(T);kS++}this._results=new dK({plans:k0,start:kJ,end:kH,url:"",transitType:this._json.content["transitType"],intercityPolicy:this._ud.intercityPolicy,transitTypePolicy:this._ud.transitTypePolicy,policy:this._ud.policy});this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(aK.CBK_SEARCH_COMPLETE,this._results);return},_processRawCrossCity:function(){var k6=this;var k3=this._json.content;var kV=k3.result;var kJ={};var kH={};if(typeof this._ud.start==="object"&&!(this._ud.start instanceof cG||this._ud.start instanceof cA)){e9.extend(kJ,this._ud.start)}else{kJ.title="起点";kJ.city=kV.origin["city_name"];kJ.point=new cG(kV.origin["location"]["lng"],kV.origin["location"]["lat"])}if(typeof this._ud.end==="object"&&!(this._ud.end instanceof cG||this._ud.end instanceof cA)){e9.extend(kH,this._ud.end)}else{kH.title="终点";kH.city=kV.destination["city_name"];kH.point=new cG(kV.destination["location"]["lng"],kV.destination["location"]["lat"])}var kO=k3.result["routes"];var k2=[];var kT=0;this._boundsPoints=[];for(var kZ=0;kZ<kO.length;kZ++){if(kT>this._opts.pageCapacity-1){break}this._boundsPoints[kT]=[];var k1="<table class=\'trans-plan-content\'>";var kL=kO[kZ];var kI=kL.distance;var e=kL.duration;var kC="";var k0=kL.steps;var kP=0;var kX=0;var k5=[];var kM=[];var kK=[];var kD=[];for(var kY=0;kY<k0.length;kY++){for(var kW=0;kW<k0[kY].length;kW++){var kU=k0[kY][kW];var kF=[];kF.push(new cG(kU.start_location["lng"],kU.start_location["lat"]));kF=kF.concat(bP.pathToPoints(kU.path));kF.push(new cG(kU.end_location["lng"],kU.end_location["lat"]));if(kU.vehicle_info["type"]===a0){var k4=new dP({distance:kU.distance,points:kF,rt:BMAP_ROUTE_TYPE_WALKING,index:kP,planIndex:kZ});kP++;k5.push(k4);kK.push(k4);var kG="";if(kY===k0.length-1&&kW===k0[kY].length-1){kG=kH.title}else{if(kY<k0.length-1&&kW===k0[kY].length-1){var kN=k0[kY+1][0]["vehicle_info"];switch(kN.type){case iG:kG=kN.detail["on_station"];break;case aj:case iE:case cZ:kG=kN.detail["departure_station"];break}}else{if(kW<k0[kY].length-1){var kN=k0[kY][kW+1]["vehicle_info"];switch(kN.type){case iG:kG=kN.detail["on_station"];break;case aj:case iE:case cZ:kG=kN.detail["departure_station"];break}}}}k1+="<tr><td><span class=\'navtrans-bus-icon walk\'></span><div class=\'navtrans-bus-desc\'>步行约"+i6(kU.distance)+"，到达<span class=\'navtrans-busstation\'>"+kG+"</span></div></td></tr>";kD.push(BMAP_TRANSIT_PLAN_TYPE_ROUTE)}else{if(kU.vehicle_info["type"]===iG){var kQ=kU.vehicle_info["detail"];var kR={title:kQ.on_station,point:new cG(kU.start_location["lng"],kU.start_location["lat"])};var kE={title:kQ.off_station,point:new cG(kU.end_location["lng"],kU.end_location["lat"])};var kS=new km({title:kQ.name,distance:kU.distance,points:kF,stops:[kR,kE],type:this._getLineType(kQ.type),numViaStops:kQ.stop_num});kM.push(kS);kK.push(kS);k1+="<tr><td><span class=\'navtrans-bus-icon bus\'></span><div class=\'navtrans-bus-desc\'>乘坐<span class=\'navtrans-busstation\'>"+kQ.name+"</span>，经过"+kQ.stop_num+"站，到达<span class=\'navtrans-busstation\'>"+kE.title+"</span></div></td></tr>";kD.push(BMAP_TRANSIT_PLAN_TYPE_LINE)}else{if(kU.vehicle_info["type"]===aj){var kQ=kU.vehicle_info["detail"];var kR={title:kQ.departure_station,point:new cG(kU.start_location["lng"],kU.start_location["lat"])};var kE={title:kQ.arrive_station,point:new cG(kU.end_location["lng"],kU.end_location["lat"])};var kS=new km({title:kQ.name,distance:kU.distance,points:kF,stops:[kR,kE],type:this._getLineType(kU.vehicle_info["type"],true)});kM.push(kS);kK.push(kS);k1+="<tr><td><span class=\'navtrans-cross-city-icon train\'></span><div class=\'navtrans-bus-desc\'>乘坐<span class=\'navtrans-busstation\'>"+kQ.name+"</span>到达<span class=\'navtrans-busstation\'>"+kE.title+"</span></div></td></tr>";kD.push(BMAP_TRANSIT_PLAN_TYPE_LINE)}else{if(kU.vehicle_info["type"]===iE){var kQ=kU.vehicle_info["detail"];var kR={title:kQ.departure_station,point:new cG(kU.start_location["lng"],kU.start_location["lat"])};var kE={title:kQ.arrive_station,point:new cG(kU.end_location["lng"],kU.end_location["lat"])};var kS=new km({title:kQ.name,distance:kU.distance,points:kF,stops:[kR,kE],type:this._getLineType(kU.vehicle_info["type"],true)});kM.push(kS);kK.push(kS);k1+="<tr><td><span class=\'navtrans-cross-city-icon airplane\'></span><div class=\'navtrans-bus-desc\'>乘坐<span class=\'navtrans-busstation\'>"+kQ.name+"</span>到达<span class=\'navtrans-busstation\'>"+kE.title+"</span></div></td></tr>";kD.push(BMAP_TRANSIT_PLAN_TYPE_LINE)}else{if(kU.vehicle_info["type"]===cZ){var kQ=kU.vehicle_info["detail"];var kR={title:kQ.departure_station,point:new cG(kU.start_location["lng"],kU.start_location["lat"])};var kE={title:kQ.arrive_station,point:new cG(kU.end_location["lng"],kU.end_location["lat"])};var kS=new km({title:kQ.name,distance:kU.distance,points:kF,stops:[kR,kE],type:this._getLineType(kU.vehicle_info["type"],true)});kM.push(kS);kK.push(kS);k1+="<tr><td><span class=\'navtrans-bus-icon bus\'></span><div class=\'navtrans-bus-desc\'>乘坐<span class=\'navtrans-busstation\'>"+kQ.name+"</span>到达<span class=\'navtrans-busstation\'>"+kE.title+"</span></div></td></tr>";kD.push(BMAP_TRANSIT_PLAN_TYPE_LINE)}else{if(kU.vehicle_info["type"]===el){var k4=new dP({distance:kU.distance,points:kF,rt:BMAP_ROUTE_TYPE_DRIVING,index:kP,planIndex:kZ});kP++;k5.push(k4);kK.push(k4);k1+="<tr><td><span class=\'navtrans-bus-icon drive\'></span><div class=\'navtrans-bus-desc\'>驾车约"+i6(kU.distance)+"</div></td></tr>";kD.push(BMAP_TRANSIT_PLAN_TYPE_ROUTE)}}}}}}}}k1+="</table>";var T=new eO({routes:k5,lines:kM,total:kK,distance:kI,duration:e,description:k1,totalType:kD});k2.push(T);kT++}this._results=new dK({plans:k2,start:kJ,end:kH,url:"",transitType:this._json.content["transitType"],policy:this._ud.policy,intercityPolicy:this._ud.intercityPolicy,transitTypePolicy:this._ud.transitTypePolicy});this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(aK.CBK_SEARCH_COMPLETE,this._results);return},_renderPlan:function(kD){var kS=this._opts.renderOptions.map;var e=[];var kU=this;if(!kS){return}var T=this._results.getPlan(kD);if(!T){return}var kC=this._results.getStart();var kQ=this._results.getEnd();var kM=fQ.addDestPoi(kS,kC.point,kC.title,dA);kC.marker=kM;kM.addEventListener("click",function(){kU._select(0)});this._overlays.push(kM);var kK=fQ.addDestPoi(kS,kQ.point,kQ.title,ie);kQ.marker=kK;this._overlays.push(kK);kK.addEventListener("click",function(){kU._selectLast()});var kI=kC.point;var kP=kQ.point;this._boundsPoints[kD].push(kI,kP);for(var kO=0,kL=T.getNumTotal(),kN=0;kO<kL;kO++){if(T.getTotalType(kO)===BMAP_TRANSIT_PLAN_TYPE_LINE){var kH=T.getTotal(kO);var kJ=fQ.addLine(kS,kH.getPathIn());kH._polyline=kJ;this._overlays.push(kJ);var kF=kH.getGetOnStop();e.push(kF);var kG=fQ.addTransPoi(kS,kF.point,kH.type,kF.title);kF.marker=kG;this._overlays.push(kG);var kT=kH.getGetOffStop();e.push(kT);var kE=fQ.addTransPoi(kS,kT.point,kH.type,kT.title);kT.marker=kE;(function(){var i=kN;kN=kN+1;kG.addEventListener("click",function(){kU._select((i+1)*2-1)});kE.addEventListener("click",function(){kU._select((i+1)*2)})})();this._overlays.push(kE);this._boundsPoints[kD].push(kF.point,kT.point)}else{if(T.getTotalType(kO)===BMAP_TRANSIT_PLAN_TYPE_ROUTE){var kR=T.getTotal(kO);kJ=fQ.addRoute(kS,kR.getPathIn(),kR.getRouteType());kR._polyline=kJ;this._overlays.push(kJ)}}}var kU=this;if(this._opts.renderOptions.autoViewport){kS.setViewport(this._boundsPoints[kD],{margins:[30,30,30,30]})}this._triggerCbk(aK.CBK_POLYLINES_SET,T._lines,T._routes);this._triggerCbk(aK.CBK_MARKERS_SET,[kC,kQ],e)},_renderList:function(){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&this._results&&this._results.getNumPlans()>0){var T=b6("div",{style:"font:12px "+E.fontFamily+";background:#fff"});var kN=j9._genResultTitle(this._results.getEnd()["title"],"乘公共交通工具");var kH=this._genTitleHtml(this._results.getStart()["title"],\'BMapGL.I("\'+this.hashCode+\'")["_select"](0)\',0);var kD=this._genTitleHtml(this._results.getEnd().title,\'BMapGL.I("\'+this.hashCode+\'")["_selectLast"]()\',1);var kO=["<table style=\'font:12px "+E.fontFamily+";border-collapse:collapse;width:100%;\' cellpadding=\'0\' cellspacing=\'0\' border=\'0\'>"];for(var kK=0,kI=this._results.getNumPlans();kK<kI;kK++){var kM=this._results.getPlan(kK);var kF=kM.getDistance().replace(/(\\d+(?:.\\d+)?)/,"$1 ");var e=kM.getDuration().replace(/(\\d+)/,"$1 ");var kG=kM.getWalkDistance();bg="";var kL="<p style=\'margin:0px 0px 5px 0px;font-size:14px;color: #36c;\'>"+kM.getLinesTitle()+"</p>";if(this._json.content["transitType"]===BMAP_TRANSIT_TYPE_IN_CITY){kF=kF+"  &nbsp;|&nbsp;  "}else{kF=""}var kC="<p style=\'margin:5px 0px;font-size:12px;\'>"+kF+e+"  &nbsp;|&nbsp; 步行"+kG+"</p>";var kE="vertical-align:top;";kO.push("<tr class=\'tranroute-plan-list\' style=\\"cursor:pointer"+bg+\'">\');kO.push("<td style=\'"+kE+"line-height:18px\' ><div style=\'margin:3px 0px;border:1px solid #e4e6e7;\'><div class=\'trans-title\' style=\'padding: 5px 10px;\' onclick=\'BMapGL.I(\\""+this.hashCode+\'")._selectPlan(\'+kK+")\'>"+kL+kC+"</div><div class=\'trans_plan_desc\' style=\'padding:0px 8px;margin:0px;display:none;position:relative;\'>"+kH+kM.getDescription()+kD+"</div></div></td>");kO.push("</tr>")}kO.push("</table>");var kJ="<div style=\'border-bottom:1px solid #ccc;margin-bottom:10px;color:#7777cc;background:#e5ecf9;overflow:hidden;padding:2px;text-align:right\'>";if(this._results.moreResultsUrl){kJ+="<a style=\'color:#7777cc\' href=\'"+this._results.moreResultsUrl+"\' target=\'_blank\'>到百度地图查看&#187;</a>"}kJ+="&nbsp;</div>";T.innerHTML=kN+kO.join("")+kJ;this._opts.renderOptions.panel.appendChild(T);this._triggerCbk(aK.CBK_RESULTS_HTML_SET,T)}},_select:function(kF,kH){var T=this._opts.renderOptions.map;if(T){kH=kH||window.event;var kK=this._results.getPlan(this._curIndex);if(!kK){return}var kJ=this;var kL=kK.getNumLines()*2;if(kF===0||kF===kL+1){var kI=kF===0?this._results.getStart():this._results.getEnd();var kD=fQ.createTransInfoWnd({content:"<b>"+kI.title+"</b>",total:kL,curIndex:kF,nextTransCbk:function(e){kJ._select(e)}});kD.addEventListener("open",function(){kJ._triggerCbk(aK.CBK_INFO_HTML_SET,kI,fQ.getInfoWindowDom(T))});var kG=kF===0?0:1;var kJ=this;if(T.config.enableStreetEntrance&&false){PanoramaEntranceUtil.insearchPanoEntranceInInfoWnd(kD,T.getCurrentCity().code,{panoInstance:T._pano,lngLat:kI.point,titleTip:kI.title,type:"busline",beforeDomId:"trans_nav"},function(){kJ._overlays[kG].openInfoWindow(kD)})}else{kJ._overlays[kG].openInfoWindow(kD)}}else{var i=kK.getLine(Math.floor((kF+1)/2)-1);var kM;var kC=i.getTitle();var kE;if(kF%2===1){kM=i.getGetOnStop();kE=kC+"<b>"+kM.title+"上车</b>"}else{kM=i.getGetOffStop();kE=kC+"<b>"+kM.title+"下车</b>"}var kD=fQ.createTransInfoWnd({content:kE,total:kL,curIndex:kF,nextTransCbk:function(e){kJ._select(e)}});kD.addEventListener("open",function(){kJ._triggerCbk(aK.CBK_INFO_HTML_SET,kM,fQ.getInfoWindowDom(T))});var kJ=this;if(T.config.enableStreetEntrance&&false){PanoramaEntranceUtil.insearchPanoEntranceInInfoWnd(kD,T.getCurrentCity().code,{panoInstance:T._pano,lngLat:kM.point,titleTip:kM.title,type:"busline",beforeDomId:"trans_nav"},function(){kM.marker.openInfoWindow(kD)})}else{kM.marker.openInfoWindow(kD)}}}},_selectLast:function(kC){kC=kC||window.event;if(this._results&&this._curIndex>-1){var T=this._results.getPlan(this._curIndex);if(!T){return}var i=T.getNumLines()*2;this["_select"](i+1)}},_selectPlan:function(kE){if(!this._results&&!this._result.getPlan(kE)){return}var kH=this._results.getPlan(kE);var e=this._opts.renderOptions.map;if(e){e.closeInfoWindow();this._clearOverlays();this._renderPlan(kE)}if(this._opts.renderOptions.panel){var kI=this._opts.renderOptions.panel.getElementsByTagName("table")[0];if(!kI){return}var kF=e9.getElementsByClassName(kI,"tranroute-plan-list");var kG=e9.getElementsByClassName(kI,"trans_plan_desc");for(var kC=0;kC<kG.length;kC++){if(kC!==kE){kG[kC].style.display="none"}}for(var T=0;T<kF.length;T++){e9.removeClassName(kF[T],"expand")}var kD=e9.getElementsByClassName(kF[kE],"trans_plan_desc")[0];if(kD.style.display==="none"){kD.style.display="block";e9.addClassName(kF[kE],"expand")}else{kD.style.display="none"}}this._curIndex=kE},_clearOverlays:function(){for(var e=0;e<this._overlays.length;e++){if(this._overlays[e]&&this._overlays[e]._p){this._overlays[e]._p.remove();this._overlays[e]._p=null}this._overlays[e]&&this._overlays[e].remove();this._overlays[e]=null}this._overlays.length=0},_getLineType:function(i,e){if(!e){return eY.LINE_TYPE_MAPPING[i]}else{return eY.LINE_TYPE_MAPPING_CROSS_CITY[i]}},_genTitleHtml:function(kC,kE,T){var i="";if(T===0){i+="padding-top:5px;"}var kD="nav-ed";if(T===0){kD="nav-st"}var e=["<div style=\'"+i+"\'><div style=\'cursor:pointer;padding:2px 0 2px 0px;line-height:15px\'"];e.push("onclick=\'"+kE+"\'>");e.push("<span class=\'navtrans-navlist-icon "+kD+"\'></span>");e.push("<div style=\'overflow:hidden;line-height:20px;\'>"+kC);e.push("</div></div></div>");return e.join("")}});cO.MAX_THRESHOLD=20;cO.DRAG_REQ_FREQUENCE=50;cO.DRAG_MAXPOINTS=10;e9.extend(cO.prototype,{init_d:function(){this._d={plys:[],viaPts:[],viaPtsInfo:[],dragOverlays:[],tipLbl:null,sliderMkr:null,dragReqFlag:false,cbkDragPt:null,cbkPly:null,isSearchByDrag:false,curDragPly:null,dragSrcCityCode:1,dragEndCityCode:1,cbkStartPoiName:"起点",cbkEndPoiName:"终点",mouseOnViaMkr:false,cxtMenu:[]}},_asyncSearch:function(){this.init_d();for(var T=0,e=this._queryList.length;T<e;T++){var kD=this._queryList[T];this[kD.method].apply(this,kD.arguments)}delete this._queryList;var kC=this;if(this._opts.renderOptions.map){this._opts.renderOptions.map.addEventListener("onpoiselected",function(i){kC.preciseSearch(i)})}},search:function(kC,e,T){this._d.isSearchByDrag=false;var T=T||{};if(j9.prototype.search.call(this,kC,e)===true){var i=this;this._getIdByLoc(this._loc,function(kG){kG=kG||1;var kF;kF={output:"json",qt:ki,ret_coordtype:i._getCoordType(),coord_type:i._getCoordType()};var kD={start:kC,end:e};var kE="";if(i.QUERY_TYPE===iv){kF.origin=i._formatDestQuery30(kC);kF.destination=i._formatDestQuery30(e);kF.region=kG;kF.mode="walking"}else{if(i.QUERY_TYPE===aR){if(typeof e==="string"||typeof kC==="string"){i._setStatus(BMAP_STATUS_INVALID_REQUEST);i._triggerCbk(aK.CBK_SEARCH_COMPLETE,{});return}else{kF.origin=i._formatDestQuery30(kC);kF.destination=i._formatDestQuery30(e);kF.mode="driving";kF.tactics=i._opts.policy||0;kD.policy=kF.tactics}}else{if(i.QUERY_TYPE===hU){kF.origin=i._formatDestQuery30(kC);kF.destination=i._formatDestQuery30(e);kF.region=kG;kF.mode="riding"}}}kl.request(function(kI,kH){i._rawDataCbk(kI,kH)},kF,kD,kE)})}},_dragSearch:function(T,e){var i=this;i._d.isSearchByDrag=true;i._getIdByLoc(i._loc,function(kD){kD=kD||1;var kH=jy.convertLL2MC(i._d.viaPts[0]);var kC="1$$$$"+kH.lng+","+kH.lat+"$$$$";var kL=i._d.dragSrcCityCode||kD;var kK="";var kE="";for(var kI=1,kF=i._d.viaPts.length;kI<kF;kI++){var kJ=i._d.viaPts[kI];if(kI===kF-1){kK+=i._formatDestQuery(kJ);kE+=(i._d.dragEndCityCode||kD)}else{if(kJ.if_wp){kK+=i.getTPointQueryParam(kJ)+"+to:"}else{kK+=i._formatDestQuery(kJ)+"+to:"}kE+="0 +to:"}}var kG={qt:i.QUERY_TYPE,c:kD,drag:1,sc:kL,ec:kE,sn:kC,en:kK,sy:i._opts.policy||0};if(i._opts._enableTraffic){kG.route_traffic=1;kG.version=4;kG.mrs=0}var kM={start:T,end:e,enableTraffic:i._opts._enableTraffic};e9.extend(kM,{useEncodeURI:true});kl.request(function(kO,kN){i._rawDataCbk(kO,kN)},kG,kM)})},preciseSearch:function(kC){if(kC.sType!==this.QUERY_TYPE){return}var T=this;var kD={};kD.qt=ki;if(T.QUERY_TYPE===iv){kD.origin=kC.paramInfo["start_name"];kD.destination=kC.paramInfo["end_name"];kD.region=kC.paramInfo["region"];kD.mode="walking"}if(T.QUERY_TYPE===hU){kD.origin=kC.paramInfo["start_name"];kD.destination=kC.paramInfo["end_name"];kD.region=kC.paramInfo["region"];kD.mode="riding"}var i={start:kD.origin,end:kD.destination};kl.request(function(kE,e){T._rawDataCbk(kE,i)},kD,i)},_rawDataCbk:function(kH,T){this.clearResults();this._json=kH;var e=kH.result;var kE=kH.content;this._ud=T;if(e.error!==0){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(aK.CBK_SEARCH_COMPLETE,{})}else{if(kE.status!==0||(kE.result&&kE.result["routes"]===null)){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(aK.CBK_SEARCH_COMPLETE,{})}else{if(kE.type===cK){if(this.QUERY_TYPE===iv||this.QUERY_TYPE===hU){var kC=kE.result;var kD;var kF;kD=this._getRouteStatus30(kC.origin["content"]);kF=this._getRouteStatus30(kC.destination["content"]);if(kD!=BMAP_ROUTE_STATUS_EMPTY&&kF!=BMAP_ROUTE_STATUS_EMPTY&&this._opts.renderOptions.map){var kG=new hz(kH,{renderOptions:this._opts.renderOptions,sType:this.QUERY_TYPE});var i=b6("div",{style:"font:12px "+E.fontFamily+";background:#fff"});i.innerHTML=kG.render(T);if(this._opts.renderOptions.panel){this._opts.renderOptions.panel.appendChild(i);kG.initialize();return}else{kG.withoutPanelInitial();return}}this._results=this._createResults({city:"",plans:[],startStatus:kD,endStatus:kF});this._setStatus(BMAP_STATUS_UNKNOWN_ROUTE);this._triggerCbk(aK.CBK_SEARCH_COMPLETE,this._results);return}else{if(this.QUERY_TYPE===aR){}}}else{if(kE.type===iF){if(this.QUERY_TYPE===aR){this._opts.renderOptions.panel=null}this._processRaw();this._renderMap();if(this.QUERY_TYPE===iv||this.QUERY_TYPE===hU){this._renderList()}}}}}},_getRouteStatus:function(T,i){var e=BMAP_ROUTE_STATUS_NORMAL;if(i===0){if(T>0){e=BMAP_ROUTE_STATUS_ADDRESS}else{e=BMAP_ROUTE_STATUS_EMPTY}}return e},_getRouteStatus30:function(i){var e=BMAP_ROUTE_STATUS_NORMAL;if(typeof i==="undefined"||i===null||i.length===0){e=BMAP_ROUTE_STATUS_EMPTY}else{if(i.length>0){e=BMAP_ROUTE_STATUS_ADDRESS}}return e},_stopDragging:function(){var kD=this;if(kD._d.sliderMkr){kD._d.sliderMkr.disableDragging()}for(var kC=0,e=this._d.dragOverlays.length;kC<e;kC++){var T=this._d.dragOverlays[kC];if(T instanceof ke){T.disableDragging()}}},_processRaw:function(){var k5=this;var k4=this._json.content;var kR=k4.result;var kH={};var kF={};if(typeof this._ud.start==="object"&&!(this._ud.start instanceof cG||this._ud.start instanceof cA)){e9.extend(kH,this._ud.start)}else{if(k5.QUERY_TYPE===iv||k5.QUERY_TYPE===hU){kH.title=kR.origin["wd"]||"起点";kH.uid=kR.origin["uid"];kH.url=aK._getPoiUrl(kH.uid,kR.origin["area_id"]);kH.point=new cG(kR.origin["originPt"]["lng"],kR.origin["originPt"]["lat"]);kH.city=kR.origin["cname"]}else{if(k5.QUERY_TYPE===aR){kH.title="起点";kH.point=new cG(kR.routes[0]["origin"]["lng"],kR.routes[0]["origin"]["lat"])}}}if(typeof this._ud.end==="object"&&!(this._ud.end instanceof cG||this._ud.end instanceof cA)){e9.extend(kF,this._ud.end)}else{if(k5.QUERY_TYPE===iv||k5.QUERY_TYPE===hU){kF.title=kR.destination["wd"]||"终点";kF.uid=kR.destination["uid"];kF.url=aK._getPoiUrl(kF.uid,kR.destination["area_id"]);kF.point=new cG(kR.destination["destinationPt"]["lng"],kR.destination["destinationPt"]["lat"]);kF.city=kR.destination["cname"]}else{if(k5.QUERY_TYPE===aR){kF.title="终点";kF.point=new cG(kR.routes[0]["destination"]["lng"],kR.routes[0]["destination"]["lat"])}}}var kO=[];this._d.viaPtsInfo.length=0;var k0=1;var k3=[];this._segPolylinePoints=[];var kK=0;var kP=[];var kW=[];var k2=[];var kX=[];var kM=kR.routes;if(k5.QUERY_TYPE===iv||k5.QUERY_TYPE===hU){for(var kY=0;kY<kM.length;kY++){var kS=kM[kY];for(var kU=0;kU<1;kU++){var kZ=kS.steps;for(j=0;j<kZ.length;j++){var kT=new cG(kZ[j]["stepOriginLocation"]["lng"],kZ[j]["stepOriginLocation"]["lat"]);var kQ=j;var kI=kZ[j]["instructions"];var kE=kZ[j]["distance"];var kJ=new dX({point:kT,index:kQ,description:kI,distance:kE});k2.push(kJ);var kD=[];kD.push(kT);kD=kD.concat(bP.pathToPoints(kZ[j]["path"]));kD.push(new cG(kZ[j]["stepDestinationLocation"]["lng"],kZ[j]["stepDestinationLocation"]["lat"]));kX=kX.concat(kD);if(kD.length>0){this._segPolylinePoints[kK]=kD;k3=k3.concat(kD)}kK++}var kE=kS.distance;var e=new dP({steps:k2,distance:kE,index:kU,points:kX,rt:this.ROUTE_TYPE});kW.push(e)}var kL=new gW({routes:kW,distance:kS.distance,duration:kS.duration});kP.push(kL)}var kN={plans:kP,start:kH,end:kF}}else{if(k5.QUERY_TYPE===aR){for(var kY=0;kY<kM.length;kY++){var kS=kM[kY];for(var kU=0;kU<1;kU++){var kZ=kS.steps;for(j=0;j<kZ.length;j++){var kT=new cG(kZ[j]["start_location"]["lng"],kZ[j]["start_location"]["lat"]);var kQ=j;var kI="";var kE=kZ[j]["distance"];var kJ=new dX({point:kT,index:kQ,description:kI,distance:kE});k2.push(kJ);var kD=[];kD=kD.concat(bP.pathToPoints(kZ[j]["path"]));kX=kX.concat(kD);if(kD.length>0){this._segPolylinePoints[kK]=kD;k3=k3.concat(kD)}kK++}var kE=kS.distance;var e=new dP({steps:k2,distance:kE,index:kU,points:kX,rt:this.ROUTE_TYPE});kW.push(e)}var kL=new gW({routes:kW,distance:kS.distance,duration:kS.duration});kP.push(kL)}var kN={plans:kP,start:kH,end:kF,policy:k5._ud.policy}}}this._results=this._createResults(kN);this._d.viaPts.length=0;this._d.plys.length=0;var T=kH.point;this._d.viaPts.push(T);for(var kY=0,kV=kO.length;kY<kV;kY++){var k1=kO[kY];this._d.viaPts.push(k1)}var kC=kF.point;this._d.viaPts.push(kC);var kG=kX;kG.stNo=kY;kG.edNo=kY+1;this._d.plys.push(kG);this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(aK.CBK_SEARCH_COMPLETE,this._results)},_getAllStepCount:function(){var kD=0;var kE=this._results.getPlan(0);for(var kC=0,e=kE.getNumRoutes();kC<e;kC++){var T=kE.getRoute(kC);kD+=T.getNumSteps()}return kD},_getCurStep:function(kF){var kE=0;var kG=this._results.getPlan(0);for(var kD=0,T=kG.getNumRoutes();kD<T;kD++){var kI=kG.getRoute(kD);for(var kC=0,kH=kI.getNumSteps();kC<kH;kC++){var e=kI.getStep(kC);if(kE===kF){return e}kE++}}},_getDescription:function(kH,kG,kR,kN,kM,kC,kV){var kE="";var kL=parseInt(kG.d,10);var kI=kG.poi;if(kI){kL=kL-kI.pd}var kQ=i6(kL);var T=this._getRoadName(kC.t,kC.n);var kD=this._getRoadName(kG.t,kG.n);var kU=this._getRoadName(kG.t,kR.n);var kJ=this._getDwType(kH.dw)||"";var kK=kH.dr?(kJ+"<span>"+kH.dr+"</span>，"):"";if(kV.rt===3){kK+="到达<span>"+this._getRetType(kV.rt)+"</span>，"}var kS=((kD!==""&&T===kD)?"继续":"")+this._getRoadAct(kG.t,kG.n);var e=this._getPoiInfo(kG);var kP=this._getTicInfo(kH);var kT=(kD===kU)?"":(this._getRetAct(kR.t,kR.n)+"<span>"+kU+"</span>");var kO=this._getTurnIcon(kH.ett||kH.extt||kH.tt);kE=kO+"<div class=\'navtrans-navlist-content\'>"+kS+kD+this._getRetType(kH.rt)+kQ+"，"+e+kP+kK;if(kN===0){kE=kO+"<div class=\'navtrans-navlist-content\'>从起点向"+this._getTurnType(kH.ett||kH.extt||kH.tt)+"出发</div>"}else{if(kN>0&&kN<kM-1){var kF=this._getTurnType(kH.ett||kH.extt||kH.tt);if(!kF){kF=this._getTurnType(1)}kE=kE+kF+kT+"</div>"}else{kE=kE+"到达终点</div>"}}return kE},_isInThreshold:function(kG,T,kF){if(T&&kF&&kF.length>0){for(var kE=0,e=kF.length;kE<e;kE++){var kD=kF[kE];var kC=kG.pointToPixel(kD);if(fQ.getDistanceByPixel(T,kC)<=cO.MAX_THRESHOLD){return true}}}return false},_renderMap:function(){var e=this._opts.renderOptions.map;if(e&&this._results){this._renderViaMkr();this._renderPly()}},_renderPly:function(){var kU=this._opts.renderOptions.map;var e=this._results.getPlan(0);var kT=e.getRoute(0);var kC=this._results.getStart();var kS=this._results.getEnd();var kV=this;var kE=this._d.viaPts.length;var kR=[];var kG=[];var T;for(var kO=0,kL=this._d.plys.length;kO<kL;kO++){var kJ=this._d.plys[kO];T=fQ.addRoute(kU,kJ,kT.getRouteType());e._routes[kO]._polyline=T;T.stNo=kJ.stNo;T.edNo=kJ.edNo;var kM=T.getBounds();kR.push(kM.getSouthWest());kR.push(kM.getNorthEast());if(this._enableDragging){if(kE<cO.DRAG_MAXPOINTS+2){T.addEventListener("mousemove",function(i){if(kV._d.mouseOnViaMkr){if(kV._d.sliderMkr){kV._d.sliderMkr.hide()}return}kV._d.curDragPly=this;if(kV._d.sliderMkr){if(kV._isInThreshold(kU,i.pixel,kV._d.viaPts)){kV._d.sliderMkr.hide()}else{kV._d.sliderMkr.show();kV._d.sliderMkr.setPosition(i.point);kV._d.tipLbl.setContent("拖动以更改路线");kV._d.tipLbl.show();kV._d.sliderMkr.setLabel(kV._d.tipLbl)}}else{kV._d.sliderMkr=fQ.addDragMkr(kU,i.point);kV._d.sliderMkr.enableDragging();kV._d.sliderMkr.addEventListener("dragging",function(kX){var kY=kV._d.curDragPly.stNo;var kW=kV._d.curDragPly.edNo;kV._requestDragging(this,kU,kY,kW)});kV._d.sliderMkr.addEventListener("dragend",function(kY){var kX=kV._d.cbkDragPt;var kZ=kX.name;var kW=kV._d.curDragPly.edNo;kX.if_wp=null;kV._d.viaPts.splice(kW,0,kX);kV._d.viaPtsInfo.splice(kW,0,{title:!!kZ?kZ:"未知路段",curNo:kW,point:kX});this.setPosition(kX);kV._stopDragging();kV._dragSearch(kC,kS)});if(!kV._d.tipLbl){kV._d.tipLbl=fQ.createTipLbl("拖动以更改路线")}kU.addOverlay(kV._d.sliderMkr)}});T.addEventListener("mouseout",function(i){if(kV._d.sliderMkr){kV._d.sliderMkr.hide()}})}}kV._d.dragOverlays.push(T);if(this._opts._enableTraffic){kT=e.getRoute(kO);for(var kN=0,kH=kT._steps.length;kN<kH;kN++){var kD=kT._steps[kN];var kK=kD.trafficPaths;var kP=kD.trafficStatus;for(var kI=0,kQ=kK.length;kI<kQ;kI++){if(kP[kI]){var kF=fQ.addRouteWithTraffic(kU,kK[kI],kP[kI])}kG.push(kF);kV._d.dragOverlays.push(kF)}}kT._trafficePlys=kG}}if(this._opts.renderOptions.autoViewport){kU.setViewport(kR,{margins:[30,30,30,30]})}this._triggerCbk(aK.CBK_POLYLINES_SET,e._routes)},_renderViaMkr:function(){var T=this._opts.renderOptions.map;var kL=this._results.getPlan(0);var e=this._results.getStart();var kI=this._results.getEnd();var kJ=this;var kK=0;for(var kG=0,kC=this._d.viaPts.length;kG<kC;kG++){var kH=this._d.viaPts[kG];var kE;if(kG===0){kE=fQ.addDestPoi(T,kH,e.title,dA);e.marker=kE;if(this.QUERY_TYPE===iv||this.QUERY_TYPE===hU){kE.addEventListener("click",function(){kJ._select(0)})}this._overlays.push(kE)}else{if(kG===this._d.viaPts.length-1){kE=fQ.addDestPoi(T,kH,kI.title,ie);kI.marker=kE;if(this.QUERY_TYPE===iv||this.QUERY_TYPE===hU){kE.addEventListener("click",function(){kJ._select(kJ._getAllStepCount()+1)})}this._overlays.push(kE)}else{if(kH.if_wp){kE=fQ.addWayPointMkr(T,kH,kK);kK++;kE.if_wp=1}else{kE=fQ.addDragMkr(T,kH)}this._d.viaPtsInfo[kG-1].marker=kE;var kF=new hG();kF.addItem(new ii("删除该点",function(kN,kM,i){kJ._delVia(i.curNo)},{width:60}));kE.addContextMenu(kF);kJ._d.cxtMenu.push(kF)}}kE.curNo=kG;if(this._enableDragging){kE.enableDragging();kE.addEventListener("mouseover",function(i){kJ._d.mouseOnViaMkr=true;if(kJ._d.tipLbl){kJ._d.tipLbl.setContent("拖动以更改路线");kJ._d.tipLbl.show();this.setLabel(kJ._d.tipLbl)}else{kJ._d.tipLbl=fQ.createTipLbl("拖动以更改路线");this.setLabel(kJ._d.tipLbl)}});kE.addEventListener("mouseout",function(i){this.getLabel()&&this.getLabel().hide();kJ._d.mouseOnViaMkr=false});kE.addEventListener("dragging",function(i){kJ._requestDragging(this,T)});kE.addEventListener("dragend",function(kM){var i=kJ._d.cbkDragPt;var kN=this.curNo;if(this.if_wp){i.if_wp=1}kJ._d.viaPts[kN]=i;this.setPosition(i);var kP=kJ._d.viaPts[0];var kO=kJ._d.viaPts[kJ._d.viaPts.length-1];if(kN===0){e.point=kP;e.title=kJ._d.cbkStartPoiName}if(kN===kJ._d.viaPts.length-1){kI.point=kO;kI.title=kJ._d.cbkEndPoiName}kJ._stopDragging();kJ._dragSearch(e,kI)})}kJ._d.dragOverlays.push(kE)}var kD=[e];kD=kD.concat(this._d.viaPtsInfo);kD=kD.concat([kI]);this._triggerCbk(aK.CBK_MARKERS_SET,kD)},_requestDragging:function(kG,i,kC,kH){var kJ=this;if(kJ._d.dragReqFlag===true){return}kJ._d.dragReqFlag=true;setTimeout(function(){kJ._d.dragReqFlag=false},cO.DRAG_REQ_FREQUENCE);var kE;var kL=jy.convertLL2MC(kG.getPosition());var e=i.getZoom();var kI=kG.curNo;var kK=kJ._opts.policy;if(typeof kC!=="undefiend"&&typeof kH!=="undefined"){var kD=kJ._d.viaPts[kC];kD=jy.convertLL2MC(kD);var kF=kJ._d.viaPts[kH];kF=jy.convertLL2MC(kF);kE={qt:iC,pt:kL.lng+","+kL.lat,sn:kD.lng+","+kD.lat,en:kF.lng+","+kF.lat,r:5000,st:1,et:1,sy:kK,l:e}}else{if(kI===0){var kF=kJ._d.viaPts[kI+1];kF=jy.convertLL2MC(kF);kE={qt:iC,pt:kL.lng+","+kL.lat,sn:"",en:kF.lng+","+kF.lat,r:5000,st:1,et:1,sy:kK,l:e}}else{if(kI===this._d.viaPts.length-1){var kD=kJ._d.viaPts[kI-1];kD=jy.convertLL2MC(kD);kE={qt:iC,pt:kL.lng+","+kL.lat,sn:kD.lng+","+kD.lat,en:"",r:5000,st:1,et:1,sy:kK,l:e}}else{var kD=kJ._d.viaPts[kI-1];kD=jy.convertLL2MC(kD);var kF=kJ._d.viaPts[kI+1];kF=jy.convertLL2MC(kF);kE={qt:iC,pt:kL.lng+","+kL.lat,sn:kD.lng+","+kD.lat,en:kF.lng+","+kF.lat,r:5000,st:1,et:1,sy:kK,l:e}}}}var T={curDragMkr:kG,map:i,stNo:kC,edNo:kH};kl.request(function(kN,kM){kJ._requestDraggingCbk(kN,kM)},kE,T)},_requestDraggingCbk:function(kL,T){var kH=this;if(kL&&kL.content){kH._d.cbkDragPt=bP.parseGeo(kL.content["dragpt"],true).point;var kK;var i=T.map;var kD=T.stNo;var kF=T.edNo;var kE=T.curDragMkr;var kG=kE.curNo;if(typeof kD!=="undefiend"&&typeof kF!=="undefined"){kK=bP.parseGeoExt(kL.content["geo"]).points}else{if(kG===0){kK=bP.parseGeo(kL.content["geo"],true).points;kH._d.cbkStartPoiName=kL.content["name"]?kL.content["name"]:"起点"}else{if(kG===kH._d.viaPts.length-1){kK=bP.parseGeo(kL.content["geo"],true).points;kH._d.cbkEndPoiName=kL.content["name"]?kL.content["name"]:"终点"}else{kK=bP.parseGeoExt(kL.content["geo"]).points}}}if(kK){kH._clearOldLine(kG,i,kD,kF);if(kH._d.cbkPly){kH._d.cbkPly.setPath(kK)}else{var kI=kH._results.getPlan(0);var kJ=kI.getRoute(0);kH._d.cbkPly=fQ.addRoute(i,kK,kJ.getRouteType())}}var e=kL.content["name"]?kL.content["name"]:"未知路段";kH._d.cbkDragPt.name=e;var kC="("+i6(kL.content["dis"])+")";kH._d.tipLbl&&kH._d.tipLbl.show();kH._d.tipLbl&&kH._d.tipLbl.setContent(e+kC)}},_clearOldLine:function(kF,kG,kE,T){for(var kD=0,e=this._d.dragOverlays.length;kD<e;kD++){var kC=this._d.dragOverlays[kD];if(kC instanceof f8){if(typeof kE!=="undefiend"&&typeof T!=="undefined"){if(kC.stNo===kE&&kC.edNo===T){kG.removeOverlay(kC);break}}else{if(kC.stNo===kF||kC.edNo===kF){kG.removeOverlay(kC)}}}}if(this._hlRoute){this._hlRoute.hide()}},_select:function(T){var kF=this._curIndex;var kD=this._opts.renderOptions;if(kD.panel){var kE=kD.panel.getElementsByTagName("table");var kK=kE[kE.length-1];var kH=kK.getElementsByTagName("tr");if(kF-1>=0&&kH[kF-1]){kH[kF-1].style.background=""}if(T-1>=0&&kH[T-1]){kH[T-1].style.background="#f0f0f0"}}var kO=kD.map;if(kO){var e=this._results.getPlan(0);var kM=e.getRoute(0);var kQ=this._getAllStepCount();var kP=this;kO.closeInfoWindow();if(T===0||T===kQ+1){var kL=T===0?this._results.getStart():this._results.getEnd();var i=fQ.createTransInfoWnd({content:"<b>"+kL.title+"</b>",total:kQ,curIndex:T,nextTransCbk:function(kR){kP._select(kR)},hideStep:(kD.highlightMode===BMAP_HIGHLIGHT_STEP?false:true)});i.addEventListener("open",function(){kP._triggerCbk(aK.CBK_INFO_HTML_SET,kL,fQ.getInfoWindowDom(kO))});i.addEventListener("close",function(){if(kP._opts.renderOptions.panel){var kS=kD.panel.getElementsByTagName("table");var kT=kS[kS.length-1];if(kT){var kR=kT.getElementsByTagName("tr");if(kP._curIndex-1>=0&&kR[kP._curIndex-1]){kR[kP._curIndex-1].style.background=""}}}kP._curIndex=-1});var kN=T===0?0:1;var kP=this;if(kO.config.enableStreetEntrance&&false){PanoramaEntranceUtil.insearchPanoEntranceInInfoWnd(i,kO.getCurrentCity().code,{panoInstance:kO._pano,lngLat:kL.point,titleTip:kL.title,type:"busline",beforeDomId:"trans_nav"},function(){kP._overlays[kN].openInfoWindow(i)})}else{kP._overlays[kN].openInfoWindow(i)}if(this._hlRoute){this._hlRoute.hide()}}else{var kJ=kD.highlightMode;if(kJ===BMAP_HIGHLIGHT_STEP){var kC=this._getCurStep(T-1);var i=fQ.createTransInfoWnd({content:kC.getDescription()?kC.getDescription(false):kC.instructions,total:kQ,curIndex:T,nextTransCbk:function(kR){kP._select(kR)}});i.addEventListener("open",function(){kP._triggerCbk(aK.CBK_INFO_HTML_SET,kC,fQ.getInfoWindowDom(kO))});i.addEventListener("close",function(){if(kP._opts.renderOptions.panel){var kS=kD.panel.getElementsByTagName("table");var kT=kS[kS.length-1];if(kT){var kR=kT.getElementsByTagName("tr");if(kP._curIndex-1>=0&&kR[kP._curIndex-1]){kR[kP._curIndex-1].style.background=""}}}kP._curIndex=-1});var kI=kC.getPosition?kC.getPosition():kC.pathPoints[kC.pathPoints.length-1];var kP=this;if(kO.config.enableStreetEntrance&&false){PanoramaEntranceUtil.insearchPanoEntranceInInfoWnd(i,kO.getCurrentCity().code,{panoInstance:kO._pano,lngLat:kI,titleTip:kC.getDescription?kC.getDescription(false):kC.instructions,type:"driving",beforeDomId:"trans_nav"},function(){kO.openInfoWindow(i,kI)})}else{kO.openInfoWindow(i,kI)}}else{if(kJ===BMAP_HIGHLIGHT_ROUTE){if(T===1&&!this._opts._enableTraffic){var kC=this._getCurStep(0);kO.setCenter(kC.getPosition?kC.getPosition():kC.pathPoints[kC.pathPoints.length-1]);if(kD.autoViewport){kO.setZoom(17)}if(this._hlRoute){this._hlRoute.hide()}}else{if(this._segPolylinePoints[T-1]){if(!this._hlRoute){this._hlRoute=fQ.addRoute(kO,this._segPolylinePoints[T-1],kM.getRouteType()+2)}else{this._hlRoute.setPath(this._segPolylinePoints[T-1]);this._hlRoute.show()}if(kD.autoViewport){var kG=kO.getViewport(this._hlRoute.getBounds());if(kG.zoom>17){kG.zoom=17}kO.setViewport(kG)}}}}}}}this._curIndex=T},_toggle:function(){var i=this._opts.renderOptions;if(i.panel){var e=e9.getElementsByClassName(i.panel,"navtrans-res");if(e&&e.length>0){e=e[0];if(e&&e.style.display==="none"){e.style.display=""}else{e.style.display="none"}}var T=e9.getElementsByClassName(i.panel,"navtrans-view");if(T&&T.length>0){T=T[0];e9.toggleClass(T,"expand")}}},_clearOverlays:function(){var kC=this._opts.renderOptions.map;if(!kC){return}for(var T=0,e=this._overlays.length;T<e;T++){kC.removeOverlay(this._overlays[T]);this._overlays[T]=null}this._overlays.length=0;kC.removeOverlay(this._hlRoute);this._hlRoute=null;if(this._d){if(this._d.sliderMkr){kC.removeOverlay(this._d.sliderMkr);this._d.sliderMkr=null}if(this._d.tipLbl){kC.removeOverlay(this._d.tipLbl);this._d.tipLbl=null}for(var T=0,e=this._d.dragOverlays.length;T<e;T++){kC.removeOverlay(this._d.dragOverlays[T]);this._d.dragOverlays[T]=null}this._d.dragOverlays.length=0;if(this._d.cbkPly){kC.removeOverlay(this._d.cbkPly);this._d.cbkPly=null}for(var T=0,e=this._d.cxtMenu.length;T<e;T++){kC.removeContextMenu(this._d.cxtMenu[T]);this._d.cxtMenu[T]=null}this._d.cxtMenu.length=0;this._d.mouseOnViaMkr=false}},_delVia:function(T){if(this._results){var i=this._results.getStart();var e=this._results.getEnd();this._d.viaPts.splice(T,1);this._stopDragging();this._dragSearch(i,e)}},_renderList:function(){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&this._results&&this._results.getNumPlans()>0){var kD=this._results.getPlan(0);var kM=b6("div",{style:"font:12px "+E.fontFamily+";background:#fff"});var kC=this._d.viaPtsInfo;var e=kC.length;var kI=[];var kG="";switch(this.QUERY_TYPE){case aR:kG="驾车";break;case hU:kG="骑行";break;case iv:kG="步行";break}var kS=j9._genResultTitle(this._results.getEnd().title,kG,e>0);if(e>0){kI.push("<table style=\'width:100%;margin-left:4px;font:12px "+E.fontFamily+";border-collapse:collapse\' cellpadding=\'0\' cellspacing=\'0\' border=\'0\'>");for(var kP=0;kP<e;kP++){kI.push("<tr>");if(kP===0){if(e===1){kI.push(\'<td style="padding:2px 5px;line-height:20px">途经点</td>\')}else{kI.push(\'<td valign="top" rowspan="\'+e+\'" style="padding:2px 5px;line-height:18px">途经点</td>\')}}kI.push(\'<td style="padding:2px 5px;line-height:20px">\'+kC[kP].title+"</td>");kI.push(\'<td style="padding:2px 10px;line-height:20px;cursor:pointer;color:#0000ff" onclick=\\\'BMapGL.I("\'+this.hashCode+\'")._delVia(\'+kC[kP]["curNo"]+")\'>删除</td>");kI.push("</tr>")}kI.push("</table>")}var kQ=j9._genTitle(this._results.getStart().title,\'BMapGL.I("\'+this.hashCode+\'")._select(0)\',0);var kJ=["<table class=\'navtrans-table\' style=\'width:100%;font:12px "+E.fontFamily+";border-collapse:collapse\' cellpadding=\'0\' cellspacing=\'0\' border=\'0\'>"];var kO=0;for(var kL=0,kH=kD.getNumRoutes();kL<kH;kL++){var kR=kD.getRoute(kL);for(var kP=0,kN=kR.getNumSteps();kP<kN;kP++){var kF="";if(this._curIndex===kO+1){kF=";background:#f0f0f0"}kJ.push(\'<tr style="cursor:pointer\'+kF+\'" onclick=\\\'BMapGL.I("\'+this.hashCode+\'")._select(\'+(kO+1)+")\'>");kJ.push("<td style=\'border-bottom:1px solid #E4E6E7;padding:10px;line-height:20px;\' >"+(this._getCurStep(kO).getDescription?this._getCurStep(kO).getDescription():this._getCurStep(kO)["instructions"])+"</td>");kJ.push("</tr>");kO++}}kJ.push("</table>");var T=j9._genTitle(this._results.getEnd().title,\'BMapGL.I("\'+this.hashCode+\'")._select(\'+(kO+1)+")",1);var kK="<div class=\'navtrans-view expand\' style=\'position:relative;color:#7777cc;background:#e5ecf9;height:53px;overflow:hidden;text-align:right\' onclick=\'BMapGL.I(\\""+this.hashCode+"\\")._toggle()\'><span class=\'suggest-plan\'>推荐</span><div class=\'suggest-plan-des\'>"+kD.getDistance().replace(/(\\d+(?:.\\d+)?)/,"$1 ")+"&nbsp;&nbsp;|&nbsp;&nbsp;"+kD.getDuration().replace(/(\\d+)/,"$1 ")+"</div>";if(this._results.moreResultsUrl){kK+="<a style=\'color:#7777cc;position:absolute;top:5px;right:20px;\' href=\'"+this._results.moreResultsUrl+"\' target=\'_blank\'>到百度地图查看&#187;</a>"}kK+="&nbsp;<span class=\'navtrans-arrow\'></span></div>";var kE="<div class=\'navtrans-res\'>"+kI.join("")+kQ+kJ.join("")+T+"</div>";kM.innerHTML=kS+kK+kE;this._opts.renderOptions.panel.appendChild(kM);this._triggerCbk(aK.CBK_RESULTS_HTML_SET,kM)}},_getRoadName:function(i,e){if(e===""||!e){if(i===9||i===12||i===1||i===16){e=cO.ROAD_TYPE[i]}}return e},_getPoiInfo:function(kE){var e="";var kD=kE.poi;if(kD){var kC=this._getPsType(kD.ps)||"";var i=this._getPwType(kD.pw)||"";var T=kD.pd<((kE.t===13||kE.t===4)?1000:50)?"":"约"+i6(kD.pd)+"后";e=i+kC+"<b>"+kD.pn+"</b>"+T+(kC===""?"":"，")}return e},_getTicInfo:function(i){var e=i.iw;return !i.ic?"":((this._getIwGo(e)||"")+"<b>"+i.ic+"</b>"+(this._getIwTo(e)||""))},_getRoadAct:function(T,i){var e="沿";if(T===0||(!i&&T!==1&&T!==16&&T!==9&&T!==12)){e=""}return e},_getRetAct:function(T,i){var e="进入";if(!i&&(T===9||T===12)){e="上"}else{if(T===0||(!i&&T!==1&&T!==16)){e=""}}return e},_getTaxiFare:function(){if(this._json&&this._json.content&&this._json.content["taxi"]){var kC=this._json.content["taxi"];var e={distance:kC.dis,remark:kC.remark};if(kC.detail[0]){var T=kC.detail[0];e.day={initialFare:parseFloat(T.startPrice),unitFare:parseFloat(T.kmPrice),totalFare:parseFloat(T.totalPrice)}}if(kC.detail[1]){var i=kC.detail[1];e.night={initialFare:parseFloat(i.startPrice),unitFare:parseFloat(i.kmPrice),totalFare:parseFloat(i.totalPrice)}}return e}return null}});e9.extend(i7.prototype,{init_d:function(){if(!this._d){this._d={viaPts:[],dragOverlays:[],multiPolyline:[],tipLbl:null,sliderMkrIcon:null,sliderMkr:null,isSearch:false,isSearchByDrag:false,curDragPly:null,cxtMenu:[],lineLayer:null,showLineLayer:false,distances:{},colorArray:[]}}},_createResults:function(e){delete e.url;return new dr(e)},_asyncSearch:function(){this.init_d();for(var T=0,e=this._queryList.length;T<e;T++){var kC=this._queryList[T];this[kC.method].apply(this,kC.arguments)}delete this._queryList},search:function(){},_rawDataCbk:function(i,e){this._json=i;var T=i.result||{};var kC=i.content||{};this._ud=e;if(T.error!==0){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(aK.CBK_SEARCH_COMPLETE,{})}else{if((kC.status&&kC.status!==0)||(kC.result&&kC.result["routes"]===null)){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(aK.CBK_SEARCH_COMPLETE,{})}else{this._processRaw();this._renderMap()}}},_processRaw:function(){},_renderMap:function(){if(this.map&&this._results){if(!this.isSearchByDrag){this._renderViaMkr()}this._renderPly()}},_clearOverlays:function(){for(var e=0;e<this._overlays.length;e++){this._overlays[e]&&this._overlays[e].remove();this._overlays[e]=null}this._overlays.length=0},_stopDragging:function(){for(var kC=0,e=this._d.dragOverlays.length;kC<e;kC++){var T=this._d.dragOverlays[kC];if(T instanceof ke){T.disableDragging()}}},_renderViaMkr:function(){var T=this._opts.renderOptions.map;var e=this._results.getStart();var kG=this._results.getEnd();var kI=this;this._clearOverlays();var kH=bP.stringToPoints(this._waypoints);var kJ=bP.stringToPoints(this._waypoints);kH.push(kG.point);kH.unshift(e.point);for(var kE=0,kC=kH.length;kE<kC;kE++){var kF=kH[kE];var kD;if(kE===0){kD=fQ.addDestPoi(T,kF,e.title,dA);e.marker=kD;this._overlays.push(kD)}else{if(kE===kH.length-1){kD=fQ.addDestPoi(T,kF,kG.title,ie);kG.marker=kD;this._overlays.push(kD)}else{kD=fQ.addWayPointMkr(T,kF,kE);kD.addEventListener("rightclick",function(i){kI._menu.showOverlayMenu(i,this)});this._overlays.push(kD)}}kD.curNo=kE;if(this._enableDragging){kD.enableDragging();kD.addEventListener("mouseover",function(i){if(kI._d.isSearch){return}if(kI._d.tipLbl){kI._d.tipLbl.setContent("拖动以更改路线");kI._d.tipLbl.show();this.setLabel(kI._d.tipLbl)}else{kI._d.tipLbl=fQ.createTipLbl("拖动以更改路线");this.setLabel(kI._d.tipLbl)}});kD.addEventListener("mouseout",function(i){this.getLabel()&&this.getLabel().hide()});kD.addEventListener("dragging",kI.throttle(function(i){kI.isSearchByDrag=true;var kN=JSON.parse(JSON.stringify(kI._searchOpts));var kK=this.curNo;var kM=e.point;var kL=kG.point;if(i.target.curNo>0&&i.target.curNo<kH.length-1){kJ[kK-1]=i.latLng;kN.waypoints=bP.pointsToString(kJ)}if(i.target.curNo===0){kM=i.latLng}if(i.target.curNo===kH.length-1){kL=i.latLng}kI.search(kM,kL,kN)},500));kD.addEventListener("dragend",function(i){kI.isSearchByDrag=false;var kK=this.curNo;if(i.target.curNo>0&&i.target.curNo<kH.length-1){kJ[kK-1]=i.latLng;kI._searchOpts.waypoints=bP.pointsToString(kJ);kI._overlays.push(i.target)}if(i.target.curNo===0){e.point=i.latLng}if(i.target.curNo===kH.length-1){kG.point=i.latLng}kI._stopDragging();kI.search(e.point,kG.point,kI._searchOpts)})}this._d&&this._d.dragOverlays&&this._d.dragOverlays.push(kD)}this._triggerCbk(aK.CBK_MARKERS_SET,this._overlays)},setPlan:function(e){this._renderPly(e)},_renderPly:function(kH){var T=this._opts.renderOptions.map;if(!(kH instanceof gW)){kH=this._results.getPlan(0)}this.plan=kH;var kJ=[];var e=kH.plan2Polyline()||[];var kI=new bu(e);var kK=kI.getBounds();kJ.push(kK.getSouthWest());kJ.push(kK.getNorthEast());var kE=kH.plan2LineLayerData();if(this._lineLayerStyle.showTraffic){for(var kF=0;kF<kE.trafficConditionData.length;kF++){var kC=kE.trafficConditionData[kF];var kD;var kG;if(this._lineLayerStyle.lineLayerColor[kC.status]){kD=this._lineLayerStyle.lineLayerColor[kC.status].color;kG=this._lineLayerStyle.lineLayerColor[kC.status].opacity}else{kD=fQ.ROUTE_TRAFFIC_STYLE_CONFIG[kC.status].color;kG=fQ.ROUTE_TRAFFIC_STYLE_CONFIG[kC.status].opacity}this._d.distances[kF]=kC.distance;this._d.colorArray[kF]="rgba("+hW.parseHexAndOpacityToRgbaArray(kD,kG).join(",")+")"}}else{var kD;var kG;for(var kF=0;kF<kE.trafficConditionData.length;kF++){var kC=kE.trafficConditionData[kF];if(Array.isArray(this._lineLayerStyle.lineLayerColor)){kD=this._lineLayerStyle.lineLayerColor[0].color;kG=this._lineLayerStyle.lineLayerColor[0].opacity}else{kD=this._lineLayerStyle.lineLayerColor.color;kG=this._lineLayerStyle.lineLayerColor.opacity}this._d.distances[kF]=kC.distance;this._d.colorArray[kF]="rgba("+hW.parseHexAndOpacityToRgbaArray(kD,kG).join(",")+")"}}if(this._d.lineLayer){this._d.lineLayer.setData(kE.geoMultiLineData)}else{this._initLineLayer(this._d.distances,this._d.colorArray);this._d.lineLayer.setData(kE.geoMultiLineData)}if(!this._d.showLineLayer){T.addNormalLayer(this._d.lineLayer);this._d.showLineLayer=true}if(this._opts.renderOptions.autoViewport){T.setViewport(kJ,{margins:[30,30,30,30]})}this._triggerCbk(aK.CBK_POLYLINES_SET,kH._routes)},_deleteVia:function(T){var i=this._results.getStart();var e=this._results.getEnd();var kC=bP.stringToPoints(this._waypoints);kC.splice(T,1);this._searchOpts.waypoints=bP.pointsToString(kC);this.search(i.point,e.point,this._searchOpts)},_initDragMarker:function(e){var T=this;var kC=0;var i=fQ.addDragMkr(this.map,e);i.addEventListener("dragstart",function(kD){kC=T._getWayPointIndex(kD.latLng);console.log("dragstart",kD,"wayPointIndex",kC)});i.addEventListener("dragging",T.throttle(function(kG){console.log("dragging",kG);var kH=JSON.parse(JSON.stringify(T._searchOpts));T.isSearchByDrag=true;var kE=T._results.getStart();var kD=T._results.getEnd();var kF=bP.stringToPoints(T._waypoints);kF.splice(kC,0,kG.latLng);kH.waypoints=bP.pointsToString(kF);T.search(kE.point,kD.point,kH)},500));i.addEventListener("dragend",function(kG){i.hide();T.isSearchByDrag=false;var kE=T._results.getStart();var kD=T._results.getEnd();console.log("dragend",kG);var kF=bP.stringToPoints(T._waypoints);kF.splice(kC,0,kG.latLng);T._searchOpts.waypoints=bP.pointsToString(kF);T.search(kE.point,kD.point,T._searchOpts)});i.enableDragging();this._d.sliderMkr=i;return i},_initLineLayer:function(e,kC){var T=this;var i=E.bosPath+"up-to.png";lineLayer=new b1({zIndex:99,enablePicked:true,pickWidth:15,pickHeight:15,opacity:1,selectedColor:"blue",style:{traceControl:function(kE){var kD=[];kE.forEach(function(kF){kD.push(0)});return kD},traceColor:[239,239,200],linksLine:true,strokeColorControl:function(kD,kE){return T._d.colorArray[kE]},sequence:this._lineLayerStyle.sequence,marginLength:this._lineLayerStyle.marginLength,borderColor:this._lineLayerStyle.borderColor,borderMask:this._lineLayerStyle.borderMask,borderWeight:this._lineLayerStyle.borderWeight,strokeWeight:this._lineLayerStyle.strokeWeight,strokeLineJoin:this._lineLayerStyle.strokeLineJoin,strokeLineCap:this._lineLayerStyle.strokeLineCap,strokeTextureUrl:this._lineLayerStyle.strokeTextureUrl,strokeTextureWidth:this._lineLayerStyle.strokeTextureWidth,strokeTextureHeight:this._lineLayerStyle.strokeTextureHeight,}});lineLayer.addEventListener("mousemove",function(kG){var kF=bP.stringToPoints(T._waypoints);if(T._enableDragging&&kF.length<18&&!T.isSearchByDrag){var kE=T._opts.renderOptions.map.getZoomUnits();var kD=T.pointNearbyToPoints(kG.latLng,30,kE);if(kG.value.dataIndex!==-1&&kG.value.dataItem&&!kD){if(T._d.sliderMkr){T._d.sliderMkr.setPosition(kG.latLng);T._d.sliderMkr.show()}else{T._initDragMarker(kG.latLng)}}else{if(T._d.sliderMkr){T._d.sliderMkr.hide()}}}});this._d.lineLayer=lineLayer;return lineLayer},_getWayPointIndex:function(kI){var kF=this.plan;var e=kF.plan2MultiPolyline();var kD=this._opts.renderOptions.map.getZoomUnits();var kG=[];for(var kC=0;kC<e.length;kC++){var kH=new BMapGL.Polyline(e[kC]);var T=kH.getBounds();if(T.containsPoint(kI)){kG.push({legIndex:kC,polyline:kH})}}if(!kG.length){return -1}else{if(kG.length===1){return kG[0].legIndex}else{for(var kC=0;kC<kG.length;kC++){var kJ=kG[kC];var kE=this.pointNearbyToLine(kI,kJ.polyline,20,kD);if(kE){return kJ.legIndex}}}}return -1},hideRoute:function(){this._d.showLineLayer=false;this.map.removeNormalLayer(this._d.lineLayer);this._clearOverlays()},showRoute:function(){if(this.map&&this._results){this._renderPly(this.plan);this._renderViaMkr()}},clearResults:function(){delete this._results;delete this._ud;delete this._json;delete this._boundsPoints;this._d.showLineLayer=false;this.map.removeNormalLayer(this._d.lineLayer);this._clearOverlays()},setResults:function(e){if(e instanceof dr){this._results=e}},pointNearbyToLine:function(e,kC,i,T){var kE=i*T;var kD=this.pointToLineDistance(e,kC);if(kD<kE){return true}return false},pointNearbyToPoints:function(kK,kD,kI){var kG=kD*kI;var e=this._results.getStart();var kH=this._results.getEnd();var kJ=bP.stringToPoints(this._waypoints);var kF=jy.convertLL2MC(kK);kJ.push(kH.point);kJ.unshift(e.point);for(var kE=0;kE<kJ.length;kE++){var kC=jy.convertLL2MC(kJ[kE]);var T=eF(kF,kC);if(T<kG){return true}}return false},pointToLineDistance:function(e,kC){var kF=jy.convertLL2MC(e);var T=kC.getPathIn();var kG=Infinity;for(var kE=0;kE<T.length-1;kE++){var kD=fV(kF,T[kE],T[kE+1]);if(kG>kD){kG=kD}}return kG},throttle:function(T,e){var kC=null;var i=Date.now();return function(){var kG=Date.now();var kF=e-(kG-i);var kE=this;var kD=arguments;if(kC){clearTimeout(kC)}if(kF<=0){T.apply(kE,kD);i=Date.now()}else{}}},});cz.TURN_TYPE=["","直行","右前方转弯","右转","右后方转弯","调头","左后方转弯","左转","左前方转弯","靠左","直行","靠右","正北方向","东北方向","正东方向","东南方向","正南方向","西南方向","正西方向","西北方向"];cz.RET_TYPE=["","从起点出发","到达目的地","途经点","行驶"];cz.TURN_ICON_CLASS=["s-1","s-1","s-2","s-3","s-4","s-5","s-6","s-7","s-8","s-9","s-1","s-10","","","","","","","",""];cz.IWGO=["在","从","从"];cz.IWTO=["","","离开"];cz.PWTYPE=["过","在"];cz.PSTYPE=["左侧的","右侧的",""];cz.DWTYPE=["","朝"];e9.extend(cz.prototype,{_createResults:function(e){return new ih(e)},_getTurnType:function(e){return cz.TURN_TYPE[e]},_getTurnIcon:function(T){var i="navtrans-navlist-icon "+(cz.TURN_ICON_CLASS[T]?cz.TURN_ICON_CLASS[T]:"");var e=\'<span class="\'+i+\'"></span>\';return e},_getRetType:function(e){return cz.RET_TYPE[e]},_getIwGo:function(e){return cz.IWGO[e]},_getIwTo:function(e){return cz.IWTO[e]},_getPwType:function(e){return cz.PWTYPE[e]},_getPsType:function(e){return cz.PSTYPE[e]},_getDwType:function(e){return cz.DWTYPE[e]}});e9.extend(gf.prototype,{_createResults:function(e){return new ih(e)},search:function(kD,i,kC){this._d.isSearch=true;var kC=kC||{};var e={start:kD,end:i};kC.qt=ki;if(kC.waypoints instanceof Array){kC.waypoints=bP.pointsToString(kC.waypoints)}kC.waypoints=kC.waypoints||"";kC.origin=this._formatDestQuery30(kD);kC.destination=this._formatDestQuery30(i);kC.mode="driving";kC.output="json";kC.tactics=this._opts.policy||0;kC.ret_coordtype=this._getCoordType();kC.coord_type=this._getCoordType();e.policy=kC.tactics;if(!this.isSearchByDrag){this._searchOpts=kC;this._waypoints=kC.waypoints}if(j9.prototype.search.call(this,kD,i)===true){var T=this;this._getIdByLoc(this._loc,function(kF){kF=kF||1;var kE={};for(key in kC){kE[key]=kC[key]}kl.request(function(kH,kG){T._rawDataCbk(kH,kG);T._d.isSearch=false},kE,e)})}},_processRaw:function(){var k7=this;var k5=this._json.content;var kV=k5.result;var kJ={};var kH={};if(typeof this._ud.start==="object"&&!(this._ud.start instanceof cG||this._ud.start instanceof PointN)){gY.extend(kJ,this._ud.start)}else{kJ.title="起点";kJ.point=new cG(kV.routes[0]["origin"]["lng"],kV.routes[0]["origin"]["lat"])}if(typeof this._ud.end==="object"&&!(this._ud.end instanceof cG||this._ud.start instanceof PointN)){gY.extend(kH,this._ud.end)}else{kH.title="终点";kH.point=new cG(kV.routes[0]["destination"]["lng"],kV.routes[0]["destination"]["lat"])}var kP=k5.result["routes"];var k3=[];this._boundsPoints=[];for(var k0=0;k0<kP.length;k0++){var kN=kP[k0];var kI=kN.distance;var kC=kN.duration;var kE=kN.toll;var T=kN.toll_distance;var k1=kN.steps;var kQ=0;var k6=[];var k4=[];var kZ=[];var kO=[];var kL=[];for(var kY=0;kY<k1.length;kY++){var kT=k1[kY];var kW=new cG(kT.start_location["lng"],kT.start_location["lat"]);var kU=kY;var kK="";var k2=kT.distance;var kM=new dX({point:kW,index:kU,description:kK,distance:k2});k4.push(kM);var kG=[];kG=kG.concat(bP.pathToPoints(kT.path));kZ=kZ.concat(kG);var kR={title:"起点",point:new cG(kT.start_location["lng"],kT.start_location["lat"])};var kF={title:"终点",point:new cG(kT.end_location["lng"],kT.end_location["lat"])};var kX=new cG(0,0);if(kT.toll_gate_location){kX=new cG(kT.toll_gate_location.lng,kT.toll_gate_location.lat)}var kS={distance:kT.distance,direction:kT.direction,legIndex:kT.leg_index,duration:kT.duration,adcodes:kT.adcodes,roadName:kT.road_name,tollGateName:kT.toll_gate_name,tollGateLocation:kX,points:kG,stops:[kR,kF],trafficCondition:kT.traffic_condition};kO.push(kS);kL.push(kS)}var e=new dP({steps:k4,distance:kI,index:0,points:kZ,rt:this.ROUTE_TYPE});k6.push(e);var kD=new de({routes:k6,lines:kO,total:kL,distance:kI,duration:kC,toll:kE,tollDistance:T});k3.push(kD)}this._results=new ih({plans:k3,_start:kJ,_end:kH,start:kJ,end:kH,url:"",waypoints:this._searchOpts.waypoints||[]});this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(aK.CBK_SEARCH_COMPLETE,this._results);return},});fC.TURN_TYPE=["","直走","向右前方转","右转","向右后方转","向后转","向左后方转","左转","向左前方转","左转穿过马路并继续向前","右转穿过马路并继续向前","左转穿过马路并往回走","右转穿过马路并往回走","正北方向","东北方向","正东方向","东南方向","正南方向","西南方向","正西方向","西北方向","","","",""];fC.TURN_ICON_CLASS=["s-1","s-1","s-2","s-3","s-4","s-5","s-6","s-7","s-8","s-7","s-3","s-7","s-3","","","","","","","","","","","",""];fC.RET_TYPE=["","从起点出发","到达目的地","途经点","走"];fC.IWGO=["在","从","从"];fC.IWTO=["","","离开"];fC.PWTYPE=["过","在"];fC.PSTYPE=["左侧的","右侧的",""];fC.DWTYPE=["","朝"];e9.extend(fC.prototype,{_createResults:function(e){delete e.url;return new t(e)},_getTurnType:function(e){return fC.TURN_TYPE[e]},_getTurnIcon:function(T){var i="navtrans-navlist-icon "+(fC.TURN_ICON_CLASS[T]?fC.TURN_ICON_CLASS[T]:"");var e=\'<span class="\'+i+\'"></span>\';return e},_getRetType:function(e){return fC.RET_TYPE[e]},_getIwGo:function(e){return fC.IWGO[e]},_getIwTo:function(e){return fC.IWTO[e]},_getPwType:function(e){return fC.PWTYPE[e]},_getPsType:function(e){return fC.PSTYPE[e]},_getDwType:function(e){return fC.DWTYPE[e]}});e9.extend(dd.prototype,{_createResults:function(e){delete e.url;return new fw(e)}});Z.trafficCondition=["缺失","畅通","注意缓行","拥堵","严重拥堵"];e9.extend(Z.prototype,{_createResults:function(e){delete e.url;return new b2(e)},search:function(kC,e,T){this._d.isSearch=true;var T=T||{};if(T.waypoints instanceof Array){T.waypoints=bP.pointsToString(T.waypoints)}T.waypoints=T.waypoints||"";T.vehicle_usages=T.vehicle_usages||0;T.avoid_type=T.avoid_type||0;T.disable_ferry=T.disable_ferry||0;if(!this.isSearchByDrag){this._searchOpts=T;this._waypoints=T.waypoints}if(!(kC instanceof cG&&e instanceof cG)){return}if(j9.prototype.search.call(this,kC,e)===true){var i=this;this._getIdByLoc(this._loc,function(kF){kF=kF||1;var kE={};kE.qt=ca;for(key in T){kE[key]=T[key]}kE.output="json";var kD={start:kC,end:e};kE.origin=kC.lat+","+kC.lng;kE.destination=e.lat+","+e.lng;kl.request(function(kH,kG){i._rawDataCbk(kH,kG);i._d.isSearch=false},kE,kD)})}},_processRaw:function(){var k0=this;var kY=this._json.content;var kS=kY.result;var kI={};var kG={};if(typeof this._ud.start==="object"&&!(this._ud.start instanceof cG||this._ud.start instanceof PointN)){gY.extend(kI,this._ud.start)}else{kI.title="起点";kI.point=new cG(kS.routes[0]["origin"]["lng"],kS.routes[0]["origin"]["lat"])}if(typeof this._ud.end==="object"&&!(this._ud.end instanceof cG||this._ud.start instanceof PointN)){gY.extend(kG,this._ud.end)}else{kG.title="终点";kG.point=new cG(kS.routes[0]["destination"]["lng"],kS.routes[0]["destination"]["lat"])}var kN=kY.result["routes"];var kX=[];this._boundsPoints=[];for(var kV=0;kV<kN.length;kV++){var kK=kN[kV];var kH=kK.distance;var T=kK.duration;var kD=kK.toll;var e=kK.toll_distance;var kM=kK.oil_cost;var kW=kK.steps;var kO=0;var kZ=[];var kL=[];var kJ=[];for(var kU=0;kU<kW.length;kU++){var kR=kW[kU];var kF=[];kZ.push({});kF=kF.concat(bP.pathToPoints(kR.path));var kP={title:"起点",point:new cG(kR.start_location["lng"],kR.start_location["lat"])};var kE={title:"终点",point:new cG(kR.end_location["lng"],kR.end_location["lat"])};var kT=new cG(0,0);if(kR.toll_gate_location){kT=new cG(kR.toll_gate_location.lng,kR.toll_gate_location.lat)}var kQ={distance:kR.distance,direction:kR.direction,legIndex:kR.leg_index,duration:kR.duration,adcodes:kR.adcodes,roadName:kR.road_name,tollGateName:kR.toll_gate_name,tollGateLocation:kT,points:kF,stops:[kP,kE],trafficCondition:kR.traffic_condition};kL.push(kQ);kJ.push(kQ)}var kC=new cM({routes:kZ,lines:kL,total:kJ,distance:kH,duration:T,toll:kD,tollDistance:e,oilCost:kM,});kX.push(kC)}this._results=new b2({plans:kX,_start:kI,_end:kG,start:kI,end:kG,url:"",waypoints:this._searchOpts.waypoints||[]});this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(aK.CBK_SEARCH_COMPLETE,this._results);return},});var eb=new jo(9,0);var jf=new jo(300,300);e9.extend(hz.prototype,{render:function(kH){window.RouteAddrInst=this;var kE={};var kS=this.json;this.endIndex=1;var kC=this.endIndex;var kM=[];var kQ=[];var kV=["sel_n","sel_n1","sel_y","sel_x","sel_x1"];var kT=[-1,-1];var kN=[];var kQ=[];var kJ=kS.content["result"];this.tpCity=[kJ.originInfo["area_id"],kJ.destinationInfo["area_id"]];tempCode=kJ.originInfo["area_id"];for(var kO=0;kO<kC+1;kO++){var kI=null;kM.push([]);kN.push("");kQ.push("");if(kO==0){if(kJ.originInfo){this.tpCity[0]=kJ.originInfo["area_id"];tempCode=this.tpCity[0]}}else{if(kJ.destinationInfo){this.tpCity[kO]=kJ.destinationInfo["area_id"];tempCode=this.tpCity[kO]}}kI=this.getCurPoint30(kO);if(kI.length>0){kQ[kO]=\'<a href="javascript:void(0)" ></a>\';kM[kO].push(\'<div id="RADiv_ResItem\'+kO+\'" class="sel_body_body_div sel_body_resitem">\');var kG=[0,9];if(kI.length<10){kG[1]=kI.length-1}kM[kO].push(this.makeListTable(kO,kG));if(kI.length>10){kM[kO].push(\'<div id="RADiv_PAGE\'+kO+\'" style="height:20px;" class="sel_body_body_page"></div>\');this.totalPage[kO]=Math.ceil(kI.length/10);this.curPageIndex[kO]=1}kM[kO].push("</div>");if(kI.length===1){kT[kO]=2;this.qInfo[kO]["n"]=kI[0]["name"];this.qInfo[kO]["c"]=tempCode;this.qInfo[kO]["u"]=kI[0]["uid"];var e=new cG(kI[0]["location"]["lng"],kI[0]["location"]["lat"]);var kW=e;this.qInfo[kO]["point"]=e;this.qInfo[kO]["x"]=kW.lng;this.qInfo[kO]["y"]=kW.lat;this.qInfo[kO]["t"]=BMAP_POI_TYPE_NORMAL;var kL=this.addPointMarker(this._opts.renderOptions.map,kW,kI[0]["name"],kO);this.markerDest=kL;this.locPois.push(kL.point);kN[kO]=kI[0]["name"]}else{kT[kO]=0}}}var kD;var T;var kK=false;var kR=false;for(var kP=0,kF;kP<kT.length;kP++){kF=kT[kP];if(kD){if(kF==0||kF==3){kT[kP]=kF+1}}else{if(kF==0&&!T){this.curPointIndex=kP;T=kP+1;continue}if(T&&kF==0){kT[kP]=1}}}kE.startPointClass=kV[kT[0]];this.startName=kJ.originInfo["wd"];if(kN[0]==""){kE.startPoint=this.startName}else{kE.startPoint=kN[0]}kE.startBody=kM[0].join("");kE.endPointClass=kV[kT[kC]];this.endName=kJ.destinationInfo["wd"];if(kN[kC]==""){kE.endPoint=this.endName}else{kE.endPoint=kN[kC]}kE.endBody=kM[kC].join("");kE.startButton=kQ[0];kE.endIndex=kC;kE.endButton=kQ[kC];this.tpName=[];var kU=[""];kE.tpList=kU.join("");return this.template(kE)},bindEvent:function(){var i,e;if(e9.G("RouteAddress_DIV0")){i=e9.G("RouteAddress_DIV0").getElementsByTagName("tr");this.routDivTrBindFun(i)}if(e9.G("RouteAddress_DIV1")){e=e9.G("RouteAddress_DIV1").getElementsByTagName("tr");this.routDivTrBindFun(e)}var kD=this;if(this.infoWindow){this.infoWindow.addEventListener("open",function(){var kE=e9.G("selInfoWndBtn");e9.on(kE,"click",function(){var kF=kE.getAttribute("data-uid").split("_");kD.itmSelect(kF[0],kF[1])});e9.on(kE,"mouseover",function(){kD._selBtnOver(kE)});e9.on(kE,"mousedown",function(){kD._selBtnDown(kE)});e9.on(kE,"mouseout",function(){kD._selBtnOut(kE)})})}var kC,T;if(e9.G("RouteAddress_DIV0")){kC=e9.G("RouteAddress_DIV0").firstChild.firstChild;e9.on(kC,"click",function(kF){var kE=kC.getAttribute("data-uid");kD.showLst(kE)})}if(e9.G("RouteAddress_DIV1")){T=e9.G("RouteAddress_DIV1").firstChild.firstChild;e9.on(T,"click",function(kF){var kE=T.getAttribute("data-uid");kD.showLst(kE)})}},routDivTrBindFun:function(i){var e=this;this.each(i,function(T,kC){e9.on(kC,"mouseover",function(kF){var kG=kC.getAttribute("data-uid").split("_");var kE=parseInt(kG[0],10);n2=parseInt(kG[1],10);jN=parseInt(kG[2],10);e._lstMouseOver(this,0,kG[0],jN-n2,kF)});e9.on(kC,"mouseout",function(kF){var kG=kC.getAttribute("data-uid").split("_");var kE=parseInt(kG[0],10);n2=parseInt(kG[1],10);jN=parseInt(kG[2],10);e._lstMouseOut(this,0,kG[0],jN-n2,kF)});e9.on(kC,"click",function(kF){var kG=kC.getAttribute("data-uid").split("_");var kE=parseInt(kG[0],10);n2=parseInt(kG[1],10);jN=parseInt(kG[2],10);e.select(kE,jN,kF)});var kD=kC.childNodes[2].getElementsByTagName("div")[0];e9.on(kD,"click",function(kE){var kH=kD.getAttribute("data-uid").split("_"),kG=kH[0],kF=kH[1];e.itmSelect(kG,kF)});e9.on(kD,"onmouseover",function(kE){e._selBtnOver(kD)});e9.on(kD,"onmouseout",function(kE){e._selBtnOut(kD)});e9.on(kD,"onmousedown",function(kE){e._selBtnDown(kD)})})},formatJson30:function(i,e){},parseJson:function(kE,e){if(!kE.content){kE.content={start:[],end:[]}}kE.content["tpList"]=[];if(kE.result.type==19){this.parseQuery(kE,e);var kF=kE.content,kC=[],T=kF.length;kE.content={start:[],end:[]};if(T>2){for(var kD=1;kD<(T-1);kD++){kC.push(kF[kD])}}kE.content["end"]=kF[T-1];kE.content["tpList"]=kC;kE.content["start"]=kF[0]}return kE},parseQuery:function(kN,T){var kL={},kJ=this,e,kC,kH=0,kF=0,kG=[],kI,kO=kN.result,kE=[];kL.city_list=[];kL.count=[];kL.current_null=[];kL.e_query=[];kL.e_wd=[];kL.end_city=[];kL.wd2=[];kL.prio_flag=[];kL.sug_index=[];kL.total=[];kL.s_wd="";kL.s_query="";this.canShowList=[];if(!kO.e_wd){kO.e_wd=[];kO.e_query=[]}e=this.parseOnePosition(T.start);kI=e.type;kL.s_wd=kI==1?e.keyword:kO.s_wd;kL.s_query=kI==1?e.keyword:kO.s_query;if(kI==1){kJ.qInfo[kH].n=kL.s_wd;kJ.qInfo[kH].x=e.point.split(",")[0];kJ.qInfo[kH].y=e.point.split(",")[1]}this.canShowList.push(kI==2);kL.total.push(kI==1?1:kO.total[kF]);kL.count.push(kI==1?1:kO.count[kF]);kL.current_null.push(kI==1?0:kO.current_null[kF]);kL.prio_flag.push(kI==1?1:kO.prio_flag[kF]);kL.sug_index.push(kI==1?"":kO.sug_index[kF]);kG.push(kI==1?[{name:e.keyword,geo:"1|"+e.point+";"+e.point+"|"+e.point+";"}]:kN.content[kF]);kL.city_list.push(kI==1?0:kO.city_list[kF]);kL.wd2.push(kI==1?"":kO.wd2[kF]);if(kI==2){kF++}kH++;kE=decodeURIComponent(T.end).split("to:");for(var kD=0,kM;(kM=kE[kD]);kD++){kM=this.parseOnePosition(kM);kI=kM.type;if(kI==2){if(kM.uid&&kM.point){kI=1}}this.canShowList.push(kI==2);var kK=kI==2?kM.keyword:kF==0?kO.s_wd:kO.e_wd[kF-1];kL.e_wd.push(kK);kL.e_query.push(kK);kL.end_city.push(kI==1?kN.current_city:kF==0?kO.start_city:kO.end_city[kF-1]);if(kI==1){kJ.qInfo[kH].n=kL.s_wd;kJ.qInfo[kH].x=kM.point.split(",")[0];kJ.qInfo[kH].y=kM.point.split(",")[1]}if(kM.if_wp){this.insertTP(kH-1,{query:kL.e_wd[kH-1],addr:kL.wd2[kH],point:kI==1?bP.getPoiPoint(kM.point):null,uid:kM.uid});this.tpListInMap.push({query:kL.e_wd[kH-1],addr:kL.wd2[kH],point:kI==1?bP.getPoiPoint(kM.point):null,uid:kM.uid})}kL.total.push(kI==1?1:kO.total[kF]);kL.count.push(kI==1?1:kO.count[kF]);kL.current_null.push(kI==1?0:kO.current_null[kF]);kL.prio_flag.push(kI==1?1:kO.prio_flag[kF]);kL.sug_index.push(kI==1?"":kO.sug_index[kF]);kG.push(kI==1?[{name:kM.keyword,geo:"1|"+kM.point+";"+kM.point+"|"+kM.point+";"}]:kN.content[kF]);kL.city_list.push(kI==1?0:kO.city_list[kF]);kL.wd2.push(kI==1?"":kO.wd2[kF]);if(kI==2){kF++}kH++}e9.extend(kN.result,kL);kN.content=kG},insertTP:function(e,T){var i=e9.extend({},T);if(this.tpList.length>e){this.tpList[e]=T}else{if(this.tpList.length==e){this.tpList.push(T)}else{return}}this.tpList[e]=i},parseOnePosition:function(i){var i=decodeURIComponent(i),e=i.split("$$");return{type:e[0],uid:e[1],point:e[2],keyword:e[3],if_sug:e[4],keyword2:e[5],fe_xy:e[6],if_wp:e[7]}},getCurPoint30:function(e){var i=[];switch(e){case 0:case"0":i=this.json.content["result"]["origin"]["content"];break;case 1:case"1":i=this.json.content["result"]["destination"]["content"];break}return i},getCurPoint:function(e){return e==0?this.json.content["start"]:(e==this.endIndex?this.json.content["end"]:this.json.content["tpList"][e-1])},makeListTable:function(kE,kD,kC){var kG=this;this.curSelectedIndex=-1;var kH=kC?kC:this.getCurPoint30(kE);var kF=[];kF.push(\'<div id="RA_ResItem_\'+kE+\'"><table border="0" cellspacing="0" cellpadding="0" style="width:100%">\');for(var T=kD[0];T<=kD[1];T++){kF.push(\'<tr  onmouseover="RouteAddrInst._lstMouseOver(this, 0,\'+kE+", "+(T-kD[0])+\', event)" onmouseout="RouteAddrInst._lstMouseOut(this, 0,\'+kE+", "+(T-kD[0])+\', event)" onclick="RouteAddrInst.select(\'+kE+","+T+\', event)"  filter = "item" data-uid="\'+kE+"_"+kD[0]+"_"+T+\'"  ><th><div title="在图上显示该点" class="icon iconbg" id="no_\'+kE+"_"+(T-kD[0]+1)+\'"></div></th>\');var e=(kE==0)?"选为起点":(kE==this.endIndex)?"选为终点":"选为途经点";kF.push(\'<td style="word-break:break-all;padding-right:24px">\');kF.push(\'<a href="javascript:void(0)">\'+kH[T]["name"]+"</a>");if(kH[T]["address"]&&kH[T]["address"]!=""){kF.push("<div>");kF.push(\'<span style="color:#999">地址: \'+kH[T]["address"]+"</span>");kF.push("</div>")}kF.push("</td>");kF.push(\'<td style="vertical-align:middle;width:106px"><div tid="selBtn_\'+kE+"_"+T+\'" class="selBtn"  onclick="RouteAddrInst.itmSelect(\'+kE+","+T+\');return false;" onmouseover="RouteAddrInst._selBtnOver(this)" onmouseout="RouteAddrInst._selBtnOut(this)" onmousedown="RouteAddrInst._selBtnDown(this)" data-uid = "\'+kE+"_"+T+\'"  >\'+e+"</div>");kF.push(\'<a data-uid="\'+kH[T]["uid"]+\'" href="javascript:void(0);" class="list_street_view_poi" style="visibility:hidden"><img src="//map.baidu.com/wolfman/static/common/images/transparent.gif" ></a>\');kF.push("</td>");kF.push("</tr>")}kF.push("</table></div>");return kF.join("")},addPointMarker:function(kD,kC,i,e,T){var kF;if(e==0){kF=fQ.addDestPoi(kD,kC,i,dA)}else{if(e==this.endIndex){kF=fQ.addDestPoi(kD,kC,i,ie)}else{var kE=this.tpListInMap[e-1];kE.point=kC;T&&(kE.uid=T);kF=fQ.addWayPointMkr(kD,kC,e-1)}}this.destList.push(kF);return kF},template:function(i){var T=[];T.push(\'<div class="RouteAddressOuterBkg">\');T.push(\'<div class="RouteAddressTip"><span>请选择准确的起点、途经点或终点</span></div>\');T.push(\'<div class="RouteAddressInnerBkg">\');T.push(\'<div id="pos5" style="display:none"></div>\');T.push(\'<div id="RouteAddress_DIV0" class="\'+i.startPointClass+\'"> \');T.push(\'<div class="sel_body">\');T.push(\'<div class="sel_body_top" data-uid="0" onclick="RouteAddrInst.showLst(0)" >\');T.push(\'<div class="sel_body_title">\');T.push(\'<div class="sel_body_sign"></div>\');T.push(\'<div class="sel_body_name">起点：<b id="B_PointName0">\'+i.startPoint+"</b></div>");T.push("</div>");T.push(\'<div id="RD_TOP_BUT0" class="sel_body_button">\'+i.startButton+"</div>");T.push("</div>");T.push(\'<div class="sel_body_body" id="RADIV_BODY0">\'+i.startBody+"</div>");T.push("</div>");T.push("</div>");T.push(i.tpList);T.push(\'<div id="RouteAddress_DIV\'+i.endIndex+\'" class="\'+i.endPointClass+\'">\');T.push(\'<div class="sel_body">\');T.push(\'<div class="sel_body_top" data-uid=\'+i.endIndex+\' onclick="RouteAddrInst.showLst(\'+this.endIndex+\')" >\');T.push(\'<div class="sel_body_title">\');T.push(\'<div class="sel_body_sign"></div>\');T.push(\'<div class="sel_body_name">终点：<b id="B_PointName\'+i.endIndex+\'">\'+i.endPoint+"</b></div>");T.push("</div>");T.push(\'<div id="RD_TOP_BUT\'+i.endIndex+\'" class="sel_body_button">\'+i.endButton+"</div>");T.push("</div>");T.push(\'<div class="sel_body_body" id="RADIV_BODY\'+i.endIndex+\'">\'+i.endBody+"</div>");T.push("</div>");T.push("</div>");T.push(\'<div id="pos6" style="display:none"></div>\');T.push("</div>");T.push("</div>");var e=T.join("");return e},showLst:function(kK){this.curPointIndex=kK;var kI=this,kJ=[];var kC=kJ.length+1;var kF=this.getCurPoint30(kK);var kG=kI.curPageIndex;var kH=e9.G("RouteAddress_DIV"+kK)["className"];if(kH=="sel_n"||kH=="sel_x"||(this.canShowList&&!this.canShowList[kK])){return}if(kH=="sel_n1"||kH=="sel_y"||kH=="sel_x1"){for(var T=0;T<=kC;T++){var e=e9.G("RouteAddress_DIV"+T);e9.G("B_PointName"+T).innerHTML=this.getCurPoiName(T);if(e.className=="sel_x"){e.className="sel_x1"}else{if(e.className=="sel_n"){e.className="sel_n1"}}}kI.clearMarkers();if(kI.markerDest){for(var T=0;T<kI.destList.length;T++){kI.map.removeOverlay(kI.destList[T])}kI.destList=[];kI.markerDest=null}if(kH=="sel_y"){kI.qInfo[kK]={n:"",c:0,u:0,x:0,y:0,t:-1};kI.resType[kK]=0}var kE=0;if(kK===0){kE=kI.json.content["result"]["origin"].length}else{if(kK===1){kE=kI.json.content["result"]["destination"].length}}if(kE<=0){e9.G("RouteAddress_DIV"+kK)["className"]="sel_x"}else{e9.G("RouteAddress_DIV"+kK)["className"]="sel_n";var kD=(kG[kK]-1)*10+9;if(kF.length<(kD+1)){kD=kF.length-1}kI.addMarkers(kK,[(kG[kK]-1)*10,kD])}}this.curSelectedIndex=-1},_selectIt:function(kI,kE){var kH=this;var kK;if(e9.G("RA_ResItem_"+kI)){kK=e9.G("RA_ResItem_"+kI).childNodes[0]}if(kK){var kG=kK.rows[kE];if(kG){kG.style.backgroundColor="#F4F4F4";var T=kG.getElementsByTagName("td")[1];var kC=T.childNodes[0];kC.style.visibility="visible";var i=kG.getElementsByTagName("th")[0];var kJ=i.childNodes[0];kJ.style.backgroundPosition=-kE*18+"px -166px"}}if(kH.markersList.length>kE){var kF=E.staticHost+"/wolfman/static/common/images/";kF+="markers_new2x_2960fb4.png";var e=new jo(18*kE,166);var kD=new jS(kF,new jo(18,27),{offset:new jo(9,27),imageOffset:e,infoWindowOffset:eb,imageSize:jf,});kH.markersList[kE].setIcon(kD);kH._setTop(kH.markersList[kE],true,true)}},_lstMouseOver:function(kC,T,kF,i,kE){var kD=this._opts.renderOptions.map;if(this.curSelectedIndex!=i){kD.closeInfoWindow();this._selectIt(kF,i)}},_lstMouseOut:function(kC,T,kE,i,kD){if(this.curSelectedIndex!=i){this._unSelectIt(kE,i)}},_unSelectIt:function(kI,kE){var kH=this;var kK=null;if(e9.G("RA_ResItem_"+kI)){kK=e9.G("RA_ResItem_"+kI).childNodes[0]}if(kK){var kG=kK.rows[kE];kG.style.backgroundColor="#ffffff";var T=kG.getElementsByTagName("td")[1];var kC=T.childNodes[0];kC.style.visibility="";var i=kG.getElementsByTagName("th")[0];var kJ=i.childNodes[0];kJ.style.backgroundPosition=-kE*18+"px -273px"}if(kH.markersList.length>kE){var kF=E.staticHost+"/wolfman/static/common/images/";kF+="markers_new2x_2960fb4.png";var e=new jo(18*kE,273);var kD=new jS(kF,new jo(18,27),{offset:new jo(9,27),imageOffset:e,infoWindowOffset:eb,imageSize:jf,});kH.markersList[kE].setIcon(kD);kH._setTop(kH.markersList[kE],false)}},_setTop:function(T,i,e){if(!T||!T.setTop){return}if(i&&!T._isTop&&T.iconDom&&T.iconDom.style){T._isTop=true;if(e){T.setTop(true,1000100)}else{T.setTop(true)}return}if(!i&&T.iconDom&&T.iconDom.style){delete T._isTop;T.setTop(false)}},select:function(T,i,kD){if(arguments.length>2){kD=kD||window.e;var e=kD.srcElement||kD.target;if(e.className=="selBtn"){return}}var kF=this.json.content||[];var kC=this;var kE=kC.getCurPoint30(T);this.map.closeInfoWindow();if(!kE){return}if((kC.resCity[0]!=kC.resCity[1])&&kC.markerDest){if(this.map){this.map.setViewport(kC.pointsList)}}this._showInfoWindow(kE,T,i);if(this.curSelectedIndex!=-1){this._unSelectIt(T,this.curSelectedIndex)}this.curSelectedIndex=i%10;this._selectIt(T,this.curSelectedIndex)},clearMarkers:function(){var i=this;(function T(){if(i.markersList.length===0){return}i.map.removeOverlay(i.markersList.shift());T()})();(function e(){if(i.pointsList.length===0){return}i.pointsList.shift();e()})()},itmSelect:function(kI,kH){var kM=this;var kC=this.map;var kL=kM.json.content||[];var kK=this.getCurPoint30(kI);kM.qInfo[kI]["n"]=kK[kH]["name"];kM.qInfo[kI]["c"]=this.resCity[kI];kM.qInfo[kI]["u"]=kK[kH]["uid"];var kO=new cG(kK[kH]["location"]["lng"],kK[kH]["location"]["lat"]);var kE=kO;kM.qInfo[kI]["point"]=kO;kM.qInfo[kI]["x"]=kE.lng;kM.qInfo[kI]["y"]=kE.lat;kM.qInfo[kI]["t"]=BMAP_POI_TYPE_NORMAL;if(e9.G("B_PointName"+kI)){e9.G("B_PointName"+kI).innerHTML=kK[kH]["name"]}kM.markerDest=this.addPointMarker(kC,kE,kK[kH]["name"],kI);if(kI!=0&&kI!=this.endIndex){var kN=this.tpListInMap[kI-1];kN.query=kK[kH].name}kM.clearMarkers();if(this.isAllPointSure()){if(kM.markerDest){for(var kD=0;kD<kM.destList.length;kD++){kM.map.removeOverlay(kM.destList[kD])}kM.destList=[];kC.removeOverlay(kM.markerDest);kM.markerDest=null}kM.submit()}else{if(e9.G("RouteAddress_DIV"+kI)){e9.G("RouteAddress_DIV"+kI)["className"]="sel_y"}var T=0;for(var kD=1;kD<=this.endIndex;kD++){var kG=(kI+kD)%(this.endIndex+1);if(e9.G("RouteAddress_DIV"+kG)&&e9.G("RouteAddress_DIV"+kG)["className"]!="sel_y"){T=kG;break}else{T=kG;break}}if(kM.resType[T]==0){if(e9.G("RouteAddress_DIV"+(T))){e9.G("RouteAddress_DIV"+(T))["className"]="sel_n"}var kJ=kM.curPageIndex[T];var kF=(kJ-1)*10+9;var e=this.getCurPoint30(T);if(e.length<(kF+1)){kF=e.length-1}kM.addMarkers(T,[(kJ-1)*10,kF]);kM.select(T,0)}else{if(kM.resType[T]==2){if(e9.G("RouteAddress_DIV"+(T))){e9.G("RouteAddress_DIV"+(T))["className"]="sel_n"}}else{if(e9.G("RouteAddress_DIV"+(T))){e9.G("RouteAddress_DIV"+(T))["className"]="sel_x"}}}this.curPointIndex=T}},submit:function(){var kC=this;var kD=this.map;var kE=kC.qInfo[0]["c"];var i=kC.qInfo[kC.endIndex]["c"];if(kE==i){var kF=kE}var e={};var T=new fW("onpoiselected");e.start_name=kC.qInfo[0]["point"]["lat"]+","+kC.qInfo[0]["point"]["lng"];e.end_name=kC.qInfo[1]["point"]["lat"]+","+kC.qInfo[1]["point"]["lng"];e.region=kC.qInfo[0]["c"]||kC.qInfo[1]["c"];T.paramInfo=e;T.sType=this.sType;kD.dispatchEvent(T)},getTPointQueryParam:function(kH,e){var kG=2,kD="",kI="",kE="",T="0",i="",kC="",kJ="",kF="1";if(kH.point||kH.rPoint){kG=1;kI=kH.point?(kH.point.lng+","+kH.point.lat):(kH.rPoint.lng+","+kH.rPoint.lat);if(kH.uid){kG=2;kD=kH.uid}}if(kH.query){kE=kH.query}if(kH.addr){T="1";i=kH.addr}if(!isNaN(e)){kG=e}return kG+"$$"+kD+"$$"+kI+"$$"+kE+"$$"+T+"$$"+i+"$$"+kC+"$$"+kF+"$$+to:"},isAllPointSure:function(){for(var e=0;e<=this.endIndex;e++){if(this.qInfo[e]["n"]==""&&!this.qInfo[e]["x"]&&!this.qInfo[e]["y"]||this.qInfo[e]["n"]==undefined){return false}}return true},_selBtnOver:function(e){e.style.backgroundPosition="-100px -81px"},_selBtnOut:function(e){e.style.backgroundPosition="-21px -81px"},_selBtnDown:function(e){e.style.backgroundPosition="-220px -81px";e.style.fontWeight="bold"},initialize:function(){var kG=this;var kC=this.endIndex;var kJ=this.json;kG.setParsValue();for(var kE=0;kE<=kC;kE++){if(e9.G("RADiv_PAGE"+kE)){pg0=new eT("RADiv_PAGE"+kE,function(kM){var kL=kG.curPointIndex;var kK=[(kM-1)*10,kM*10-1];if(kG.resCount[kL]<(kK[1]+1)){kK[1]=kG.resCount[kL]-1}e9.remove=function(i){i=e9.G(i);var kN=i.parentNode;kN&&kN.removeChild(i)};if(e9.G("RA_ResItem_"+kL)){e9.remove(e9.G("RA_ResItem_"+kL));e9.insertHTML(e9.G("RADiv_ResItem"+kL),"AFTERBEGIN",kG.makeListTable(kL,kK))}kG.addMarkers(kL,kK,true);e9.G("RADiv_ResItem"+kL).scrollTop=0;kG.curPageIndex[kL]=kM},{pagecap:5,pageCount:kG.totalPage[kE],page:kG.curPageIndex[T]})}}var kD=[0,9];var kI=this.curPointIndex,kH=e9.G("RouteAddress_DIV"+kI),e=this.getCurPoint30(kI);if(kH.className=="sel_n"){if(e&&e.length>0){if(e.length<(kD[1]+1)){kD[1]=e.length-1}kG.addMarkers(kI,kD);kG.select(kI,0)}}else{if(this.markerDest&&kH.className=="sel_x"){this.map.setViewport(this.locPois)}}for(var T=0;T<=kC;T++){if(e9.G("RouteAddress_DIV"+T)["className"]=="sel_y"){var kF=this.getCurPoint30(T);if(kF.length>0&&kF[0].ifFromIW&&kF[0].ifFromIW==1){e9.rc(e9.G("RD_TOP_BUT"+T),"sel_body_button");e9.G("RD_TOP_BUT"+T).innerHTML=""}}}},withoutPanelInitial:function(){var kG=this;var kC=this.endIndex;var kJ=this.json;kG.setParsValue();for(var kF=0;kF<=kC;kF++){var T=kG.curPointIndex;var kE=[0,9];if(kG.resCount[T]<(kE[1]+1)){kE[1]=kG.resCount[T]-1}kG.addMarkers(T,kE,true)}var kD=[0,9];var kI=this.curPointIndex,kH=e9.G("RouteAddress_DIV"+kI),e=this.getCurPoint30(kI);if(kI==1){if(e&&e.length>0){if(e.length<(kD[1]+1)){kD[1]=e.length-1}kG.addMarkers(kI,kD)}}else{if(this.markerDest&&kI==0){if(this.map){this.map.setViewport(this.pointsList)}}}kG.select(kI,0)},setStatusByRes:function(T){var kC=this.map;if(T.current_city){if(!(T.result.result_show&1)&&(T.result.type==29||T.result.type==13)){var kD=T.current_city;var i=["country","province","city","area"],kE=kD.type!=null?modelConfig.level[i[kD.type]]:undefined,e=kD.geo!=null?e=bP.parseGeo(kD.geo,true).point:undefined;if(!kC.enableLoadTiles){kC.enableLoadTiles=true;kC.centerAndZoom(e||kC.getCenter(),kE||kC.getZoom())}else{if(kE){kC.zoomTo(kE)}if(e){kC.setCenter(e)}}}}},setParsValue:function(){this.resCity=this.tpCity;var e=this.json.content["result"];if(e.origin["content"].length>0){if(e.origin["content"].length===1){this.resType[0]=1}else{this.resType[0]=0}this.resCount[0]=e.origin["content"].length}else{this.resType[0]=3}if(e.destination["content"].length>0){if(e.destination["content"].length===1){this.resType[1]=1}else{this.resType[1]=0}this.resCount[1]=e.destination["content"].length}else{this.resType[1]=3}return},addMarkers:function(kL,kK,kD){var kN=this.json.content||[];var kO=this;var kM=this.getCurPoint30(kL);var kC=kO.map;kO.clearMarkers();if(!kM){return}for(var kI=kK[0];kI<=kK[1];kI++){var kP=new cG(kM[kI]["location"]["lng"],kM[kI]["location"]["lat"]);kO.markersList.push(fQ.addSearchPoi_R(kP,kI-kK[0],kM[kI]["name"],{type:"RouteAddrMarker"},kC));kO.pointsList.push(kP)}var kG=kO.pointsList;if(kO.markerDest){if(!((kO.resCity[0]!=kO.resCity[1]))){kG.push(kO.markerDest.getPosition())}}var e=this.map.getMapType();if(false){var kE=ev[BMAP_PERSPECTIVE_MAP].citys;var kH=kE[kC.currentCity][1];var kJ=getPointsBounds(kG);var T=kC.getViewport(kJ)["zoom"];if(kH.intersects(kJ)){if(T<=15){T=15}kC.centerAndZoom(kG[0],T)}else{if(kC){kC.setViewport(kG)}}}else{if(kC){kC.setViewport(kG)}}if(kO.pointsList.length==11){kO.pointsList.pop()}var kF=this.markersList;for(var kI=kK[0];kI<=kK[1];kI++){(function(){var i=kI;if(kF[kI-kK[0]]){kF[kI-kK[0]].addEventListener("click",function(){kO.select(kL,i)});kF[kI-kK[0]].addEventListener("mouseover",function(){var kQ=i%10;if(kO.curSelectedIndex!=kQ){kO._selectIt(kL,kQ)}});kF[kI-kK[0]].addEventListener("mouseout",function(){var kQ=i%10;if(kO.curSelectedIndex!=kQ){kO._unSelectIt(kL,kQ)}})}})()}},_showInfoWindow:function(kG,kE,kD){var kH=this;var kF=kG[kD];var i="<span class=\'iw_poi_title\' title=\'"+kF.name+"\'>"+kF.name+"</span>";var T=[];var kI="";if(kF.address&&kF.address!=""){kI="地址: "+kF.address}T.push("<div style=\'padding:11px 11px 6px 11px;line-height:20px;word-break:break-all\'>"+kI+"</div>");T.push("<div style=\'line-height:180%;margin-bottom:10px;\'>");var kC="选为途经点";if(kE==0){kC="选为起点"}if(kE==this.endIndex){kC="选为终点"}T.push("<div style=\'text-align:center;\'><div id=\'selInfoWndBtn\' class=\'selInfoWndBtn\'  data-uid = \'"+kE+"_"+kD+"\'  />"+kC+"</div>");T.push("</div>");if(!this.infoWindow){this.infoWindow=new ef(T.join(""),{title:i,height:0,width:280,margin:[0,0,0,0]});this.infoWindow.addEventListener("open",function(){var kJ=e9.G("selInfoWndBtn");e9.on(kJ,"click",function(){var kK=kJ.getAttribute("data-uid").split("_");kH.itmSelect(kK[0],kK[1])});e9.on(kJ,"mouseover",function(){kH._selBtnOver(kJ)});e9.on(kJ,"mousedown",function(){kH._selBtnDown(kJ)});e9.on(kJ,"mouseout",function(){kH._selBtnOut(kJ)})});this.infoWindow.addEventListener("close",function(){kH._unSelectIt(kE,e)})}else{this.infoWindow.setTitle(i);this.infoWindow.setContent(T.join(""))}var e=kD%10;if(this.markersList&&this.markersList[e]){this.markersList[e].openInfoWindow(this.infoWindow)}},getCurPoiName:function(e){if(e==undefined){e=this.curPointIndex}if(e==0){return this.startName}else{if(e==this.endIndex){return this.endName}else{return this.tpName[e-1]}}},each:function(kD,T){for(var kC=0,e=kD.length;kC<e;kC++){T(kC,kD[kC])}}});e9.extend(i4.prototype,{_asyncSearch:function(kD,e,kC){var T=this;var i=this.getUrl(kD,e,kC);T.goURI("web",i)},routeCall:function(kD,e,kC){var T=this;var i=this.getUrl(kD,e,kC);T.goURI("web",i)},setPointParameters:function(kC,i){var T=this.opts;var kD="";if(kC&&kC.latlng&&kC.name){var e=kC.latlng;kD="latlng:"+e.lat+","+e.lng;kD+="|name:"+kC.name}else{var e=kC.latlng;kD=e?e.lat+","+e.lng:(kC.name?kC.name:"")}T[i]=kD},getUrl:function(kC,kF,e){this.setPointParameters(kC,"origin");this.setPointParameters(kF,"destination");this.opts=e9.extend(this.opts,e);var kD=this.opts;var T=[];var kI="";var kL="";if(typeof(kD.origin)==="undefined"||kD.origin===""){kD.origin=""}var kK={destination:false,mode:false};for(var kE in kD){kI=kE+"="+kD[kE];T.push(kI);if(typeof(kK[kE])!=="undefined"){kK[kE]=true}}this.mode=kD.mode;if(kK.mode===false){var kJ="mode="+BMAP_MODE_DRIVING;this.mode=BMAP_MODE_DRIVING;T.push(kJ);kK.mode=true}var kH=true;for(var kG in kK){kH=kH&&kK[kG]}if(kH){return T.join("&")}return false},goURI:function(T,i,kD){var e=function(kE){var kF=document.createElement("script");kF.src="http://127.0.0.1:6259/sendintent?callback=send&intent="+encodeURIComponent(kE+"&src=baidu|jsapi#Intent;scheme=bdapp;package=com.baidu.BaiduMap;end");document.body.appendChild(kF)};if(i){var kC=a8[T]+i+"&src=baidu|jsapi";if(T==="web"){kC+="&output=html"}location.href=kC;kD&&kD()}}});');
