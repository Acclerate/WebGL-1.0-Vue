var ca="function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)},da="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ia(b,a){if(a){var c=da;b=b.split(".");for(var h=0;h<b.length-1;h++){var g=b[h];g in c||(c[g]={});c=c[g]}b=b[b.length-1];h=c[b];a=a(h);a!=h&&null!=a&&ca(c,b,{configurable:!0,writable:!0,value:a})}}
ia("Array.prototype.findIndex",function(b){return b?b:function(a,b){a:{var c=this;c instanceof String&&(c=String(c));for(var g=c.length,f=0;f<g;f++)if(a.call(b,c[f],f,c)){a=f;break a}a=-1}return a}});function ja(){this.l={}}var ma;ma="undefined"!==typeof window?window:self;function ta(b){var a=ua;a.l[b]=a.C()}function va(b,a){var c=ua;return parseFloat((c.l[a]-c.l[b]).toFixed(2))}ja.prototype.C=ma.performance&&ma.performance.now?function(){return performance.now()}:function(){return Date.now()};function createWasmModule(global, env, buffer) {"use asm";var a=new global.Int8Array(buffer);var b=new global.Int16Array(buffer);var c=new global.Int32Array(buffer);var d=new global.Uint8Array(buffer);var e=new global.Uint16Array(buffer);var f=new global.Uint32Array(buffer);var g=new global.Float32Array(buffer);var h=new global.Float64Array(buffer);var i=env.DYNAMICTOP_PTR|0;var j=env.tempDoublePtr|0;var k=env.ABORT|0;var l=env.STACKTOP|0;var m=env.STACK_MAX|0;var n=env.gb|0;var o=env.fb|0;var p=0;var q=0;var r=0;var s=0;var t=global.NaN,u=global.Infinity;var v=0,w=0,x=0,y=0,z=0.0;var A=0;var B=global.Math.floor;var C=global.Math.abs;var D=global.Math.sqrt;var E=global.Math.pow;var F=global.Math.cos;var G=global.Math.sin;var H=global.Math.tan;var I=global.Math.acos;var J=global.Math.asin;var K=global.Math.atan;var L=global.Math.atan2;var M=global.Math.exp;var N=global.Math.log;var O=global.Math.ceil;var P=global.Math.imul;var Q=global.Math.min;var R=global.Math.max;var S=global.Math.clz32;var T=env.abort;var U=env.assert;var V=env.enlargeMemory;var W=env.getTotalMemory;var X=env.abortOnCannotGrowMemory;var Y=env.setTempRet0;var Z=env.getTempRet0;var _=0.0;
// EMSCRIPTEN_START_FUNCS
function $(a){a=a|0;var b=0;b=l;l=l+a|0;l=l+15&-16;return b|0}function aa(){return l|0}function ba(a){a=a|0;l=a}function ca(a,b){a=a|0;b=b|0;l=a;m=b}function da(a,b){a=a|0;b=b|0;if(!p){p=a;q=b}}function ea(){return n+1892368|0}function fa(){return n+1990672|0}function ga(){return n+0|0}function ha(){return n+4374544|0}function ia(){return n+1998864|0}function ja(){return n+1998864+(c[n+32768>>2]<<1)|0}function ka(){return n+2523152|0}function la(){return n+2523152+((c[n+32772>>2]|0)*20|0)|0}function ma(){return c[n+32772>>2]|0}function na(){c[n+32768>>2]=0;c[n+32772>>2]=0;return}function oa(){return n+32776|0}function pa(){return n+3833872|0}function qa(){c[n+40968>>2]=0;c[n+40972>>2]=0;return}function ra(){return n+3842064|0}function sa(){return n+3842064+(c[n+40968>>2]<<1)|0}function ta(){return n+40976|0}function ua(){return n+40976+((c[n+40972>>2]|0)*28|0)|0}function va(){return c[n+40972>>2]|0}function wa(){return n+1875984|0}function xa(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0;d=(b|0)>0;if(d){c=0;do{e=n+1875984+(c<<2)|0;g[e>>2]=+g[e>>2]/100.0;c=c+1|0}while((c|0)!=(b|0))}if((b|0)>=(a|0)|d^1)return;else c=b;do{d=0;do{f=d+c|0;e=n+1875984+(f<<2)|0;g[e>>2]=+g[n+1875984+(f-b<<2)>>2]+ +g[e>>2]/100.0;d=d+1|0}while((d|0)!=(b|0));c=c+b|0}while((c|0)<(a|0));return}function ya(d,e,f,g,h,i,j,k,l,m,o,p,q){d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=+i;j=j|0;k=k|0;l=l|0;m=m|0;o=o|0;p=p|0;q=q|0;var r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,E=0,F=0,G=0,H=0.0,I=0.0;F=(d|0)/2|0;G=o<<24>>24==1;if(G){b[n+4366352>>1]=0;if((m|0)>2){r=0;s=2;do{I=+(c[n+0+(s<<2)>>2]|0);H=+(c[n+0+((s|1)<<2)>>2]|0);r=(~~(+D(+(I*I+H*H))/10.0)<<16>>16)+(r<<16>>16)|0;b[n+4366352+(((s|0)/2|0)<<1)>>1]=r;s=s+2|0}while((s|0)<(m|0));r=4}}else r=4;if((r|0)==4?(m|0)>2:0){r=2;s=c[n+0>>2]|0;do{C=n+0+(r<<2)|0;s=(c[C>>2]|0)+s|0;c[C>>2]=s;C=r|1;E=n+0+(C<<2)|0;c[E>>2]=(c[E>>2]|0)+(c[n+0+(C+-2<<2)>>2]|0);r=r+2|0}while((r|0)<(m|0))}if(l<<24>>24){b[n+1892368>>1]=b[n+1892368+8>>1]|0;b[n+1892368+2>>1]=b[n+1892368+10>>1]|0;b[n+1892368+4>>1]=b[n+1892368+12>>1]|0;b[n+1892368+6>>1]=b[n+1892368+14>>1]|0;E=F<<1;b[n+1892368+(E+-2<<1)>>1]=b[n+1892368+(E+-6<<1)>>1]|0;b[n+1892368+(E+-1<<1)>>1]=b[n+1892368+(E+-5<<1)>>1]|0;b[n+1892368+(E+-4<<1)>>1]=b[n+1892368+(E+-8<<1)>>1]|0;b[n+1892368+(E+-3<<1)>>1]=b[n+1892368+(E+-7<<1)>>1]|0}C=q-p|0;E=c[n+32772>>2]|0;if((d|0)<=1){za(C,E);return}A=(j|0)==0;B=F+-2|0;w=o<<24>>24==2;x=F+-1|0;y=F+-4|0;z=p+1|0;v=q+-1|0;t=0;r=0;u=E;do{if((t|0)>=4)if((y|0)>(t|0))m=z+((t+-4|0)/5|0)|0;else m=v;else m=p;if(!A)r=b[n+1990672+(m<<1)>>1]|0;d=m<<1;q=((c[n+0+(d<<2)>>2]|0)/10|0)&65535;d=((c[n+0+((d|1)<<2)>>2]|0)/10|0)&65535;o=t<<1;j=~~(+(b[n+1892368+(o<<1)>>1]|0)*i/10.0);o=~~(+(b[n+1892368+((o|1)<<1)>>1]|0)*i/10.0);a:do if(!((t|0)==0|(t|0)==(B|0)))if((t|0)==1|(t|0)==(x|0))l=-1;else{s=t+-2|0;switch((s|0)%5|0|2|0){case 2:{l=1;break a}case 3:{l=-1;break a}default:{l=a[((s|0)/5|0)+(n+4374544)>>0]|0;break a}}}else l=1;while(0);if(G)s=b[n+4366352+(m<<1)>>1]|0;else s=w?((m|0)==0?0:10):0;m=u;u=u+1|0;b[n+2523152+(m*20|0)>>1]=q;b[n+2523152+(m*20|0)+2>>1]=d;b[n+2523152+(m*20|0)+4>>1]=j;b[n+2523152+(m*20|0)+6>>1]=o;a[n+2523152+(m*20|0)+8>>0]=e;a[n+2523152+(m*20|0)+9>>0]=f;a[n+2523152+(m*20|0)+10>>0]=g;a[n+2523152+(m*20|0)+11>>0]=h;b[n+2523152+(m*20|0)+12>>1]=l;b[n+2523152+(m*20|0)+14>>1]=r;b[n+2523152+(m*20|0)+16>>1]=k;b[n+2523152+(m*20|0)+18>>1]=s;t=t+1|0}while((t|0)<(F|0));c[n+32772>>2]=u;za(C,E);return}function za(a,d){a=a|0;d=d|0;var e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,o=0,p=0,q=0;l=a+-1|0;k=a+-2|0;j=0;e=1;f=1;i=c[n+32768>>2]|0;while(1){a=e+1|0;o=a+d|0;a=(a&1|0)==0;h=f<<24>>24!=0;p=o+-2|0;m=e+d|0;g=h?p:m;p=h?m:p;b[n+1998864+(i<<1)>>1]=a?g:p;b[n+1998864+(i+1<<1)>>1]=a?p:g;b[n+1998864+(i+2<<1)>>1]=o;o=e+2|0;g=o+d|0;o=(o&1|0)==0;p=g+-1|0;a=h?m:p;m=h?p:m;b[n+1998864+(i+3<<1)>>1]=o?a:m;b[n+1998864+(i+4<<1)>>1]=o?m:a;a=i+6|0;b[n+1998864+(i+5<<1)>>1]=g;if((j|0)>=(l|0))break;o=e+3|0;g=o+d|0;o=(o&1|0)==0;m=g+-2|0;q=g+-1|0;p=h?m:q;m=h?q:m;b[n+1998864+(a<<1)>>1]=o?p:m;b[n+1998864+(i+7<<1)>>1]=o?m:p;b[n+1998864+(i+8<<1)>>1]=g;g=e+4|0;p=g+d|0;m=(g&1|0)==0;o=p+-2|0;q=p+-1|0;a=h?o:q;o=h?q:o;b[n+1998864+(i+9<<1)>>1]=m?a:o;b[n+1998864+(i+10<<1)>>1]=m?o:a;a=i+12|0;b[n+1998864+(i+11<<1)>>1]=p;if((j|0)==(k|0))e=g;else{e=e+5|0;q=e+d|0;m=(e&1|0)==0;o=q+-2|0;g=q+-1|0;p=h?o:g;o=h?g:o;b[n+1998864+(a<<1)>>1]=m?p:o;b[n+1998864+(i+13<<1)>>1]=m?o:p;b[n+1998864+(i+14<<1)>>1]=q;f=f<<24>>24==0&1;a=i+15|0}j=j+1|0;i=a}c[n+32768>>2]=a;return}function Aa(d,f,h,i,j,k,l,m,o,p,q,r){d=d|0;f=f|0;h=+h;i=i|0;j=j|0;k=k|0;l=l|0;m=m|0;o=o|0;p=p|0;q=q|0;r=r|0;var s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0.0,A=0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0;if((d|0)>2){s=2;t=c[n+32776>>2]|0;do{x=n+32776+(s<<2)|0;t=(c[x>>2]|0)+t|0;c[x>>2]=t;x=s|1;y=n+32776+(x<<2)|0;c[y>>2]=(c[y>>2]|0)+(c[n+32776+(x+-2<<2)>>2]|0);s=s+2|0}while((s|0)<(d|0))}w=c[n+40972>>2]|0;x=(d|0)>0;if(x){t=w+((d+-1|0)>>>1)|0;s=0;u=w;while(1){z=+(c[n+32776+((s|1)<<2)>>2]|0)/100.0;g[n+40976+(u*28|0)>>2]=+(c[n+32776+(s<<2)>>2]|0)/100.0;g[n+40976+(u*28|0)+4>>2]=z;g[n+40976+(u*28|0)+8>>2]=h;g[n+40976+(u*28|0)+12>>2]=0.0;g[n+40976+(u*28|0)+16>>2]=0.0;g[n+40976+(u*28|0)+20>>2]=1.0;a[n+40976+(u*28|0)+24>>0]=j;a[n+40976+(u*28|0)+25>>0]=k;a[n+40976+(u*28|0)+26>>0]=l;a[n+40976+(u*28|0)+27>>0]=m;s=s+2|0;if((s|0)>=(d|0))break;else u=u+1|0}s=t+1|0;c[n+40972>>2]=s}else s=w;if((f|0)>0){v=c[n+40968>>2]|0;t=0;u=v;while(1){b[n+3842064+(u<<1)>>1]=(e[n+3833872+(t<<1)>>1]|0)+w;t=t+1|0;if((t|0)==(f|0))break;else u=u+1|0}c[n+40968>>2]=v+f}if(!x)return;y=d+-2|0;v=(i|0)==0;m=v?r:m;i=v?q:l;f=v?p:k;v=v?o:j;t=c[n+40968>>2]|0;x=(d+-1|0)>>>1;w=s+(x<<2)|0;x=t+(x*6|0)|0;u=0;while(1){G=+(c[n+32776+(u<<2)>>2]|0)/100.0;F=+(c[n+32776+((u|1)<<2)>>2]|0)/100.0;j=u;u=u+2|0;A=(j|0)==(y|0);E=+(c[n+32776+((A?0:u)<<2)>>2]|0)/100.0;D=+(c[n+32776+((A?1:j+3|0)<<2)>>2]|0)/100.0;I=E-G;z=D-F;H=G-G;J=F-F;C=z*h-J*0.0;B=H*0.0-I*h;z=J*I-H*z;j=s+1|0;g[n+40976+(s*28|0)>>2]=G;g[n+40976+(s*28|0)+4>>2]=F;g[n+40976+(s*28|0)+8>>2]=0.0;g[n+40976+(s*28|0)+12>>2]=C;g[n+40976+(s*28|0)+16>>2]=B;g[n+40976+(s*28|0)+20>>2]=z;a[n+40976+(s*28|0)+24>>0]=o;a[n+40976+(s*28|0)+25>>0]=p;a[n+40976+(s*28|0)+26>>0]=q;a[n+40976+(s*28|0)+27>>0]=r;A=s+2|0;g[n+40976+(j*28|0)>>2]=G;g[n+40976+(j*28|0)+4>>2]=F;g[n+40976+(j*28|0)+8>>2]=h;g[n+40976+(j*28|0)+12>>2]=C;g[n+40976+(j*28|0)+16>>2]=B;g[n+40976+(j*28|0)+20>>2]=z;a[n+40976+(j*28|0)+24>>0]=v;a[n+40976+(j*28|0)+25>>0]=f;a[n+40976+(j*28|0)+26>>0]=i;a[n+40976+(j*28|0)+27>>0]=m;k=s+3|0;g[n+40976+(A*28|0)>>2]=E;g[n+40976+(A*28|0)+4>>2]=D;g[n+40976+(A*28|0)+8>>2]=0.0;g[n+40976+(A*28|0)+12>>2]=C;g[n+40976+(A*28|0)+16>>2]=B;g[n+40976+(A*28|0)+20>>2]=z;a[n+40976+(A*28|0)+24>>0]=o;a[n+40976+(A*28|0)+25>>0]=p;a[n+40976+(A*28|0)+26>>0]=q;a[n+40976+(A*28|0)+27>>0]=r;g[n+40976+(k*28|0)>>2]=E;g[n+40976+(k*28|0)+4>>2]=D;g[n+40976+(k*28|0)+8>>2]=h;g[n+40976+(k*28|0)+12>>2]=C;g[n+40976+(k*28|0)+16>>2]=B;g[n+40976+(k*28|0)+20>>2]=z;a[n+40976+(k*28|0)+24>>0]=v;a[n+40976+(k*28|0)+25>>0]=f;a[n+40976+(k*28|0)+26>>0]=i;a[n+40976+(k*28|0)+27>>0]=m;l=s&65535;b[n+3842064+(t<<1)>>1]=l;b[n+3842064+(t+1<<1)>>1]=A;k=k&65535;b[n+3842064+(t+2<<1)>>1]=k;b[n+3842064+(t+3<<1)>>1]=l;b[n+3842064+(t+4<<1)>>1]=k;b[n+3842064+(t+5<<1)>>1]=j;if((u|0)>=(d|0))break;else{s=s+4|0;t=t+6|0}}c[n+40972>>2]=w+4;c[n+40968>>2]=x+6;return}function Ba(){}

// EMSCRIPTEN_END_FUNCS
return{_reset_line:na,_get_block_index_start:ra,setThrew:da,_get_line_turnings_address:ha,_get_block_triangle_indices_address:pa,_get_line_vertex_count:ma,stackAlloc:$,_get_block_vertex_count:va,_get_block_vertex_start:ta,_get_line_vertex_end:la,_get_feature_points_address:wa,stackRestore:ba,_get_block_index_end:sa,_get_line_altitudes_address:fa,_get_block_vertex_end:ua,stackSave:aa,runPostSets:Ba,_get_line_vertex_start:ka,_parse_points:xa,_get_line_points_address:ga,establishStackSpace:ca,_get_line_index_end:ja,_append_line_data:ya,_get_line_index_start:ia,_append_block_data:Aa,_get_block_points_address:oa,_reset_block:qa,_get_line_data_address:ea}}


;
var wa,Ca,Da,Ea,Fa,Ja,B,Ka,La,Ma,Na,Oa,Pa,Qa,Ya,Za,$a,ab;ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(b,a){void 0===b&&(b=0);void 0===a&&(a=this.byteLength);b=Math.floor(b);a=Math.floor(a);0>b&&(b+=this.byteLength);0>a&&(a+=this.byteLength);b=Math.min(Math.max(0,b),this.byteLength);a=Math.min(Math.max(0,a),this.byteLength);if(0>=a-b)return new ArrayBuffer(0);var c=new ArrayBuffer(a-b),h=new Uint8Array(c);b=new Uint8Array(this,b,a-b);h.set(b);return c});
function bb(b,a){var c=b.length;a=a||2;ab||(ab=B._get_feature_points_address()>>2);Da.set(b,ab);B._parse_points(c,a);return new Float32Array(wa.slice(ab<<2,ab+c<<2))}function cb(){return B._get_block_vertex_count()}function db(){Pa||(Pa=B._get_line_vertex_start());return new Float32Array(wa.slice(Pa,B._get_line_vertex_end()))}function fb(){Oa||(Oa=B._get_line_index_start());return new Uint16Array(wa.slice(Oa,B._get_line_index_end()))}function nb(){return B._get_line_vertex_count()}
function ob(b,a,c,h,g,f,d,r,y,m,k){var t=0;h&&(t=h.length,La||(La=B._get_line_altitudes_address()>>1),Fa.set(h,La));r&&r.length&&(Na||(Na=B._get_line_turnings_address()),Ca.set(r,Na));g=g||0;m=m||0;k=k||d.length/2;Ka||(Ka=B._get_line_data_address()>>1);Fa.set(b,Ka);Ma||(Ma=B._get_line_points_address()>>2);Ea.set(d,Ma);B._append_line_data(b.length,a[0],a[1],a[2],a[3],c,t,g,f?1:0,d.length,y,m,k)}function pb(){B._reset_line()}
function qb(b){wa||(wa=new ArrayBuffer(4587520),Da=new Float32Array(wa),Ea=new Int32Array(wa),Ca=new Int8Array(wa),Fa=new Int16Array(wa),Ja=new Uint16Array(wa),B=self.createWasmModule(self,{$:0,wa:0,Z:0,aa:0,ba:0,ga:0,ea:0},wa));b&&b()}
function rb(b,a,c,h,g){var f={fixedLabel:[],lineLabel:[]};if(!b)return f;var d=[];if(a&&a.length)for(var r=0;r<a.length;r++){var y=a[r],m=y[0]/4;J[m+1]===sb&&d.push(S(J[m]+1,y[0],y[0]+y[1]))}a=S(0,c[0],c[0]+c[1])||[];h=h.height;f.fixedLabel=tb(b,d,h,g,void 0);d=[];for(c=0;c<a.length;c++){var k=b,t=a[c];r=g;y=h;m=d;var e=t[0]/4,l=S(J[e]+1,t[0],t[0]+t[1]),A=S(0,l[6][0],l[6][0]+l[6][1]);t=[];for(var z=0;z<A.length;z++)t[z]=new Uint16Array(k,A[z][0],A[z][1]/2);A=ub;var p=Math.pow(2,18-r.zoom),n=r.col*
r.baseTileSize*p,v=r.row*r.baseTileSize*p,w=new Uint16Array(k,l[4][0],l[4][1]/2),H=w.length,x=vb[e+1],u=wb.b(xb,x,"pointText",r.useZoom,yb,!1,W);e=vb[e+2];var K=zb(k,l[0][0],l[0][1],"utf-8"),D=t.length||K.split("").length;if(0!==D){var q=new Int32Array(k,l[1][0],l[1][1]/4),C=new Int16Array(k,l[5][0],l[5][1]/2),F=[C[0]],X=Array.prototype.slice.call(q.slice(0,2)),O=2;for(z=1;O<q.length;O+=2,z++)X[O]=X[O-2]+q[O],X[O+1]=X[O-1]+q[O+1],1===C.length?F[z]=C[0]:1<C.length&&(F[z]=F[z-1]+C[z]);var L=new Uint16Array(k,
l[3][0],l[3][1]/2);k=new Uint16Array(k,l[2][0],l[2][1]/2);for(z=0;z<H;z++)if(l=w[z],Ab(l,r.useZoom)){if(r.processedLabelZooms&&r.processedLabelZooms.length&&!W){q=r.processedLabelZooms;var M=!1;for(O=0;O<q.length;O++)if(Ab(l,q[O])){M=!0;break}if(M)continue}O=L[z];q=z*D*2;q=X.slice(q,q+2*D);var Y=M=1E3,T=-1E3,V=-1E3,U=t.slice(0);O&&U.reverse();for(var aa,Z,Q,N=[],I=0;I<D;I++){var ba=k[D*z+I],R=q[2*I]/100,P=q[2*I+1]/100,G=0;0<C.length&&(G=F[z*D]/100);0===I&&(aa=R,Z=P,Q={lng:n+aa,lat:v+Z});R=(R-aa)/
p;P=(P-Z)/p;var E=U[I],fa=null,oa=null;if(E&&0<E.length){var za=E[0];fa=E[1];var ea=E[2]/A;E=E[3]/A;oa=[ea,E];var na=za/512,ka=(y-fa-E*A)/y,Ra=za=(za+ea*A)/512;fa=(y-fa)/y;fa=[na,ka,za,ka,Ra,fa,na,ka,Ra,fa,na,fa];na=R-ea/2;ka=P+E/2;E=P-E/2;ea=R+ea/2;na<M&&(M=na);ea>T&&(T=ea);E<Y&&(Y=E);ka>V&&(V=ka)}N.push({offset:[R,P],z:G,size:oa,angle:ba,texcoord:fa})}U=q[2*(D-1)]-q[0];q=q[2*(D-1)+1]-q[1];1===O&&(U=-U,q=-q);0===U?q=0<q?90:270:(I=Math.atan(q/U)/Math.PI*180,0>U&&0<q?I+=180:0>U&&0>q?I+=180:0<U&&0>
q&&(I+=360),360===I&&(I=0),q=I);m.push({type:"line",rank:e,name:K,wordCount:D,pt:Q,mcInTile:{x:aa,y:Z},reverse:O,styleId:x,styleText:u,bds:[M,Y,T,V],wordsInfo:N,labelAngle:q,tracer:l,processedInZoom:r.useZoom,key:"line_"+e+"_"+Q.lng+"_"+Q.lat})}}}f.lineLabel=d;f.textureHeight=h;f.tileInfo=g;return f}
function tb(b,a,c,h,g,f){for(var d=[],r=0;r<a.length;r++){var y=b,m=a[r],k=h,t=c,e=d,l=g,A=f;if(m&&m.length){l=l||yb;var z=k.useZoom;9===z&&(z=8);for(var p=Math.pow(2,18-k.zoom),n=k.col*k.baseTileSize*p,v=k.row*k.baseTileSize*p,w=k.col,H,x=w,u=1536*Math.pow(2,k.zoom-3)/(k.baseTileSize||256),K=u/2-1,D=-u/2;x>K;)x-=u;for(;x<D;)x+=u;H=x;var q=n;H>w?q=n-40075452:H<w&&(q=n+40075452);for(var C=0;C<m.length;C++){var F=m[C],X=F[0]/4,O=J[X],L=J[X+1],M=wb.b(xb,L,"point",z,l,A,W),Y=wb.b(xb,L,"pointText",z,l,
A,W);if(k.areaCustom)var T=wb.b(Bb,L,"point",z,l,A,Cb),V=wb.b(Bb,L,"pointText",z,l,A,Cb);var U=S(O+1,F[0],F[0]+F[1]);if(!(Y&&0!==Y.length||M&&0!==M.length||V&&0!==V.length||T&&0!==T.length))if(5===z){if(!U||!U.length)continue;for(var aa=0;aa<U.length;aa++){var Z=U[aa],Q=Z[0]/4,N=J[Q],I=S(N+1,Z[0],Z[0]+Z[1]),ba;Z[1]&&I[1][1]&&(ba=zb(y,I[1][0],I[1][1],"utf-8"));if("\u5317\u4eac"===ba){M=wb.b(xb,L,"point",6,l,!1,W);Y=wb.b(xb,L,"pointText",6,l,!1,Cb);T=wb.b(xb,L,"point",6,l,!1,W);V=wb.b(xb,L,"pointText",
6,l,!1,Cb);break}}}else continue;if(U){var R=null,P=1,G=0,E=0;M&&M[0]&&(M=M[0],R=M.icon,P=(M.zoom||100)/100);for(aa=0;aa<U.length;aa++)if(Z=U[aa],Q=Z[0]/4,N=J[Q],I=S(N+1,Z[0],Z[0]+Z[1]),Z[1]){var fa=J[Q+1];if(Ab(fa,k.useZoom)){if(k.processedLabelZooms&&k.processedLabelZooms.length&&!W){for(var oa=k.processedLabelZooms,za=!1,ea=0;ea<oa.length;ea++)if(Ab(fa,oa[ea])){za=!0;break}if(za)continue}var na=S(0,I[2][0],I[2][0]+I[2][1]),ka=[];for(ea=0;ea<na.length;ea++)ka[ea]=new Uint16Array(y,na[ea][0],na[ea][1]);
var Ra=void 0;I[1][1]&&(Ra=zb(y,I[1][0],I[1][1],"utf-8"));var eb=Ra||"";if(!(Y&&0<Y.length&&0===ka.length&&""===eb)){var hc=J[Q+2],ic=J[Q+3],jc=J[Q+4],kc=Math.round(hc/100),lc=Math.round(ic/100),Db={lng:n+kc,lat:v+lc},mc={lng:q+kc,lat:v+lc};k.areaCustom&&Gb(mc,self.area)&&(Y=V);var nc=void 0;I[0][1]&&(nc=zb(y,I[0][0],I[0][1],void 0));var Eb=J[Q+5],oc=0<ka.length||""!==eb&&0<Y.length,Fb=Vb(R),qc=!(4!==Eb||!oc||!Fb),Uc=!!eb.match(/[qypjg]/g),Vc=nc||"",Wc=Db,Xc=mc,Yc=eb,Zc=Uc,$c=jc,ad=L,bd=Y,cd=R,dd=
qc,ed=M.hue,fd=Eb,gd=m.V;a:{var xa=void 0,gb=fa,rc=k.useZoom;Wb[gb]||(xa=gb.toString(2),8>xa.length&&(xa=Array(8-xa.length+1).join("0")+xa),Wb[gb]=xa);xa=Wb[gb];for(var sc=Xb[rc].start,hd=Xb[rc].end-sc+1,hb=0;hb<hd;hb++)if("1"===xa[hb]){var tc=hb+sc;break a}tc=99}var ha={type:"fixed",guid:Vc,pt:Wc,ptFix:Xc,name:Yc,containDescendings:Zc,rank:$c,iconPos:null,textPos:null,styleId:ad,styleText:bd,icon:cd,textOnIcon:dd,hue:ed,direction:fd,onDefaultFloor:gd,startZoom:tc||99,tilePosStr:hc+","+ic,tracer:fa,
processedInZoom:k.useZoom,key:"fixed_"+jc+"_"+Db.lng+"_"+Db.lat};if(null===R||qc)null!==R&&(ha.iconSize=Fb);else{var Hb=Vb(R);if(Hb){var Ib=Hb[0]/2*P,Jb=Hb[1]/2*P,ib=Math.round(-Ib/2),jb=Math.round(-Jb/2),Kb=ib+Ib,Lb=jb+Jb;var uc={vertex:[ib,jb,Kb,jb,Kb,Lb,ib,jb,Kb,Lb,ib,Lb],texcoord:null,width:Ib,height:Jb,iconType:R}}else uc=null;ha.iconPos=uc;ha.iconPos&&(G=ha.iconPos.width,E=ha.iconPos.height)}if(ka.length){var id=ha,kb=Eb,Mb=ka,Nb=G,vc=E,lb=t,Sa=ub;"number"!==typeof kb&&(kb=0);for(var Ga=Mb.length,
wc=[],xc=[],Ha=0,Ta=0,la=0;la<Ga;la++)Ta+=Math.round(Mb[la][3]/Sa);for(la=0;la<Ga;la++){var mb=Mb[la],yc=mb[0],zc=mb[1],Ia=Math.round(mb[2]/Sa),Aa=Math.round(mb[3]/Sa);0===Nb&&(kb=4);switch(kb){case 3:var pa=Ta/2-Aa+2*(Ga-1)/2;var ya=Math.round(-Nb/2-Ia-2);var Ba=Math.round(pa-Ha-2*la);break;case 1:pa=Ta/2-Aa+2*(Ga-1)/2;ya=Math.round(Nb/2+2);Ba=Math.round(pa-Ha-2*la);break;case 2:pa=vc/2+Ta-Aa+2*Ga;ya=Math.round(-Ia/2);Ba=Math.round(pa-Ha-2*la);break;case 0:pa=-vc/2-2-Aa;ya=Math.round(-Ia/2);Ba=Math.round(pa-
Ha-2*la);break;case 4:pa=-Ta/2-2*(Ga-1)/2,ya=Math.round(-Ia/2),Ba=Math.round(pa-Ha-2*la)}Ha+=Aa;var Ac=ya+Math.round(Ia),Bc=Ba,Cc=Ac,Ob=Bc+Math.round(Aa),Pb=yc/512,Qb=(lb-zc-Aa*Sa)/lb,Dc=(yc+Ia*Sa)/512,jd=Qb,Ec=Dc,Rb=(lb-zc)/lb,kd=Pb,ld=Rb;wc.push(ya,Ba,Ac,Bc,Cc,Ob,ya,Ba,Cc,Ob,ya,Ob);xc.push(Pb,Qb,Dc,jd,Ec,Rb,Pb,Qb,Ec,Rb,kd,ld)}id.textPos={vertex:wc,texcoord:xc}}if(ha.textPos||ha.iconPos){var Ua=1E3,Va=1E3,Wa=-1E3,Xa=-1E3;if(ha.iconPos)for(var Sb=ha.iconPos.vertex,qa=0,Tb=Sb.length;qa<Tb;qa+=2){var ra=
Sb[qa],sa=Sb[qa+1];ra<Ua&&(Ua=ra);ra>Wa&&(Wa=ra);sa<Va&&(Va=sa);sa>Xa&&(Xa=sa)}if(ha.textPos){var Ub=ha.textPos.vertex;qa=0;for(Tb=Ub.length;qa<Tb;qa+=2)ra=Ub[qa],sa=Ub[qa+1],ra<Ua&&(Ua=ra),ra>Wa&&(Wa=ra),sa<Va&&(Va=sa),sa>Xa&&(Xa=sa)}ha.bds=[Ua,Va,Wa,Xa]}(Fb||oc)&&e.push(ha)}}}}}}}return d}function Vb(b){if(!b||"disekong"===b)return null;var a=Yb[b]||Yb["MapRes/"+b];!a&&b&&48<=b.charCodeAt(0)&&57>=b.charCodeAt(0)&&(a=Yb["_"+b]);return a}var Zb;
Zb=function(b,a,c,h){var g,f;a=S(0,a[0],a[0]+a[1]);if(!a.length)return{};for(var d={},r=[],y=[],m=[],k=[],t=[],e=0;e<a.length;e++){var l=S(0,a[e][0],a[e][0]+a[e][1]),A=l[0];A=S(0,A[0],A[0]+A[1]);l=l[1];var z=S(J[l[0]>>2]+1,l[0],l[0]+l[1]);a:{var p=b;if((g=S(0,z[2][0],z[2][0]+z[2][1]))&&g[0]){for(var n=0;n<g.length;n++){var v=g[n],w=v[0]>>2;w=J[w];v=S(w+1,v[0],v[0]+v[1]);if(!v[0][1]){p=[];g=[0,0];var H=f=void 0;break a}}f=[];var x=[0,0],u=[2.003772637E7,1.102819087E7];l=[-2.003772637E7,-1.060158079E7];
H=0;n=c.mercatorSize;var K=c.col*n,D=c.row*n;for(n=0;n<g.length;n++){v=g[n];w=v[0]>>2;w=J[w];v=S(w+1,v[0],v[0]+v[1]);v=new Int32Array(p,v[0][0],v[0][1]>>2);w=[K+v[0]/100,D+v[1]/100];x[0]+=w[0];x[1]+=w[1];w[0]<u[0]&&(u[0]=w[0]);w[1]<u[1]&&(u[1]=w[1]);w[0]>l[0]&&(l[0]=w[0]);w[1]>l[1]&&(l[1]=w[1]);for(var q=2;q<v.length;q+=2)w[q]=w[q-2]+v[q]/100,w[q+1]=w[q-1]+v[q+1]/100,x[0]+=w[q],x[1]+=w[q+1],w[q]<u[0]&&(u[0]=w[q]),w[q+1]<u[1]&&(u[1]=w[q+1]),w[q]>l[0]&&(l[0]=w[q]),w[q+1]>l[1]&&(l[1]=w[q+1]);H+=v.length;
f.push(w)}x[0]/=H/2;x[1]/=H/2;p=f;g=x;f=u;H=l}else p=[],g=[0,0],H=f=void 0}u=S(0,z[3][0],z[3][0]+z[3][1]);l=[];for(x=0;x<u.length;x++)l[x]=String.fromCharCode.apply(String,new Uint8Array(b,u[x][0],u[x][1]));K=String.fromCharCode.apply(String,new Uint8Array(b,z[1][0],z[1][1]));u=void 0;z=String.fromCharCode.apply(String,new Uint8Array(b,z[0][0],z[0][1]));for(x=0;x<l.length;x++)if(l[x]===K){u=x;break}p={defaultFloor:u,currentFloor:u,currentFloorName:l[u],uid:z,floors:[],contour:p,boundsMin:f,boundsMax:H,
center:g,floorLength:l.length};for(x=0;x<l.length;x++){n=l[x];a:{g=b;f=A;H=n;for(K=0;K<f.length;K++)if(D=S(J[f[K][0]>>2]+1,f[K][0],f[K][0]+f[K][1]),String.fromCharCode.apply(String,new Uint8Array(g,D[0][0],D[0][1]))===H){K=D[1];break a}K=null}g=b;D=z;f=c;v=h;H=x===u?!0:!1;if(K)if(K=S(0,K[0],K[0]+K[1]),K.length){n={base:[],base3d:[],contour:[],floorName:n};for(var C=0;C<K.length;C++){w=K[C];q=w[0]>>2;var F=J[q+1];7===F&&(v=$b(g,w,f,n.contour,v,1,{w:!0,S:!0}))}for(C=0;C<n.contour.length;C++)n.contour[C].uid=
D;for(C=0;C<K.length;C++)w=K[C],q=w[0]>>2,F=J[q+1],7===F&&(v=$b(g,w,f,n.base,v,2,{w:!0})),15===F&&(v=$b(g,w,f,n.base3d,v,2,{w:!0,v:!0}));for(C=0;C<n.base.length;C++)n.base[C].uid=D;for(C=0;C<n.base3d.length;C++)n.base3d[C].uid=D;(v=ac(g,K,f,!0))&&0!==v.vertex.length&&(n.area3D=v,n.area3D.uid=D,n.area3D.border&&(n.indoorBorder3D=n.area3D.border,n.indoorBorder3D.uid=D,delete n.area3D.border));D=[];for(v=0;v<K.length;v++)w=K[v],q=w[0]>>2,F=J[q+1],F===sb&&(w=S(J[q]+1,w[0],w[0]+w[1]),w.V=H,D.push(w));
n.pois=tb(g,D,H?J[2]:J[3],f,bc,!0);g=n}else g={floorName:n};else g={floorName:n};p.floors[x]=g}d[z]=p;if(p.floors[u]){if(p.floors[u].base)for(x=0;x<p.floors[u].base.length;x++)r.push(p.floors[u].base[x]);if(p.floors[u].base3d)for(x=0;x<p.floors[u].base3d.length;x++)y.push(p.floors[u].base3d[x]);if(p.floors[u].contour)for(x=0;x<p.floors[u].contour.length;x++)m.push(p.floors[u].contour[x]);p.floors[u].indoorBorder3D&&k.push(p.floors[u].indoorBorder3D);p.floors[u].area3D&&t.push(p.floors[u].area3D)}d.tileInfo=
c}0===r.length&&(r=null);0===y.length&&(y=null);0===m.length&&(m=null);0===k.length&&(k=null);0===t.length&&(t=null);return{indoorDataResult:d,indoorBase:r,indoorBase3D:y,indoorBaseContour:m,indoorArea3D:t,indoorBorder3D:k}};
var wb=function(){function b(b,c,h,g,m){g=g||null;21<h&&(h=21);if(g){m=g[2];switch(c){case "point":m=m[0];break;case "pointText":m=m[1];break;case "line":m=m[3];break;case "polygon":m=m[4];break;case "polygon3d":m=m[5]}var f=h-1;"line"===c&&12===h&&(f=h);f=g[1][f][0];f=f[b];!f&&21>h&&("point"===c||"pointText"===c)&&(f=g[1][h][0],f=f[b]);h={m:f,style:m,A:[]}}else if(m&&m.baseFs){g=m.baseFs;b:{var d=m.Ba;if("[object Object]"===Object.prototype.toString.call(d)){for(f in d){f=!1;break b}f=!0}else f=
!1}m=f?m.StyleBody||[]:m.zoomStyleBody[h]||[];f=g[2];switch(c){case "point":f=f[0];m=m[0]||{};break;case "pointText":f=f[1];m=m[1]||{};break;case "line":f=f[3];m=m[3]||{};break;case "polygon":f=f[4];m=m[4]||{};break;case "polygon3d":f=f[5],m=m[5]||{}}d=g[1][h-1][0];d=d[b];!d&&21>h&&("point"===c||"pointText"===c)&&(d=g[1][h][0],d=d[b]);h={m:d,style:f,A:m}}else h={m:null,style:[],A:[]};m=h;h=m.m;g=m.style;m=m.A;f=[];if(!h)return f;for(d=0;d<h.length;d++){var e=m[h[d]]||g[h[d]];if(e){switch(c){case "polygon":var l=
null,r=null;e[e.length-1]&&e[e.length-1]instanceof Array&&"openmap"===e[e.length-1][0]&&(l=e[e.length-1][1]?e[e.length-1][1]:null,r=e[e.length-1][2]?e[e.length-1][2]:null);e={g:b,f:a(e[0]),c:a(e[1]),borderWidth:e[2],F:e[3],G:e[4],Aa:e[5],ha:e[6],xa:e[7],ya:a(e[8]),h:r,u:a(l)};break;case "line":l=null;e[e.length-1]&&e[e.length-1]instanceof Array&&"openmap"===e[e.length-1][0]&&(l=e[e.length-1][1]?e[e.length-1][1]:null);e={g:b,c:a(e[0]),f:a(e[1]),borderWidth:e[2],s:e[3],ca:e[4],L:e[5],ka:e[6],la:e[7],
ma:e[8],pa:e[9],qa:e[10],F:e[11],h:e[12],G:e[13],fa:e[14],oa:e[15],ia:e[16],sa:e[17],va:e[18],u:a(l)};break;case "pointText":e=e&&0!==e.length?{sid:b,fontRgba:a(e[0]),haloRgba:a(e[1]),backRgba:a(e[2]),fontSize:e[3],haloSize:e[4],fontWeight:e[5],fontStyle:e[6],density:e[7]}:null;break;case "point":l=null;e[e.length-1]&&e[e.length-1]instanceof Array&&"openmap"===e[e.length-1][0]&&(l=e[e.length-1][1]?e[e.length-1][1]:null);e={sid:b,rank:e[0],za:e[1],icon:e[2],iconType:e[3],ta:e[4],density:e[5],zoom:e[6],
hue:l>>>0};break;case "polygon3d":e={g:b,filter:e[0],ratio:e[1],ja:e[2],borderWidth:e[3],c:a(e[4]),o:a(e[5]),j:a(e[6]),ua:e[7]}}e&&(e.da=h[d],f[f.length]=e)}}return f}function a(a){var b=a;if(g[b])return g[b];a>>>=0;g[b]=[a&255,a>>8&255,a>>16&255,a>>24&255];return g[b]}var c={},h={},g={};return{b:function(a,d,g,y,m,k,t){a=(a||"default")+"-"+d+"-"+g+"-"+y;k&&(a+="-indoor");if(m)return h[a]||(h[a]=b(d,g,y,m)),h[a];c[a]||(c[a]=b(d,g,y,m,t));return c[a]},J:function(){c={};h={}}}}();
function cc(){var b=W.bmapLandColor.replace("#","");3===b.length?b+="f":6===b.length&&(b+="ff");for(var a=[],c=b.length,h=8===c?2:1,g=0;g<c;g+=h)2===h?a.push(parseInt(b.slice(g,g+2),16)):a.push(parseInt(b.slice(g,g+1)+b.slice(g,g+1),16));return a}function dc(b,a){if(b.fill)b.fill(a);else for(var c=0;c<b.length;c++)b[c]=a}
Uint8Array.prototype.slice||(Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice}),Object.defineProperty(Uint16Array.prototype,"slice",{value:Array.prototype.slice}),Object.defineProperty(Uint32Array.prototype,"slice",{value:Array.prototype.slice}),Object.defineProperty(Int8Array.prototype,"slice",{value:Array.prototype.slice}),Object.defineProperty(Int16Array.prototype,"slice",{value:Array.prototype.slice}),Object.defineProperty(Int32Array.prototype,"slice",{value:Array.prototype.slice}),
Object.defineProperty(Float32Array.prototype,"slice",{value:Array.prototype.slice}));var vb,J,ec;
function zb(b,a,c,h){b=new Uint8Array(b,a,c);if(self.TextDecoder)return ec||(ec=new TextDecoder("utf-8")),ec.decode(b).replace(/\\\\/g,"\\");if("utf-8"===h)for(h="",a=0;a<b.length;a++)c=b[a],128>c?h+=String.fromCharCode(c):191<c&&224>c?(h+=String.fromCharCode((c&31)<<6|b[a+1]&63),a+=1):223<c&&240>c?(h+=String.fromCharCode((c&15)<<12|(b[a+1]&63)<<6|b[a+2]&63),a+=2):(c=((c&7)<<18|(b[a+1]&63)<<12|(b[a+2]&63)<<6|b[a+3]&63)-65536,h+=String.fromCharCode(c>>10|55296,c&1023|56320),a+=3);else{if(4096>=c)return String.fromCharCode.apply(String,
b);h="";var g=Math.ceil(c/4096);for(a=0;a<g;a++)h+=String.fromCharCode.apply(String,b.slice(4096*a,a===g-1?c:4096*(a+1)))}return h.replace(/\\\\/g,"\\")}function S(b,a,c){var h=a>>2,g=J[h+b];a=4*(g+b+1)+a;var f=[];if(a>c)return f;for(c=0;c<g;c++){var d=J[h+b+1+c],r=a+d;f[c]=[a,d];0!==r%4?a=r+4-r%4:a=r}return f}
var sb=3,fc=1E-5,gc=1,yb=null,bc=null,Yb=null,xb="",W=null,Bb="",Cb=null,ua=new ja,pc=20,Fc=504089,Gc=65536,Hc=[245,245,245,255],Ic=1,Jc=null,Kc=null,Xb={3:{start:3,end:3,a:3},4:{start:4,end:5,a:5},5:{start:4,end:5,a:5},6:{start:6,end:7,a:7},7:{start:6,end:7,a:7},8:{start:8,end:9,a:9},9:{start:8,end:9,a:9},10:{start:10,end:10,a:10},11:{start:11,end:13,a:12},12:{start:11,end:13,a:12},13:{start:11,end:13,a:12},14:{start:14,end:15,a:15},15:{start:14,end:15,a:15},16:{start:16,end:17,a:17},17:{start:16,
end:17,a:17},18:{start:18,end:25,a:19},19:{start:18,end:25,a:19},20:{start:18,end:25,a:19},21:{start:18,end:25,a:19},22:{start:18,end:25,a:19},23:{start:18,end:25,a:19},24:{start:18,end:25,a:19},25:{start:18,end:25,a:19}},ub,Lc,Mc=!1,Nc=[],Oc=!1;function Pc(){Oc||(Oc=!0,qb(function(){Mc=!0;if(Nc.length)for(var b=0;b<Nc.length;b++){var a=Nc[b];Qc(a.data,a.B,a.X)}Nc=[]}))}
self.onmessage=function(b){b=b.data;var a=b.action,c=b.isText,h=b.isPoi,g=b.buildingSideGradation;if(self[a])self[a](b);self.isText=c;self.isPoi=h;self.buildingSideGradation=g};var Wb={0:"00000000",16:"00010000",32:"00100000",48:"00110000",64:"01000000",96:"01100000"};
function Rc(b,a,c,h){var g=b.lng-c.lng,f=b.lat-c.lat,d=a.lng-c.lng,r=a.lat-c.lat,y=h.lng-c.lng,m=h.lat-c.lat,k=(g*m-y*f)*(d*m-y*r);g=c.lng-b.lng;f=c.lat-b.lat;d=a.lng-b.lng;r=a.lat-b.lat;y=h.lng-b.lng;m=h.lat-b.lat;return 0>k&&0>(g*r-d*f)*(y*r-d*m)?!0:!1}function Sc(b,a,c){for(var h=0;h<c.length;h++)if(h===c.length-1?Rc(b,a,c[h],c[0]):Rc(b,a,c[h],c[h+1]))return!0;return!1}
function Gb(b,a){a=a||[];for(var c=a.length,h=0,g=!1,f=0;f<c;f++)h=f===c-1?0:h+1,a[f].lat!==a[h].lat&&(b.lat>=a[f].lat&&b.lat<a[h].lat||b.lat>=a[h].lat&&b.lat<a[f].lat)&&b.lng<(a[h].lng-a[f].lng)*(b.lat-a[f].lat)/(a[h].lat-a[f].lat)+a[f].lng&&(g=!g);return g}
function Tc(b){var a=self.area,c=b.mercatorSize,h=b.col*c,g=b.row*c;b=h+c;var f=g+c;var d=-Infinity,r=-Infinity,y=Infinity,m=Infinity;for(c=0;c<a.length;c++)d<a[c].lng&&(d=a[c].lng),r<a[c].lat&&(r=a[c].lat),y>a[c].lng&&(y=a[c].lng),m>a[c].lat&&(m=a[c].lat);c=!1;if(b<=y||h>=d||f<=m||g>=r)return c;d=[{},{},{},{}];d[0].lng=h;d[0].lat=g;d[1].lng=h;d[1].lat=f;d[2].lng=b;d[2].lat=f;d[3].lng=b;d[3].lat=g;for(h=0;h<d.length;h++)if(c=h===d.length-1?Sc(d[h],d[0],a):Sc(d[h],d[h+1],a))return c;for(h=0;h<a.length;h++)if(Gb(a[h],
d))return c=!0;for(h=0;h<d.length;h++)if(Gb(d[h],a)){c=!0;break}return c}function md(b){b=b.map(function(a){return a/100});for(var a=2;a<b.length;a+=2)for(var c=0;2>c;c++)b[a+c]=b[a+c-2]+b[a+c];return b}function Ab(b,a){if(!Wb[b]){var c=b.toString(2);8>c.length&&(c=Array(8-c.length+1).join("0")+c);Wb[b]=c}c=Wb[b];return"1"===c[(20<a?21:a)-Xb[a].start]}
function Qc(b,a,c){ta("finishLoadTile");try{ta("begin(ParseData)"),self.area&&Tc(a)&&(a.areaCustom=!0),nd(b,a,c,function(a){ta("finishParseData");a.base=a.a;a.base3d=a.D;a.virtual=a.Y;a.building3d=a.H;a.building3dMesh=a.I;a.indoorData=a.T;a.indoorBase=a.O;a.indoorBaseContour=a.P;a.indoorBorder3D=a.R;a.indoorArea3D=a.N;a.label=a.label;a.tileInfo=a.B;for(var b=[],c=0;c<a.base.length;c++){var d=a.base[c];b.push(d.data[0].buffer);b.push(d.data[1].buffer)}if(a.base3d)for(c=0;c<a.base3d.length;c++)d=a.base3d[c],
"block"===d.type?(b.push(d.data.vertex.buffer),b.push(d.data.index.buffer)):(b.push(d.data[0].buffer),b.push(d.data[1].buffer));if(a.virtual)for(c=0;c<a.virtual.length;c++)d=a.virtual[c],b.push(d.data[0].buffer),b.push(d.data[1].buffer);a.building3d&&(b.push(a.building3d.vertex.buffer),b.push(a.building3d.index.buffer));if(a.indoorBase)for(c=0;c<a.indoorBase.length;c++)d=a.indoorBase[c],b.push(d.data[0].buffer),b.push(d.data[1].buffer);if(a.indoorBaseContour)for(c=0;c<a.indoorBaseContour.length;c++)d=
a.indoorBaseContour[c],b.push(d.data[0].buffer),b.push(d.data[1].buffer);if(a.indoorBorder3D&&a.indoorBorder3D&&0<a.indoorBorder3D.length)for(c=0;c<a.indoorBorder3D.length;c++)b.push(a.indoorBorder3D[c].data[0].buffer),b.push(a.indoorBorder3D[c].data[1].buffer);if(a.indoorArea3D&&0<a.indoorArea3D.length)for(c=0;c<a.indoorArea3D.length;c++)b.push(a.indoorArea3D[c].vertex.buffer),b.push(a.indoorArea3D[c].index.buffer);a.label&&(a.label.textImageBitmap&&b.push(a.label.textImageBitmap),a.label.indoorTextImageBitmap&&
b.push(a.label.indoorTextImageBitmap));a.perfStat=[va("beginLoadTile","finishLoadTile"),va("finishLoadTile","beginParseData"),va("beginParseData","finishParseData"),Lc];a.endTime=Date.now();postMessage(a,b)})}catch(h){console.log("\u89e3\u6790\u5f02\u5e38\uff1a",h),postMessage({tileInfo:a,tileKey:c,error:"parse_error",message:h.message})}}self.setWorkerConfig=function(b){for(var a in b)b.hasOwnProperty(a)&&(self[a]=b[a])};self.clearStyleCache=function(){wb.J()};
self.loadTileData=function(b){var a=b.url,c={};c.baseTileSize=b.tileInfo.baseTileSize;c.col=b.tileInfo.col;c.loopOffsetX=b.tileInfo.loopOffsetX;c.mercatorSize=b.tileInfo.mercatorSize;c.row=b.tileInfo.row;c.tileSize=b.tileInfo.tileSize;c.tileTypeName=b.tileInfo.tileTypeName;c.useZoom=b.tileInfo.useZoom;c.zoom=b.tileInfo.zoom;c.processedLabelZooms=b.tileInfo.processedLabelZooms;c.hasPoly=b.hasPoly;c.hasLine=b.hasLine;c.carport=b.carport;var h=b.tileKey;b.featureStyle&&(yb=JSON.parse(b.featureStyle),
bc=Cb=W=null);b.indoorStyle&&(bc=JSON.parse(b.indoorStyle));b.iconSetInfo&&(Yb=JSON.parse(b.iconSetInfo));b.iconInfo&&(ub=b.iconInfo.textSizeRatio);b.mapStyleId&&(xb=b.mapStyleId);b.areaStyleId&&(Bb=b.areaStyleId);b.customMapStyle&&(W=JSON.parse(b.customMapStyle),yb=null);b.areaMapStyle&&(Cb=JSON.parse(b.areaMapStyle));c.style=xb;Jc=Kc=null;Lc=0;var g=new XMLHttpRequest;g.open("GET",a,!0);b=b.tileInfo.header;if(b instanceof Array)for(var f=0;f<b.length;f++)b[f]&&b[f].hasOwnProperty("key")&&b[f].hasOwnProperty("value")&&
g.setRequestHeader(b[f].key,b[f].value);g.responseType="arraybuffer";g.timeout=1E4;g.ontimeout=function(){postMessage({tileInfo:c,tileKey:h,error:"net_timeout",message:"net status: timeout"})};g.onreadystatechange=function(){4===this.readyState&&(200===this.status&&(Lc=Math.round(g.response.byteLength/1024),Mc?Qc(g.response,c,h):Nc[Nc.length]={data:g.response,B:c,X:h}),(400<=this.status||0===this.status)&&postMessage({tileInfo:c,tileKey:h,error:"net_error",message:"net status: "+this.status,event:{title:a,
ra:JSON.stringify({responseURL:a,status:this.status})}}))};g.send();Pc();ta("beginLoadTile")};
function nd(b,a,c,h){var g=[],f=[],d=[],r=0,y=a.useZoom,m=null,k=null;J=new Uint32Array(b);vb=new Int32Array(b);Ic=J[0];var t=S(J[1]+2,0,b.byteLength),e=S(0,t[0][0],t[0][0]+t[0][1]),l=!1,A=void 0===a.hasLine?!0:a.hasLine,z=void 0===a.hasPoly?!0:a.hasPoly;if(z){for(var p=0;p<e.length;p++){var n=e[p],v=n[0]>>2,w=J[v+1];if(7===w){l=!0;break}}!1===l&&(r=$b(null,null,a,g,r,0))}for(p=0;p<e.length;p++)if(n=e[p],v=n[0]>>2,w=J[v+1],l=J[v+2],7===w&&z)r=$b(b,n,a,g,r,0);else if(4===w&&A)13E3===l||83500===l?od(b,
n,y,d,0):r=od(b,n,y,g,r);else if(15===w&&A){var H=r;r=$b(b,n,a,f,r,1,{v:!0,K:[501776]});r=$b(b,n,a,f,r,1,{v:!0,M:[501776]})}else 16===w&&A?r=od(b,n,y,f,r,!0):18===w&&A?W&&W.zoomFrontStyle&&W.zoomFrontStyle[y]&&"off"===W.zoomFrontStyle[y].bmapRoadarrowVisibility||(r=pd(b,n,y,f,r)):19===w&&A?r=qd(b,n,y,g,r):20===w&&A&&(r=rd(b,n,y,f,r));A&&((m=sd(e,a))&&f.push({type:"block",data:m,has3D:!0,has2D:!1}),m=ac(b,e,a),p=td(b,e,a),0<p&&(k={vertex:new Float32Array(7*p),index:new Uint16Array(p/3)},td(b,e,a,k.vertex,
k.index)));p={W:zb(b,t[3][0],t[3][1],void 0)||"",height:J[2]||0};var x=rb(b,e,t[2],p,a)||{};x.textImgStr=p.W||null;x.indoorLabel=[];t[4][1]&&J[3]?(x.indoorTextImgStr=zb(b,t[4][0],t[4][1],void 0)||null,x.indoorTextureHeight=J[3]):x.indoorTextImgStr=null;if(z){var u=Zb(b,t[1],a,H?H:r);if(u.indoorDataResult)for(var K in u.indoorDataResult)if("tileInfo"!==K)for(b=u.indoorDataResult[K],r=b.defaultFloor,u.indoorDataResult[K].tileKey=c,p=0;p<b.floors.length;p++)r===p&&b.floors[p].pois&&(x.indoorLabel=x.indoorLabel.concat(b.floors[p].pois));
J=vb=null}g.length&&(g=ud(g));var D={a:g,D:f.length?f:null,Y:d.length?d:null,H:m,I:k,T:u?u.indoorDataResult:null,na:u?u.indoorBase3D:null,O:u?u.indoorBase:null,P:u?u.indoorBaseContour:null,R:u?u.indoorBorder3D:null,N:u?u.indoorArea3D:null,label:x,B:a};if((x.textImgStr||x.indoorTextImgStr)&&self.fetch&&self.createImageBitmap&&self.Promise){var q=function(){h(D)},C=0;x.textImgStr&&(C++,fetch(x.textImgStr).then(function(a){a.blob().then(function(a){createImageBitmap(a,{imageOrientation:"flipY"}).then(function(a){x.textImageBitmap=
a;x.textImgStr=null;C--;0===C&&h(D)},q)},q)},q));x.indoorTextImgStr&&(C++,fetch(x.indoorTextImgStr).then(function(a){a.blob().then(function(a){createImageBitmap(a,{imageOrientation:"flipY"}).then(function(a){x.indoorTextImageBitmap=a;x.indoorTextImgStr=null;C--;0===C&&h(D)},q)},q)},q))}else h(D)}
function ud(b){for(var a=void 0,c=-1,h=0,g=0,f=!1,d=0;d<b.length;d++)"fill"!==b[d].type||0!==b[d].up?(a=void 0,c=-1):(-1===c&&(c=b[d].texture),-1!==c&&b[d].texture!==c?c=b[d].texture:b[d].type===a?(b[h]=vd(b[h],b[d],g),b[d].U=!0,g+=b[d].i,f=!0):(h=d,a=b[d].type,g=b[d].i));return f?b.filter(function(a){return!a.U}):b}function vd(b,a,c){var h=b.data[1],g=a.data[1];b.data[0]=wd(b.data[0],a.data[0]);b.data[1]=wd(h,g,c);b.has3D=b.has3D||a.has3D;b.has2D=b.has2D||a.has2D;return b}
function wd(b,a,c){if(b.constructor===ArrayBuffer){var h=new Uint8Array(b.byteLength+a.byteLength);h.set(new Uint8Array(b),0);h.set(new Uint8Array(a),b.byteLength);return h.buffer}h=new b.constructor(b.length+a.length);h.set(b,0);if(c)for(var g=0;g<a.length;g++)a[g]+=c;h.set(a,b.length);return h}function xd(b,a,c){for(var h=0;h<a.length;h++)b[b.length]=a[h]+c}
function $b(b,a,c,h,g,f,d){var r=[];b&&(r=a?a[0]>>2:0,r=J[r],r=S(r+1,a[0],a[0]+a[1]));a=0;var y=c.baseTileSize;c=c.useZoom;var m=[],k=[],t=[],e=[];d=d||{};var l=d.w||!1,A=d.v||!1,z=d.S||!1,p=d.K||[];d=d.M||[];var n="",v="";A||0!==g||(k=Hc,W&&W.bmapLandColor&&(k=cc()),W&&W.bmapLandFillTexture&&(n=W.bmapLandFillTexture),m=[0,0,0,k[0],k[1],k[2],k[3],0,y,0,0,k[0],k[1],k[2],k[3],0,y,y,0,k[0],k[1],k[2],k[3],0,0,y,0,k[0],k[1],k[2],k[3],0],k=[0,1,2,0,2,3],t=[72],e=[20]);1===f?(g++,a=g,g+=5):2===f&&(a=g+3*
r.length+1);for(var w=[],H=[],x=!1,u=!1,K=0;K<r.length;K++){var D=r[K];v=D[0]>>2;var q=J[v],C=J[v+1];if(!(!d.length&&p.length&&0<=p.findIndex(function(a){return a===C})||!p.length&&d.length&&0>d.findIndex(function(a){return a===C}))&&(v=wb.b(xb,C,"polygon",c,l?bc:yb,l,W))&&v.length){var F=v[0];if(F.g){if(6<c&&(71013===F.g||71012===F.g||71011===F.g))continue;if(5<c&&71011===F.g)continue;if(5>c&&(71012===F.g||71013===F.g))continue}v=F.h||"";var X=F.f[0],O=F.f[1],L=F.f[2],M=F.f[3],Y=F.c[0],T=F.c[1],
V=F.c[2],U=F.c[3],aa=F.borderWidth/4,Z=2.5*aa;D=S(q+1,D[0],D[0]+D[1]);g+=3;for(q=0;q<D.length;q++){var Q=D[q],N=Q[0]>>2,I=J[N];if(Ab(J[N+1],c)||C===Fc){var ba=S(I+1,Q[0],Q[0]+Q[1]);Q=new Int32Array(b,ba[0][0],ba[0][1]>>2);if(Q.length&&!(4E3<Q.length)){var R=new Uint16Array(b,ba[2][0],ba[2][1]>>1);!0!==z&&R&&(m.length/8+Q.length/2>Gc||n!==v)&&(m=yd(m),h.push({type:"fill",data:[m,new Uint16Array(k)],i:m.byteLength/pc,has3D:x,has2D:u,texture:n,up:d.length?1:0,verticesLength:e,styleIds:t}),m=[],k=[],
t=[],e=[],u=x=!1,n=v);I=null;var P=!1;if(A){var G=1<Ic?new Int16Array(b,ba[1][0],ba[1][1]>>1):new Uint16Array(b,ba[1][0],ba[1][1]>>1);if(1===G.length&&G[0])I=Array(Q.length>>1),0>G[0]&&(P=!0),dc(I,G[0]),x=!0;else if(1<G.length){I=[];for(var E=0;E<G.length;E++)0>G[E]&&(P=!0),I[E]=G[E]||gc;x=!0}else u=!0}E=m.length/8;G=bb(Q);N=J[N+2];z&&1===N&&(aa=Z);if(!0!==z&&(R.length&&xd(k,R,E),R)){E=0;for(N=G.length/2;E<N;E++)R=I?I[E]:0,m.push(G[2*E],G[2*E+1],R,X,O,L,M,g);t.push(C);e.push(m.length/1.6)}if(I&&!P)for(w.length/
8+G.length/2*2>Gc&&(w=yd(w),H=new Uint16Array(H),h.push({type:"fill",data:[w,H],i:w.byteLength/pc,has3D:x,has2D:u,up:d.length?1:0}),H=[],w=[]),N=w.length/8,E=0;E<G.length;E+=2){R=I[E/2];P=R-280;0>P&&(P=0);w.push(G[E],G[E+1],R,Y,T,V,U,g,G[E],G[E+1],P,Y,T,V,U,g);P=G[E];R=G[E+1];var fa=E===G.length-2?G[1]:G[E+3],oa=!1;if(P===(E===G.length-2?G[0]:G[E+2])){if(Math.abs(P)<fc||Math.abs(P-y)<fc)oa=!0}else R===fa&&(Math.abs(R)<fc||Math.abs(R-y)<fc)&&(oa=!0);oa||(E===G.length-2?H.push(N+E,N+E+1,N,N,N+E+1,N+
1):H.push(N+E,N+E+1,N+E+2,N+E+2,N+E+1,N+E+3))}if(f&&F.borderWidth&&G.length){if(G[0]-G[G.length-2]>fc||G[1]-G[G.length-1]>fc)G[G.length]=G[0],G[G.length]=G[1],I&&(I[I.length]=I[0]);if(ba[3])for(ba=S(0,ba[3][0],ba[3][0]+ba[3][1]),G=0;G<ba.length;G++)E=ba[G],P=S(0,E[0],E[0]+E[1]),E=new Int16Array(b,P[0][0],P[0][1]>>1),nb()+E.length/2>Gc&&(h.push({type:"line",border:!0,data:[db(),fb()],has3D:x,has2D:u,up:d.length?1:0}),pb()),N=new Uint16Array(b,P[1][0],P[1][1]>>1),P=new Int8Array(b,P[2][0],P[2][1]),
ob(E,[Y,T,V,U],aa,I,a,!1,Q,P,0,N[0],N[1])}}}}}}w.length&&(w=yd(w),H=new Uint16Array(H),h.push({type:"fill",data:[w,H],i:w.byteLength/pc,has3D:x,has2D:u,up:d.length?1:0}));m.length&&(m=yd(m),h.push({type:"fill",data:[m,new Uint16Array(k)],i:m.byteLength/pc,has3D:x,has2D:u,texture:n,verticesLength:e,styleIds:t,up:d.length?1:0}));f&&(h.push({type:"line",border:!0,data:[db(),fb()],has3D:x,has2D:u,up:d.length?1:0}),pb());return Math.max(g,a)}
function od(b,a,c,h,g,f){a=S(J[a[0]>>2]+1,a[0],a[0]+a[1]);for(var d=!1,r=!1,y=[],m=[],k=0;2>k;k++){0===k&&g++;for(var t=0;t<a.length;t++){var e=a[t],l=e[0]>>2,A=J[l],z=J[l+1];if((l=wb.b(xb,z,"line",c,yb,!1,W))&&l.length&&(71059!==z||self.isText)&&(0!==k||l[0].borderWidth)&&(e=S(A+1,e[0],e[0]+e[1]),0!==k||!l[0].h))if(1===k&&l[0].h){var p=l[0].h,n=l[0].u;A=p;var v=Yb[A]||Yb["MapRes/"+A];if(v){v=[v[0],v[1]];nb()&&(h[h.length]={type:"line",data:[db(),fb()],has3D:d,has2D:r,styleIds:y,verticesLength:m},
pb(),r=d=!1,m=[],y=[]);/guojietianqiaojieti/.test(p)?g+=20:g++;var w=l[0].s/4,H=f?!0:!1,x=!1;/\b(32|16|8|4)$/.test(A)&&(w*=5,v[1]*=2,x=H=!0,p=p.replace(/\b4$/,"8"));var u=!1,K=!1;for(A=0;A<e.length;A++){var D=e[A],q=D[0]>>2,C=J[q];q=J[q+1];if(Ab(q,c)&&(q=S(C+1,D[0],D[0]+D[1]),D=null,C=new Int32Array(b,q[0][0],q[0][1]>>2),C.length&&!(8E3<C.length))){if(x&&4===C.length){var F=C,X=F[2],O=F[3],L=Math.sqrt(X*X+O*O);L=800*~~(L/800)/L;F[2]=~~(X*L);F[3]=~~(O*L)}if(f){var M=1<Ic?new Int16Array(b,q[1][0],q[1][1]>>
1):new Uint16Array(b,q[1][0],q[1][1]>>1);if(1===M.length&&M[0])D=Array(C.length>>1),dc(D,M[0]),u=!0;else if(1<M.length){D=[];for(u=0;u<M.length;u++)D[u]=M[u]||gc;u=!0}else K=!0}F=new Int16Array(b,q[2][0],q[2][1]>>1);X=new Int8Array(b,q[3][0],q[3][1]);ob(F,l[0].f,w,D,g,!0,C,X,1);y.push(z);m.push(5*nb())}}nb()&&(h[h.length]={type:"line",textureSize:v,texture:p+".png",hue:n,lineWidth:l[0].s/2,data:[db(),fb()],has3D:u,has2D:K,zoomWithMap:H,styleIds:y,verticesLength:m},y=[],m=[],pb())}}else if(0===k?(z=
l[0].c,p=l[0].borderWidth):(z=l[0].f,p=l[0].s),p/=4,!(0===p||0===z[3]||100<p))for(1===k&&g++,A=0;A<e.length;A++)if(D=e[A],q=D[0]>>2,C=J[q],q=J[q+1],Ab(q,c)&&(q=S(C+1,D[0],D[0]+D[1]),C=new Int32Array(b,q[0][0],q[0][1]>>2),C.length&&!(8E3<C.length))){F=new Int16Array(b,q[2][0],q[2][1]>>1);X=new Int8Array(b,q[3][0],q[3][1]);nb()+F.length/2>Gc&&(h[h.length]={type:"line",data:[db(),fb()],has3D:d,has2D:r},r=d=!1,pb());D=null;if(f)if(1<Ic?M=new Int16Array(b,q[1][0],q[1][1]>>1):M=new Uint16Array(b,q[1][0],
q[1][1]>>1),1===M.length&&M[0])D=Array(C.length>>1),dc(D,M[0]),d=!0;else if(1<M.length){D=[];for(d=0;d<M.length;d++)D[d]=M[d]||gc;d=!0}else r=!0;ob(F,z,p,D,g,1===l[0].L,C,X,0)}}}nb()&&(h[h.length]={type:"line",data:[db(),fb()],has3D:d,has2D:r,styleIds:y,verticesLength:m},pb());return g}
function rd(b,a,c,h,g){var f=S(J[a[0]>>2]+1,a[0],a[0]+a[1]),d=[];a=[];for(var r=!1,y=!1,m=0;m<f.length;m++){var k=f[m];k=S(J[k[0]>>2]+1,k[0],k[0]+k[1])[0];var t=k[0]>>2,e=J[t];if(Ab(J[t+1],c)){var l=S(e+1,k[0],k[0]+k[1]);k=new Int32Array(b,l[0][0],l[0][1]>>2);k=bb(k);e=1<Ic?new Int16Array(b,l[3][0],l[3][1]>>1):new Uint16Array(b,l[3][0],l[3][1]>>1);t=void 0;if(1===e.length&&e[0])t=Array(k.length>>1),dc(t,e[0]),r=!0;else if(1<e.length){t=[];for(var A=0;A<e.length;A++)t[A]=e[A]||1;r=!0}else y=!0;e=new Uint32Array(b,
l[2][0],l[2][1]>>2);A=d.length/8;g+=8;var z=wb.b(xb,e[0],"polygon",c,yb,!1,W),p=wb.b(xb,e[1],"polygon",c,yb,!1,W);if(z&&z.length&&p&&p.length){var n=new Int32Array(b,l[1][0],l[1][1]>>2);e=[n[0]/100,n[1]/100];z=z[0].f;n=[n[2]/100,n[3]/100];p=p[0].f;var v=[n[0]-e[0],n[1]-e[1]],w=Math.sqrt(Math.pow(v[0],2)+Math.pow(v[1],2));xd(a,new Uint16Array(b,l[4][0],l[4][1]>>1),A);A=0;for(l=k.length/2;A<l;A++){var H=[k[2*A],k[2*A+1]];if(0===v[0]){var x=e[0];var u=H[1]}else u=-((e[0]-H[0])*v[0]+(e[1]-H[1])*v[1])/
(v[0]*v[0]+v[1]*v[1]),x=u*v[0]+e[0],u=u*v[1]+e[1];u=Math.sqrt(Math.pow(x-n[0],2)+Math.pow(u-n[1],2))/w;if(e[0]<n[0]&&x<e[0]||e[0]>n[0]&&x>e[0])u=1;else if(e[0]<n[0]&&x>n[0]||e[0]>n[0]&&x<n[0])u=0;d.push(H[0],H[1],t?t[A]:0,u*z[0]+(1-u)*p[0],u*z[1]+(1-u)*p[1],u*z[2]+(1-u)*p[2],u*z[3]+(1-u)*p[3],g)}}}}d.length&&(b=yd(d),h.push({type:"fill",data:[b,new Uint16Array(a)],i:b.byteLength/pc,has3D:r,has2D:y}));return g}
function pd(b,a,c,h,g){var f=S(J[a[0]>>2]+1,a[0],a[0]+a[1]);if(!f.length)return g;a=[];var d=[];g++;var r=bb(new Int32Array(b,f[0][0],f[0][1]>>2)),y=new Int32Array(b,f[1][0],f[1][1]>>2);b=new Int16Array(b,f[2][0],f[2][1]>>1);var m=f=!1;1===b.length&&0===b[0]?m=!0:f=!0;b=bb(b,1);if(1===b.length){var k=b[0];b=Array(r.length>>1);dc(b,k)}for(k=0;k<y.length;k++)if(Ab(y[k],c)){var t=[r[4*k],r[4*k+1],b[2*k]],e=[r[4*k+2],r[4*k+3],b[2*k+1]],l=[(t[0]+e[0])/2,(t[1]+e[1])/2,(t[2]+e[2])/2],A=l[0]-t[0],z=l[1]-
t[1],p=[e[0]-t[0],e[1]-t[1]],n=p[0]*p[0]+p[1]*p[1];0<n&&(n=1/Math.sqrt(n),p[0]*=n,p[1]*=n);n=a.length/10;a[a.length]=l[0];a[a.length]=l[1];a[a.length]=t[2];a[a.length]=-A;a[a.length]=-z;a[a.length]=-p[1];a[a.length]=p[0];a[a.length]=.125;a[a.length]=.3125;a[a.length]=g;a[a.length]=l[0];a[a.length]=l[1];a[a.length]=t[2];a[a.length]=-A;a[a.length]=-z;a[a.length]=p[1];a[a.length]=-p[0];a[a.length]=.125;a[a.length]=.6875;a[a.length]=g;a[a.length]=l[0];a[a.length]=l[1];a[a.length]=e[2];a[a.length]=A;a[a.length]=
z;a[a.length]=-p[1];a[a.length]=p[0];a[a.length]=1;a[a.length]=.3125;a[a.length]=g;a[a.length]=l[0];a[a.length]=l[1];a[a.length]=e[2];a[a.length]=A;a[a.length]=z;a[a.length]=p[1];a[a.length]=-p[0];a[a.length]=1;a[a.length]=.6875;a[a.length]=g;d[d.length]=n;d[d.length]=n+1;d[d.length]=n+2;d[d.length]=n+2;d[d.length]=n+1;d[d.length]=n+3}d.length&&h.push({type:"arrow",data:[new Float32Array(a),new Uint16Array(d)],has3D:f,has2D:m});return g}
function qd(b,a,c,h,g){a=S(J[a[0]>>2]+1,a[0],a[0]+a[1]);g++;for(var f=0;f<a.length;f++){var d=a[f],r=d[0]>>2,y=J[r];if((r=wb.b(xb,J[r+1],"line",c,yb,!1,W))&&r.length){var m=r[0];if("undefined"!==typeof m.h){var k=m.h+".png";m=m.u;d=S(y+1,d[0],d[0]+d[1]);for(y=0;y<d.length;y++){var t=d[y],e=t[0]>>2,l=J[e];Ab(J[e+1],c)&&(e=J[e+2]/20,t=S(l+1,t[0],t[0]+t[1]),ob(new Int16Array(b,t[2][0],t[2][1]>>1),r[0].f,e,null,g,!0,new Int32Array(b,t[0][0],t[0][1]>>2),new Int8Array(b,t[3][0],t[3][1]),2))}h[h.length]=
{type:"line",texture:k,hue:m,isSingle:!0,data:[db(),fb()]};pb()}}}return g}
function ac(b,a,c,h){var g=c.useZoom;if(!a||!a.length)return null;for(var f=[],d=[],r=[],y=[],m=0;m<a.length;m++){var k=a[m],t=k[0]>>2,e=J[t];if(8===J[t+1])for(k=S(e+1,k[0],k[0]+k[1]),t=0;t<k.length;t++){var l=k[t];e=l[0]>>2;var A=J[e];e=J[e+1];var z=wb.b(xb,e,"polygon3d",g,h?bc:yb,!1,W);if(c.areaCustom&&Cb)var p=wb.b(Bb,e,"polygon3d",g,h?bc:yb,!1,Cb);if(z&&z[0]||p&&p[0])for(l=S(A+1,l[0],l[0]+l[1]),A=0;A<l.length;A++){if(z&&z[0]){var n=z[0];var v=n.o;var w=n.j;var H=0;if(n.borderWidth){var x=n.c[0];
var u=n.c[1];var K=n.c[2];var D=n.c[3];H=n.borderWidth/4}Jc||(Jc=v,Kc=w)}var q=l[A],C=q[0]>>2,F=J[C];if(Ab(J[C+1],g)){C=J[C+2];var X=Number(self.buildingSideGradation);if(!(C<n.filter)){F=S(F+1,q[0],q[0]+q[1]);q=new Int32Array(b,F[0][0],F[0][1]>>2);for(var O=new Uint16Array(b,F[1][0],F[1][1]>>1),L=md(q),M=c.mercatorSize*c.col,Y=c.mercatorSize*c.row,T=[],V=0;V<L.length;V+=2)T.push({lng:L[V]/2+M,lat:L[V+1]/2+Y});Y=M=L=0;for(V=1;V<=T.length;V++){var U=T[V%T.length].lat,aa=T[V%T.length].lng,Z=T[V-1].lat,
Q=T[V-1].lng,N=(U*Q-aa*Z)/2;L+=N;M+=N*(U+Z)/3;Y+=N*(aa+Q)/3}L={lat:M/L,lng:Y/L};y.push(L);Gb(L,self.area)&&p&&p[0]&&(n=p[0],v=p[0].o?p[0].o:v,w=p[0].j?p[0].j:w,x=p[0].c[0],u=p[0].c[1],K=p[0].c[2],D=p[0].c[3],H=p.borderWidth/4,r.push(T));T=q;L=C;M=v[0];Y=v[1];V=v[2];U=v[3];aa=w[0];Z=w[1];Q=w[2];N=w[3];var I=T;Qa||(Qa=B._get_block_points_address()>>2);Ea.set(I,Qa);I=O;Ya||(Ya=B._get_block_triangle_indices_address()>>1);Ja.set(I,Ya);B._append_block_data(T.length,O.length,L,X,M,Y,V,U,aa,Z,Q,N);f.push(e);
d.push(7*cb());if(n.borderWidth&&q.length&&(X=Array(q.length>>1),dc(X,100*C),F[2]))for(C=S(0,F[2][0],F[2][0]+F[2][1]),F=0;F<C.length;F++)O=C[F],L=S(0,O[0],O[0]+O[1]),O=new Int16Array(b,L[0][0],L[0][1]>>1),T=new Uint16Array(b,L[1][0],L[1][1]>>1),L=new Int8Array(b,L[2][0],L[2][1]),ob(O,[x,u,K,D],H,X,2,!0,q,L,0,T[0],T[1])}}}}}b={type:"line",data:[db(),fb()]};pb();return 0<cb()?($a||($a=B._get_block_vertex_start()),a=new Float32Array(wa.slice($a,B._get_block_vertex_end())),Za||(Za=B._get_block_index_start()),
c=new Uint16Array(wa.slice(Za,B._get_block_index_end())),f={vertex:a,index:c,styleIds:f,verticesLength:d},B._reset_block(),f.border=b,f):null}function yd(b){var a=new ArrayBuffer(b.length/8*20),c=new Float32Array(a);a=new Uint8Array(a);for(var h=0,g=12,f=4,d=0;d<b.length;d+=8)c[h]=b[d],c[h+1]=b[d+1],c[h+2]=b[d+2]/100,a[g]=b[d+3],a[g+1]=b[d+4],a[g+2]=b[d+5],a[g+3]=b[d+6],c[f]=b[d+7],h+=5,g+=20,f+=5;return c}
function td(b,a,c,h,g){if(!a||!a.length)return 0;c=c.useZoom;for(var f=0,d=0,r=0,y=0,m=0;m<a.length;m++){var k=a[m],t=k[0]>>2;if(25===J[t+1]){k=S(J[t]+1,k[0],k[0]+k[1])[0];var e=k[0]>>2;t=J[e];if((e=wb.b(xb,J[e+1],"polygon3d",c,yb,!1,W))&&e[0]){e=e[0];var l=e.j;Kc&&(l=Kc);k=S(t+1,k[0],k[0]+k[1])[0];t=S(J[k[0]>>2]+1,k[0],k[0]+k[1]);k=new Int32Array(b,t[1][0],t[1][1]>>2);f+=k.length;if(h){e=new Int32Array(b,t[2][0],t[2][1]>>2);t=k;for(var A=h,z=y,p=new DataView(A.buffer),n,v=0;v<t.length;v+=3)n=v/3*
7+z,A[n]=t[v]/100,A[n+1]=t[v+1]/100,A[n+2]=t[v+2]/100,A[n+3]=e[v],A[n+4]=e[v+1],A[n+5]=e[v+2],p.setUint8(4*n+24,l[0]),p.setUint8(4*n+25,l[1]),p.setUint8(4*n+26,l[2]),p.setUint8(4*n+27,l[3]);t=[];for(e=0;e<k.length/3;e++)t.push(e+d);g.set(t,r);y+=k.length/3*7;r+=t.length;d+=k.length/3}}}}return f}
function sd(b,a){var c=[],h=[];a=a.useZoom;for(var g=0;g<b.length;g++){var f=b[g],d=f[0]>>2;if(24===J[d+1]){d=S(J[d]+1,f[0],f[0]+f[1])[0];f=d[0]>>2;var r=J[f];if((f=wb.b(xb,J[f+1],"polygon3d",a,yb,!1,W))&&f[0])for(f=f[0],f=f.j,Kc&&(f=Kc),d=S(r+1,d[0],d[0]+d[1]),r=0;r<d.length;r++){var y=d[r][0]/4,m=c,k=h,t=c.length/10,e=J[y+1]/100,l=J[y+2]/100,A=J[y+3]/100,z=J[y+4]/100,p=f[0],n=f[1],v=f[2];for(y=0;360>=y;y+=36){var w=Math.cos(y*Math.PI/180)*l+A,H=Math.sin(y*Math.PI/180)*l+z,x=w+A,u=H+z;m.push(w,H,
0,x,u,0,p,n,v,255);m.push(w,H,e,x,u,0,p,n,v,255)}for(y=0;10>y;y++)m=2*y+t,k.push(m,m+2,m+3),k.push(m,m+3,m+1)}}}if(0<c.length){b=c.length/10;a=new Float32Array(7*b);g=new DataView(a.buffer);for(d=0;d<b;d++)f=7*d,a[f]=c[10*d],a[f+1]=c[10*d+1],a[f+2]=c[10*d+2],a[f+3]=c[10*d+3],a[f+4]=c[10*d+4],a[f+5]=c[10*d+5],g.setUint8(4*f+24,c[10*d+6]),g.setUint8(4*f+25,c[10*d+7]),g.setUint8(4*f+26,c[10*d+8]),g.setUint8(4*f+27,c[10*d+9]);c={vertex:a,index:new Uint16Array(h)}}else c=null;return c};
