/**/ï»¿_jsload&&_jsload('oppc', 'function g2(){this._currentState="idle";this._currentTouchCount=0;this._firstPointerId=-1;this._secondPointerId=-1}g2.prototype.takeAction=function(e,i){if(this["_on"+e]){this["_on"+e](i)}return this.getState()};g2.prototype._onmousedown=function(e){if(this._currentTouchCount===0){this._firstPointerId=e}else{if(this._currentTouchCount===1){this._secondPointerId=e}}this._currentTouchCount++;if(this._currentState==="idle"){this._currentState="readyToDrag"}else{if(this._currentState==="dragging"||this._currentState==="readyToDrag"){this._currentState="readyToPinch"}else{if(this._currentState==="pinching"){this._currentState="freeze"}else{this._currentState="freeze"}}}};g2.prototype._onmousemove=function(){if(this._currentState==="readyToDrag"||this._currentState==="dragging"){this._currentState="dragging"}else{if(this._currentState==="readyToPinch"){this._currentState="pinching"}}};g2.prototype._onmouseup=function(e){if(this._currentState==="idle"){return}this._currentTouchCount--;if(this._currentState==="readyToDrag"||this._currentState==="dragging"){this._currentState="idle";this._firstPointerId=-1;this._secondPointerId=-1}else{if(this._currentState==="readyToPinch"||this._currentState==="pinching"){this._clearId(e);this._currentState="freeze"}else{if(this._currentState==="freeze"){if(this._currentTouchCount===0){this._currentState="idle";this._firstPointerId=-1;this._secondPointerId=-1;return}if(this._currentTouchCount===2){if(e!==this._firstPointerId&&e!==this._secondPointerId){this._currentState="pinching"}}if(e===this._firstPointerId||e===this._secondPointerId){this._clearId(e);this._currentState="freeze"}}}}};g2.prototype._ongesturestart=function(){if(window.TouchEvent||!window.GestureEvent){return}if(this._currentState==="idle"||this._currentState==="readyToDrag"){this._currentState="readyToPinch"}};g2.prototype._ongesturechange=function(){if(window.TouchEvent||!window.GestureEvent){return}if(this._currentState==="readyToPinch"){this._currentState="pinching"}};g2.prototype._ongestureend=function(){if(window.TouchEvent||!window.GestureEvent){return}if(this._currentState==="readyToPinch"||this._currentState==="pinching"||this._currentState==="freeze"){this._currentState="idle"}};g2.prototype.getState=function(){return ep[this._currentState]||0};g2.prototype.reset=function(){this._currentState="idle";this._currentTouchCount=0;this._firstPointerId=-1;this._secondPointerId=-1};g2.prototype._clearId=function(e){if(e===this._firstPointerId){this._firstPointerId=-1}else{if(e===this._secondPointerId){this._secondPointerId=-1}}};g2.prototype.setState=function(e){this._currentState=e};bG.register(function(e){if(e._mouse){return}e._mouse=new gG(e);if(!e._mouse._drag){e._mouse=null}if(e._renderType==="webgl"){e.addEventListener("dblclick",function(i){if(!e.config.enableDblclickZoom){return}this.zoomIn(i.point)});e.addEventListener("rightdblclick",function(i){if(!e.config.enableDblclickZoom){return}this.zoomOut(i.point)});e.addEventListener("minuspress",function(i){this.zoomOut()});e.addEventListener("pluspress",function(i){this.zoomIn()})}});function ky(kE,kD){var T={};T.id=kE.pointerId||0;T.clientPos={x:kE.clientX||kE.pageX||0,y:kE.clientY||kE.pageY||0};var kG=0;var kC=0;var i=kD.container;while(i&&i.parentNode){kG+=i.scrollLeft;kC+=i.scrollTop;if(i.tagName!=="BODY"&&"absolute|fixed".indexOf(cq(i).position)>=0){i=i.offsetParent}else{i=i.parentNode}}T.clientPos.x=kE.clientX+kG;T.clientPos.y=kE.clientY+kC;T.offsetPos={x:kE.layerX||kE.offsetX||0,y:kE.layerY||kE.offsetY||0};T.target=kE.target;T.button=kE.button||0;T.ctrlKey=kE.ctrlKey||false;T.metaKey=kE.metaKey||false;var kF=ak(T,kD);e9.extend(T,kF);T.offsetPosMap=new fv(kF.x,kF.y);T.timeStamp=kE.timeStamp;T.domEvent=kE;if(kE.type&&kE.type.indexOf("wheel")>-1){T.wheelDelta=kE.wheelDelta;T.detail=kE.detail;T.deltaX=kE.deltaX;T.deltaY=kE.deltaY;T.deltaMode=kE.deltaMode}T.offsetX=T.offsetPosMap.x;T.offsetY=T.offsetPosMap.y;T.layerX=kE.layerX;T.layerY=kE.layerY;return T}function ht(kD){var kI=0;var kE=0;var kJ=cq(kD);var kF=kJ.getPropertyValue("transform");if(kF&&kF!=="none"){var kK=kF.match(/matrix\\(.+\\)/);var T=/(-)?\\d+(\\.\\d+)?/g;if(kK&&kK.length){var kH=kK[0].split(",");if(kH.length===6){var kG=kH[4].match(T);var e=kH[5].match(T);kI=(kG&&kG.length)?kG[0]:0;kE=(e&&e.length)?e[0]:0}}else{kK=kF.match(/translate\\(\\S+(\\s\\S+)?\\)/);if(kK&&kK.length){var kH=kK[0].split(",");for(var kC=0;kC<kH.length;kC++){var i=item.match(T);if(i){kC===0&&(kI+=i[0]);kC===1&&(kE+=i[0])}}}}}return{offsetX:kI||0,offsetY:kE||0}}function ak(kC,T){var kE=kC.target;var kN=kC.clientPos.x;var kM=kC.clientPos.y;var kH=null;var kG=null;if(kE.nodeType!==1){kE=kE.parentNode}var kF=T.getContainer();var kD=kF;while(kD){kN-=kD.offsetLeft+kD.clientLeft||0;kM-=kD.offsetTop+kD.clientTop||0;var kP=ht(kD);kN-=kP.offsetX;kM-=kP.offsetY;if(kD.tagName==="BODY"){var kK=cq(kD);if("relative|absolute|fixed".indexOf(kK.position)>=0){kN-=(parseFloat(kK.left)||0)+parseFloat(kK.marginLeft);kM-=(parseFloat(kK.top)||0)+parseFloat(kK.marginTop)}kN+=kD.clientLeft||0;kM+=kD.clientTop||0;var kJ=cq(kD.parentNode);if("absolute|fixed".indexOf(kK.position)>=0&&"relative|absolute|fixed".indexOf(kJ.position)===-1){kD=null}else{kD=kD.parentNode}}else{if(kD.tagName==="HTML"){var kL=cq(kD);if("relative".indexOf(kL.position)>=0){kN-=(parseFloat(kL.left)||0);kM-=(parseFloat(kL.top)||0)}kD=kD.offsetParent}else{kD=kD.offsetParent}}}var i=T.getPanes();var e=null;while(kE&&kE!==kF){if(kE.hashCode){if(e9.instance(kE.hashCode) instanceof eM){kH=e9.instance(kE.hashCode)}if(e9.instance(kE.hashCode) instanceof ef||e9.instance(kE.hashCode) instanceof io){kG=e9.instance(kE.hashCode)}}var kO=kE.parentNode;if(kO===i.floatPane||kO===i.markerMouseTarget||kO===i.floatShadow||kO===i.labelPane||kO===i.markerPane||kO===i.mapPane){e=kE}kE=kO}var kI=null;if(e&&!kH&&!kG){kI=e}return{x:kN,y:kM,overlay:kH,infoWindow:kG,customOverlayDom:kI,pixel:new fv(kN,kM),point:T.pixelToPointIn(new fv(kN,kM)),latlng:js(T.pixelToPoint(new fv(kN,kM)),BMapGL.coordType)}}function hy(kD,kC){var kE=kD.changedTouches[0];var i=kD.changedTouches.length;var T={target:kD.target,timeStamp:kD.timeStamp,ctrlKey:kD.ctrlKey||false,webkitForce:kD.webkitForce,metaKey:kD.metaKey||false,touchesCount:kD.touches.length,targetTouchesCount:kD.targetTouches.length};if(kD.changedTouches){T.changedTouchesCount=kD.changedTouches.length}else{T.changedTouchesCount=1}jk(kE,T,kC);if(i>1){T.secondTouchInfo={};e9.extend(T.secondTouchInfo,T);jk(kD.changedTouches[1],T.secondTouchInfo,kC)}return T}function jk(kG,kH,e){if(!kG){return}var kJ=kG.clientX;var kI=kG.clientY;kH.id=kG.identifier||0;kH.clientPos={x:kJ,y:kI};var kD=0;var kC=0;var T=e.container;while(T.offsetParent){kD+=T.offsetLeft;kC+=T.offsetTop;T=T.offsetParent}kH.offsetPos={x:kJ-kD,y:kI-kC};kH.button=0;var kE=0;var i=0;var T=e.container;while(T&&T.parentNode){kE+=T.scrollLeft;i+=T.scrollTop;if(T.tagName!=="BODY"&&"absolute|fixed".indexOf(cq(T).position)>=0){T=T.offsetParent}else{T=T.parentNode}}kH.clientPos.x+=kE;kH.clientPos.y+=i;var kF=ak(kH,e);kH.offsetPosMap=kF.pixel;e9.extend(kH,kF)}function bN(kG,i){var kJ=kG.clientX;var kI=kG.clientY;if(typeof window.scrollY==="number"){kI+=window.scrollY}var kH={};kH.id=0;kH.clientPos={x:kJ,y:kI};kH.target=kG.target;var kE=0;var kD=0;var kC=i.container;while(kC.offsetParent){kE+=kC.offsetLeft;kD+=kC.offsetTop;kC=kC.offsetParent}kH.offsetPos={x:kJ-kE,y:kI-kD};var kF=0;var T=0;var kC=i.container;while(kC&&kC.parentNode){kF+=kC.scrollLeft;T+=kC.scrollTop;if(kC.tagName!=="BODY"&&"absolute|fixed".indexOf(cq(kC).position)>=0){kC=kC.offsetParent}else{kC=kC.parentNode}}kH.offsetPos.x+=kF;kH.offsetPos.y+=T;kH.timeStamp=kG.timeStamp;kH.offsetPosMap=new fv(kH.offsetPos.x,kH.offsetPos.y);kH.scale=kG.scale;kH.rotation=kG.rotation;return kH}function gG(e){this._map=e;if(e._renderType==="webgl"){this._drag=new hr(e)}else{if(typeof jb==="undefined"){return}this._drag=new jb(e)}this._earthDrag=null;this._earthWheel=null;this._dragStarted=false;this._touchStarted=false;this._waitForSecondTouch=false;this._firstTouchInfo={};this._secondTouchInfo={};this._currentTouchCount=0;this._prevGestureScale=1;this._useGesture=!!((b5()&&window.GestureEvent)||(!window.TouchEvent&&window.GestureEvent));this._opButton=-1;this._rotationFix=0;this._pinchRotationThreshold=20;this._pinchZoomThreshold=0.2;this._gestureStatus={zoom:false,rotate:false,tilt:false,dragZoom:false};this._diffX=0;this._diffY=0;this._enableRightDrag=true;if(typeof navigator.userAgent==="string"&&navigator.userAgent.indexOf("QQBrowser")>0){this._enableRightDrag=false}this._lastWheelTime=new Date();this._isModernBrowser=e.config.isModernBrowser;if(e.getRenderType()==="webgl"){e.deepZoom=new cc(e)}else{if(this._isModernBrowser){e.deepZoom=new aH(e)}}this._stateMachine=new g2();this._init();this._bind();if(this._useGesture){this._bindGesture()}this._bindRightButton();this._bindMouseWheel();this._operationVelocity=0;this._lastDiffDistance=0;this._zoomVelocity=0;this._lastDiffZoom=0;this._rotationVelocity=0;this._initRotation=0;this._trackVelocityTimer=null;this._trackTimeStamp=0;this._lastDragPoint={x:0,y:0};this._penultimateDragPoint={x:0,y:0};this._touchInMap=false}gG.prototype._init=function(){this._supportPointerEvent=(window.PointerEvent||window.MSPointerEvent)&&(navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0);var e={mousedown:"mousedown",mousemove:"mousemove",mouseup:"mouseup",mouseleave:"mouseleave",};if(this._supportPointerEvent){if(window.PointerEvent){e.mousedown="pointerdown";e.mousemove="pointermove";e.mouseup="pointerup"}else{if(window.MSPointerEvent){e.mousedown="MSPointerDown";e.mousemove="MSPointerMove";e.mouseup="MSPointerUp"}}}this._eventMapping=e;var i=this;this._map.on("destroy",function(){i._stateMachine=null;i._keydown&&e9.un(document,"keydown",i._keydown);i._keydown=null;i._mousemove&&e9.un(document,e.mousemove,i._mousemove);i._mousemove=null;i._touchmove&&e9.un(document,"touchmove",i._touchmove);i._touchmove=null;i._mouseup&&e9.un(document,e.mouseup,i._mouseup);i._mouseup=null;i._mouseleave&&e9.un(document,"mouseleave",i._mouseleave);i._mouseleave=null;i._touchend&&e9.un(document,"touchend",i._touchend);i._touchend=null;i._mousedown&&e9.un(document,"mousedown",i._mousedown);i._mousedown=null;i._gesturechange&&e9.un(document,"gesturechange",i._gesturechange);i._gesturechange=null;i._gestureend&&e9.un(document,"gestureend",i._gestureend);i._gestureend=null})};gG.prototype._bind=function(){var kD=this._map;var T=kD.temp;var i=this._eventMapping;var kC=this;var e=kD.platform;e9.on(e,i.mousedown,function(kF){if(b5()){return}kC._mousedown=true;var kE=ky(kF,kD);kC._mouseButton=kF.button;kD.dispatchEvent(e9.extend(new fW("onmousedown"),kE));kC._processMouseDown(kE)});e9.on(e,"touchstart",function(kF){if(kC._mousedown===true){return}kC._touchStarted=true;var kE=hy(kF,kD);kC._processMouseDown(kE);kC._touchInMap=true;if(!kE.customOverlayDom){kF.preventDefault()}});e9.on(e,"keydown",this._keydown=function(kE){if(!kC._touchStarted&&kD.currentOperation===ep.dragging){if(kE.metaKey||kE.ctrlKey||kE.altKey){kC._mousedown=false;kC._processMouseUp(ky(kE,kD))}}});e9.on(e,i.mousemove,this._mousemove=function(kF){if(kC._touchStarted){return}var kE=ky(kF,kD);kE.button=kC._mouseButton;if(kD.currentOperation===ep.idle){kD.dispatchEvent(e9.extend(new fW("onmousemove"),kE))}kC._processMouseMove(kE)});e9.on(e,"touchmove",this._touchmove=function(kE){if(!kC._touchInMap){return}kC._processMouseMove(hy(kE,kD));kE.preventDefault});e9.on(document,i.mouseup,this._mouseup=function(kF){if(kC._touchStarted){return}var kE=ky(kF,kD);kD.dispatchEvent(e9.extend(new fW("onmouseup"),kE));kC._mousedown=false;kC._processMouseUp(ky(kF,kD))});if("mouseleave" in Element.prototype){e9.on(e,i.mouseleave,this._mouseleave=function(kF){if(kC._touchStarted){return}if(kD.currentOperation===ep.idle){var kE=ky(kF,kD);kD.dispatchEvent(e9.extend(new fW("onmouseout"),kE))}kC._mousedown=false;kC._processMouseUp(ky(kF,kD))})}else{e9.on(e,"mouseout",this._mouseleave=function(kF){if(!this.contains(kF.relatedTarget)){if(kC._touchStarted){return}if(kD.currentOperation===ep.idle){var kE=ky(kF,kD);kD.dispatchEvent(e9.extend(new fW("onmouseout"),kE))}kC._mousedown=false;kC._processMouseUp(ky(kF,kD))}})}e9.on(e,"touchend",this._touchend=function(kI){if(!kC._touchInMap){return}if(!kC._firstTouchInfo||!kC._firstTouchInfo.offsetPos){kC._processMouseUp(ky(kI,kD));return}if(kI.targetTouches.length===0){var kG=Math.abs(kC._diffX)>5||Math.abs(kC._diffY)>5;kC._touchStarted=false;if(!kC._twoFingerTouched&&!kG){var kE=new fW("onclick");e9.extend(kE,kC._firstTouchInfo);kE.icon=kD.getIconByClickPosition(kC._firstTouchInfo.offsetPos);if(!kE.customOverlayDom||kE.customOverlayDom.getAttribute("data-tag-touch")!=="stop"){kD.dispatchEvent(kE)}if(kC._waitForSecondTouch===false){kC._waitForSecondTouch=true;kC._firstTouchPos={x:kC._firstTouchInfo.offsetPos.x,y:kC._firstTouchInfo.offsetPos.y};kC._doubleTouchTimer=setTimeout(function kF(){kC._waitForSecondTouch=false;kC._doubleTouchTimer=null},kD.config.clickInterval)}else{if(Math.abs(kC._firstTouchInfo.offsetPos.x-kC._firstTouchPos.x)<20&&Math.abs(kC._firstTouchInfo.offsetPos.y-kC._firstTouchPos.y)<20){var kH=new fW("ondblclick");e9.extend(kH,kC._firstTouchInfo);kD.dispatchEvent(kH)}kC._waitForSecondTouch=false;clearTimeout(kC._doubleTouchTimer);kC._doubleTouchTimer=null}}kC._twoFingerTouched=false;kC._touchInMap=false}kC._processMouseUp(hy(kI,kD))});e9.on(e,"click",function(kH){if(window.TouchEvent&&b5()){return}if(kD.getLock()===true){return}if(kD.currentOperation===ep.idle){var kG=kC._diffX===0&&kC._diffY===0;var kF=ky(kH,kD);if(kG){var kE=new fW("onclick");e9.extend(kE,kF);kE.icon=kD.getIconByClickPosition(kE.offsetPosMap);kD.dispatchEvent(kE)}if(!T._clickTimer){T._clickTimer=setTimeout(function(){T._clickTimer=null;if(kG){var kI=new fW("onclickex");e9.extend(kI,kF);kD.dispatchEvent(kI)}},kD.config.clickInterval)}}kC._diffX=0;kC._diffY=0});kD.container.onselectstart=function(){return false};e9.on(kD.container,"contextmenu",function(kE){kE.cancelBubble=true;d(kE);if(kE.button===2&&kD._rightClickDeep){kC._processRightClick(ky(kE,kD));kD._rightClickDeep=false}});e9.on(e,"dblclick",function(kE){if(kD.getLock()===true){return}if(kD.currentOperation===ep.idle){if(e9.Browser.ie){kD.dispatchEvent(e9.extend(new fW("onclick"),ky(kE,kD)))}if(T._clickTimer){clearTimeout(T._clickTimer);T._clickTimer=null}kD.dispatchEvent(e9.extend(new fW("ondblclick"),ky(kE,kD)))}});e9.on(e,"mousedown",this._mousedown=function(kF){kF=window.event||kF;var kE=kF.srcElement||kF.target;if(T.canKeyboard){T.canKeyboard=kD.container.contains(kE)}else{if(!e){return}T.canKeyboard=e.contains(kE)}});e9.on(e,"webkitmouseforcedown",function(kE){kD.dispatchEvent(e9.extend(new fW("onforcedown"),ky(kE,kD)))});e9.on(e,"webkitmouseforceup",function(kE){kD.dispatchEvent(e9.extend(new fW("onforceup"),ky(kE,kD)))})};gG.prototype._bindGesture=function(){var e=this;var i=this._map;e9.on(i.platform,"gesturestart",function(kC){i.currentOperation=e._stateMachine.takeAction("gesturestart");var T=bN(kC,i);e._gestureStartTime=T.timeStamp;if(T.rotation<-160){e._rotationFix=180}else{if(T.rotation>160){e._rotationFix=-180}else{e._rotationFix=0}}e._pinchStartPosition=T.offsetPosMap;e._getCurrentDrag().onReadyToPinch(kC,{initMiddlePoint:T.offsetPosMap,pinchStartPosition:e._pinchStartPosition,zoomRatio:1});kC.preventDefault()});e9.on(i.platform,"gesturechange",this._gesturechange=function(kE){if(i.currentOperation!==ep.readyToPinch&&i.currentOperation!==ep.pinching){return}i.currentOperation=e._stateMachine.takeAction("gesturechange");if(i.currentOperation!==ep.pinching){return}var kD=bN(kE,i);if(isNaN(kD.scale)){kD.scale=e._prevGestureScale}else{e._prevGestureScale=kD.scale}kD.rotation+=e._rotationFix;var T=kD.offsetPosMap;e._pinchingPosition=T;e._diffX=T.x-e._pinchStartPosition.x;e._diffY=T.y-e._pinchStartPosition.y;var kC=e._getPinchParam(kD);if(!kC){kE.preventDefault();return}e._getCurrentDrag().onPinching(kE,{pinchStartPosition:e._pinchStartPosition,pinchingPosition:T,pinchingDistance:kC.pinchingDistance,zoomRatio:kC.zoomRatio,angleDiff:kC.rotation,gestureStatus:e._gestureStatus});kE.preventDefault()});e9.on(i.platform,"gestureend",this._gestureend=function(kD){if(i.currentOperation!==ep.readyToPinch&&i.currentOperation!==ep.pinching){return}var kC=bN(kD,i);if(isNaN(kC.scale)){kC.scale=e._prevGestureScale}else{e._prevGestureScale=kC.scale}var T=e._pinchParam||{};e._getCurrentDrag().onPinchEnd(kD,{pinchStartPosition:e._pinchStartPosition,pinchEndPosition:e._pinchingPosition,zoomRatio:T.zoomRatio,angleDiff:T.rotation,gestureStatus:e._gestureStatus});e._resetGestureParam();i.currentOperation=e._stateMachine.takeAction("gestureend");kD.preventDefault()})};gG.prototype._getPinchParam=function(kC){var kH=kC.scale;var kJ=kC.rotation;var kD=kC.offsetPosMap;var kG=kD.x-this._pinchStartPosition.x;var kE=kD.y-this._pinchStartPosition.y;var T={x:kG,y:kE};var kI=kC.timeStamp-this._gestureStartTime;if(kI<100){return null}var i=this._gestureStatus;if(!this._gestureDetected){this._gestureDetected=true;if(Math.abs(kG)<10&&Math.abs(kE)>10&&Math.abs(kH-1)<0.1&&kJ<10){i.tilt=true}}var kF=0;if(!i.tilt&&!i.rotate){if(Math.abs(kJ)>this._pinchRotationThreshold){this._initRotation=kJ;if(kJ>0){kF=kJ-this._pinchRotationThreshold}else{kF=kJ+this._pinchRotationThreshold}i.rotate=true}else{kJ=0}}if(i.rotate&&this._initRotation){kF+=kJ-this._initRotation}var e=kH;if(i.tilt){e=1}this._pinchParam={zoomRatio:e,rotation:kF,pinchingDistance:T};return this._pinchParam};gG.prototype._resetGestureParam=function(){this._initRotation=0;this._gestureStatus.zoom=false;this._gestureStatus.rotate=false;this._gestureStatus.tilt=false;this._gestureStatus.dragZoom=false;this._gestureDetected=false;this._pinchParam=null;this._gestureStartTime=null};gG.prototype._bindRightButton=function(){var i=this._map;var e=this;e9.on(i.container,this._eventMapping.mouseup,function(T){if(i.mapType===BMAP_EARTH_MAP){return}if(i.getLock()===true){return}if(i.currentOperation!==ep.readyToDrag){if(i.currentOperation===ep.dragging&&e._diffX===0&&e._diffY===0){}else{return}}if(T.button===2){e._processRightClick(ky(T,i))}})};gG.prototype._processMouseDown=function(kH){var i=this._map;if(kH.overlay&&kH.overlay instanceof ke&&kH.overlay._config.enableDraggingMap===false&&!b5()){if(i.currentOperation===ep.idle){this._clearStatus();this._firstTouchInfo=kH;this._firstTouchInfo.initX=kH.offsetPosMap.x;this._firstTouchInfo.initY=kH.offsetPosMap.y;return}}if(i.currentOperation!==ep.idle&&kH.button!==this._opButton){return}if(kH.button===2&&this._currentTouchCount===1){return}if(i.getLock()){return}if(this._currentTouchCount===2){return}this._currentTouchCount++;if(this._currentTouchCount===2){this._twoFingerTouched=true}if(this._lastTouchstartTime&&b5()){var kD=kH.timeStamp-this._lastTouchstartTime;if(kD<200){this._gestureStatus.dragZoom=true}}this._lastTouchstartTime=kH.timeStamp;i.currentOperation=this._stateMachine.takeAction("mousedown",kH.id);if(kH.secondTouchInfo){this._currentTouchCount++;i.currentOperation=this._stateMachine.takeAction("mousedown",kH.secondTouchInfo.id)}if(i.currentOperation===ep.readyToDrag){if((e9.Browser.ie&&kH.target.setCapture)||(e9.Browser.firefox&&kH.target.setCapture)){kH.target.setCapture()}var kE=this._firstTouchInfo;e9.extend(kE,kH);kE.initX=kH.offsetPosMap.x;kE.initY=kH.offsetPosMap.y;this._opButton=kH.button;if(kH.button===2&&this._enableRightDrag===false){i.currentOperation=ep.idle;this._stateMachine.reset();return}this._getCurrentDrag().onReadyToDrag(kH)}else{if(i.currentOperation===ep.readyToPinch){if(kH.secondTouchInfo){e9.extend(this._firstTouchInfo,kH);this._firstTouchInfo.initX=kH.offsetPosMap.x;this._firstTouchInfo.initY=kH.offsetPosMap.y;e9.extend(this._secondTouchInfo,kH.secondTouchInfo);this._secondTouchInfo.initX=kH.secondTouchInfo.offsetPosMap.x;this._secondTouchInfo.initY=kH.secondTouchInfo.offsetPosMap.y;this._opButton=kH.button}else{e9.extend(this._secondTouchInfo,kH);this._secondTouchInfo.initX=kH.offsetPosMap.x;this._secondTouchInfo.initY=kH.offsetPosMap.y}if(this._useGesture){return}this._initTouchDistance=cr(this._firstTouchInfo.offsetPosMap,this._secondTouchInfo.offsetPosMap);this._initMiddlePoint=fm(this._firstTouchInfo.offsetPosMap,this._secondTouchInfo.offsetPosMap);var kC=this._firstTouchInfo.initX-this._initMiddlePoint.x;var kJ=this._initMiddlePoint.y-this._firstTouchInfo.initY;var T=this._secondTouchInfo.initX-this._initMiddlePoint.x;var kI=this._initMiddlePoint.y-this._secondTouchInfo.initY;var kF;if(kC-T!==0){var kG=(kI-kJ)/(T-kC);kF=fl(Math.atan(kG))}else{kF=90}if(kF<0){kF=180+kF}this._initAngle=kF;this._preAngle=kF;this._pinchStartPosition=this._initMiddlePoint;this._getCurrentDrag().onReadyToPinch(kH,{initMiddlePoint:this._initMiddlePoint,pinchStartPosition:this._pinchStartPosition,zoomRatio:1})}}};gG.prototype._processMouseMove=function(kE){var i=this._map;if(i.currentOperation===ep.idle){return}if(kE.id===this._firstTouchInfo.id){e9.extend(this._firstTouchInfo,kE)}else{if(kE.id===this._secondTouchInfo.id){e9.extend(this._secondTouchInfo,kE)}}if(kE.secondTouchInfo){if(kE.secondTouchInfo.id===this._firstTouchInfo.id){e9.extend(this._firstTouchInfo,kE.secondTouchInfo)}else{if(kE.secondTouchInfo.id===this._secondTouchInfo.id){e9.extend(this._secondTouchInfo,kE.secondTouchInfo)}}}i.currentOperation=this._stateMachine.takeAction("mousemove",kE.id);if(i.currentOperation===ep.pinching){if(this._useGesture){return}if(!this._gestureStartTime){this._gestureStartTime=kE.timeStamp}var kI=cr(this._firstTouchInfo.offsetPosMap,this._secondTouchInfo.offsetPosMap);var kH=fm(this._firstTouchInfo.offsetPosMap,this._secondTouchInfo.offsetPosMap);this._pinchingPosition=kH;this._diffX=kH.x-this._initMiddlePoint.x;this._diffY=kH.y-this._initMiddlePoint.y;var kF={scale:Math.round(kI/this._initTouchDistance*100)/100,rotation:this._calcRotationDiff(kH),offsetPosMap:kH,timeStamp:kE.timeStamp};this._pinchingPosition=kH;var T=this._getPinchParam(kF);if(T){this._zoomRatio=T.zoomRatio;this._getCurrentDrag().onPinching(kE,{initMiddlePoint:this._initMiddlePoint,pinchStartPosition:this._pinchStartPosition,pinchingPosition:kH,pinchingDistance:T.pinchingDistance,zoomRatio:T.zoomRatio,angleDiff:T.rotation,gestureStatus:this._gestureStatus})}}else{if(i.currentOperation===ep.dragging){var kD=this._getCurrentDrag();if(this._dragStarted===false){kD.onDragStart&&kD.onDragStart(kE);this._dragStarted=true}if(kE.id===this._firstTouchInfo.id){this._diffX=kE.offsetPosMap.x-this._firstTouchInfo.initX;this._diffY=kE.offsetPosMap.y-this._firstTouchInfo.initY}else{if(kE.secondTouchInfo&&kE.secondTouchInfo.id===this._firstTouchInfo.id){this._diffX=kE.secondTouchInfo.offsetPosMap.x-this._firstTouchInfo.initX;this._diffY=kE.secondTouchInfo.offsetPosMap.y-this._firstTouchInfo.initY}}this._lastDragPoint=kE.pixel;var kC;if(this._lastDragPoint.x===this._penultimateDragPoint.x&&this._lastDragPoint.y===this._penultimateDragPoint.y){kC={x:this._diffX,y:this._diffY}}else{kC={x:this._lastDragPoint.x-this._penultimateDragPoint.x,y:this._lastDragPoint.y-this._penultimateDragPoint.y}}if(!i.config.enableDragging){return}kD.onDragging(kE,{diffX:this._diffX,diffY:this._diffY,velocity:this._operationVelocity,button:this._opButton,dragDistance:{x:this._diffX,y:this._diffY},gestureStatus:this._gestureStatus,dir:kC});if(!this._trackVelocityTimer){var kG=this;this._trackTimeStamp=(new Date()).getTime();this._trackVelocityTimer=setInterval(function(){kG._trackVelocity();kG._penultimateDragPoint=kG._lastDragPoint},30)}}}};gG.prototype._calcRotationDiff=function(kH){var i=this._firstTouchInfo.offsetPosMap.x-kH.x;var kG=kH.y-this._firstTouchInfo.offsetPosMap.y;var e=this._secondTouchInfo.offsetPosMap.x-kH.x;var kF=kH.y-this._secondTouchInfo.offsetPosMap.y;var kC;if(i-e!==0){var kD=(kF-kG)/(e-i);kC=fl(Math.atan(kD))}else{kC=90}if(kC<0){kC=180+kC}var T=kC;while(this._preAngle-kC>100){kC=kC+180}while(this._preAngle-kC<-100){kC=kC-180}var kE=this._initAngle-kC;this._preAngle=kC;return kE};gG.prototype._processMouseUp=function(kD){var kC=this._map;if(kC.currentOperation===ep.idle){return}if(kD.button!==this._opButton){return}this._currentTouchCount--;if(kC.currentOperation===ep.readyToDrag||kC.currentOperation===ep.dragging){if(this._trackVelocityTimer){clearInterval(this._trackVelocityTimer);this._trackVelocityTimer=null}this._dragStarted=false;var i;if(this._lastDragPoint.x===this._penultimateDragPoint.x&&this._lastDragPoint.y===this._penultimateDragPoint.y){i={x:this._diffX,y:this._diffY}}else{i={x:this._lastDragPoint.x-this._penultimateDragPoint.x,y:this._lastDragPoint.y-this._penultimateDragPoint.y}}this._getCurrentDrag().onDragEnd(kD,{velocity:this._operationVelocity,dragDistance:{x:this._diffX,y:this._diffY},gestureStatus:this._gestureStatus,dir:i});this._clearStatus(kD);this._resetGestureParam();if((e9.Browser.ie&&kD.target.releaseCapture)||(e9.Browser.firefox&&kD.target.releaseCapture)){kD.target.releaseCapture()}this._opButton=-1}else{if(kC.currentOperation===ep.pinching){if(!this._useGesture){var T=this._pinchParam;if(T){this._getCurrentDrag().onPinchEnd(kD,{pinchStartPosition:this._pinchStartPosition,pinchEndPosition:this._pinchingPosition,zoomRatio:T.zoomRatio,angleDiff:T.rotation,gestureStatus:this._gestureStatus})}this._resetGestureParam()}this._clearId(kD.id)}else{if(kC.currentOperation===ep.freeze){if(this._currentTouchCount===0){this._clearStatus(kD)}else{if(kD.id===this._firstTouchInfo.id||kD.id===this._secondTouchInfo.id){if(!this._useGesture){var T=this._pinchParam;if(T){this._getCurrentDrag().onPinchEnd(kD,{pinchStartPosition:this._pinchStartPosition,pinchEndPosition:this._pinchingPosition,zoomRatio:T.zoomRatio,angleDiff:T.rotation,gestureStatus:this._gestureStatus})}this._resetGestureParam()}this._clearId(kD.id)}}}}}kC.currentOperation=this._stateMachine.takeAction("mouseup",kD.id);if(kD.changedTouchesCount===2||kD.targetTouchesCount===0){kD.changedTouchesCount=1;this._processMouseUp(kD)}if(this._currentTouchCount===0&&b5()){this._diffX=this._diffY=0}};gG.prototype._clearId=function(e){if(e===this._firstTouchInfo.id){this._firstTouchInfo={}}else{if(e===this._secondTouchInfo.id){this._secondTouchInfo={}}}};gG.prototype._clearStatus=function(){this._firstTouchInfo={};this._secondTouchInfo={}};gG.prototype._processRightClick=function(kD){var kC=this._map;var T=kC.temp;if(T.rightDblclickTimer){clearTimeout(T.rightDblclickTimer);T.rightDblclickTimer=null;kC.dispatchEvent(e9.extend(new fW("onrightclick"),kD));kC.dispatchEvent(e9.extend(new fW("onrightdblclick"),kD))}else{kC.dispatchEvent(e9.extend(new fW("onrightclick"),kD));var i=e9.extend(new fW("onrightclickex"),kD);T.rightDblclickTimer=setTimeout(function(){T.rightDblclickTimer=null;kC.dispatchEvent(i)},kC.config.clickInterval)}};gG.prototype._bindMouseWheel=function(){var kC=this._map;var T=this;if(!e9.Browser.firefox){e9.on(kC.container,"mousewheel",function i(kD){if(kC.getLock()===true){return}if(!kC.config.enableWheelZoom){return}if(kC.mapType!==BMAP_EARTH_MAP){if(T._isModernBrowser){T._deepZoomWheel(kD)}else{T._wheel(kD)}}else{if(T._earthWheel){T._earthWheel.onWheel(ky(kD,kC))}}d(kD)})}else{e9.on(kC.container,"wheel",function e(kD){if(kC.getLock()===true){return}if(!kC.config.enableWheelZoom){return}if(kC.mapType!==BMAP_EARTH_MAP){if(T._isModernBrowser){T._deepZoomWheel(kD)}else{T._wheel(kD)}}else{if(T._earthWheel){T._earthWheel.onWheel(ky(kD,kC))}}d(kD)})}};gG.prototype._getCurrentDrag=function(){var e=this._map;if(e.getMapType()!==BMAP_EARTH_MAP){return this._drag}return this._earthDrag};gG.prototype._wheel=function(kF){var kE=this._map;var kC=this._map.temp;if(kC.dragAni){kC.dragAni.stop();kC.dragAni=null;setTimeout(function(){kE.dispatchEvent(new fW("onmoveend"))},1)}if(kC.touchZoomLabelCanvas){kC.touchZoomLabelCanvas.style.display="none"}if(kC.touchZoomDiv){kC.touchZoomDiv.style.display="none"}kF=window.event||kF;kE.lastLevel=kE.zoomLevel;var T=new fW("onmousewheel");T.trend=kF.wheelDelta>=0;if(isNaN(kF.wheelDelta)){T.trend=kF.deltaY<=0}var i=new Date();if(T.trend===true&&kE.zoomLevel===kE.getMaxZoom()||T.trend===false&&kE.zoomLevel===kE.getMinZoom()||i-this._lastWheelTime<220){kE.currentOperation^=ep.mousewheel;if(T.trend===true&&kE.zoomLevel===kE.getMaxZoom()||T.trend===false&&kE.zoomLevel===kE.getMinZoom()){var kD=new fW("onzoomexceeded");if(kE.zoomLevel===kE.getMaxZoom()){kD.targetZoom=kE.zoomLevel+1}else{kD.targetZoom=kE.zoomLevel-1}kE.dispatchEvent(kD)}d(kF);return}this._astWheelTime=i;e9.extend(T,ky(kF,kE));kE.dispatchEvent(T)};gG.prototype._deepZoomWheel=function(kC){var T=this._map;var i=new fW("ondeepzoommousewheel");e9.extend(i,ky(kC,T));T.dispatchEvent(i)};gG.prototype.setEarthDrag=function(e){this._earthDrag=e};gG.prototype.setEarthWheel=function(e){this._earthWheel=e};gG.prototype._trackVelocity=function(){var T=(new Date()).getTime();var e=T-this._trackTimeStamp;if(e===0){return}this._trackTimeStamp=T;var kC=Math.sqrt(Math.pow(this._diffX,2)+Math.pow(this._diffY,2));var kD=Math.abs(kC-this._lastDiffDistance);this._lastDiffDistance=kC;var i=500*kD/e;this._operationVelocity=(0.6*i+0.4*this._operationVelocity)};function aH(e){this.map=e;this.tileMgr=e.tileMgr;this.canvas2dMapMgr=e.canvas2dMapMgr;this.enableCanvas2dMap=!!(e.getRenderType()==="canvas");this.zoomCount=0;this.preZoomCount=null;this.preRenderTick=1;this.maxZoomWheelDir=1;this.minZoomWheelDir=-1;this.isDispatchZoomStart=false;this.maxZoom=e.getMaxZoom();this.minZoom=e.getMinZoom();this.lastWheelTime=0;this.opMethod="";this.inDecayMode=false;this.lastWheelDelta=0;this.lastDiff=0;this._animationLayer=eB.get(e);this.bindEvent()}var bO=aH.prototype;bO.bindEvent=function(){var e=this;var i=e.map;i.addEventListener("maptypechange",function(T){e.maxZoom=i.getMaxZoom();e.minZoom=i.getMinZoom()});i.addEventListener("deepzoommousewheel",function(T){e.wheel(T)})};bO.wheel=function(kR){var kV=this,kU=kV.map,kJ=kU.temp;if(kJ.dragAni){kV.enableCanvas2dMap&&kV.canvas2dMapMgr.updateLabel();kJ.dragAni.stop();kJ.dragAni=null;kU.dispatchEvent(new fW("onmoveend"))}var kD=Math.floor(kR.timeStamp);var kS=kD-this.lastWheelTime;var kN=kR.wheelDelta>=0;if(isNaN(kR.wheelDelta)){kN=kR.deltaY<=0}var kT=Math.abs(kR.deltaY);var kE=Math.abs(kR.wheelDelta);var kO=kT;if(kS>100){this.inDecayMode=false;this.opMethod=h9(kE,kO,kR.deltaMode);this.zoomCount=0;this.preZoomCount=null;kU.fire(new fW("onmousewheelscroll"))}if(this.opMethod==="padScroll"){if(kO===0&&kS===0){if(this.inDecayMode===false){this.inDecayMode=true}}}if(kS===0){return}this.lastWheelTime=kD;if(this.opMethod==="padScroll"&&kS<40){if(kN){kV.zoomCount+=0.13}else{kV.zoomCount-=0.16}var kK=kR.wheelDelta-this.lastWheelDelta;var i=kK-this.lastDiff;var kC=this.lastDiff;this.lastDiff=kK;this.lastWheelDeltaAbs=kE;this.lastWheelDelta=kR.wheelDelta;this.lastTrend=kN;if(typeof this.lastTrend==="boolean"&&kN!==this.lastTrend||this.opMethod==="padScroll"&&kE===3&&!isNaN(i)&&Math.abs(kK-kC)>50){kV._animationLayer.stopAnimation();if(kV.zoomAni){kV.zoomAni.stop();kV.zoomAni=null}}else{if(this.preZoomCount!==0){if((kK<0&&kC>0)||(kK>0&&kC<0)){if(kO<5){this.inDecayMode=false}}else{return}}}}this.preZoomCount=this.zoomCount;var kQ=kR.wheelDelta/120||-kR.detail/3;if(kQ===0&&e9.Browser.firefox){kQ=-kR.deltaY}if(kQ===0){return}var kP=kQ>=0?1:-1;var kH=Math.ceil(Math.abs(kQ))*kP;if(this.opMethod==="padPinch"){kH=kR.deltaY}var kG=kH>0?1:-1;var T=kU.getZoom();if(kG<0){kV.maxZoomWheelDir=-1}if(kG>0){kV.minZoomWheelDir=1}var kM=kV.maxZoom;var kI=kV.minZoom;if((T>=kM&&kG>0&&kV.maxZoomWheelDir===1)||(T<=kI&&kG<0&&kV.minZoomWheelDir===-1)){var kL=new fW("onzoomexceeded");if(T>=kM){kL.targetZoom=T+1}else{kL.targetZoom=T-1}kU.dispatchEvent(kL);return}if(this.opMethod==="mouseWheel"&&this.zoomAni){return}if(this.opMethod!=="mouseWheel"){kH*=0.6}kV.zoomCount+=kH;if(this.opMethod==="mouseWheel"){kV.zoomCount=kV.limitZoomCount(kV.zoomCount)}var kF=new fv(kR.pixel.x,kR.pixel.y);if(this.opMethod!=="mouseWheel"){if(kV.zoomAni||kV.timer||kV.zoomCount===0||kV.inDecayMode===true){return}kV.timer=setTimeout(function(){var e=Math.abs(kV.zoomCount);e=Math.round(e);if(kN){kV.zoomCount=e}else{kV.zoomCount=-e}kV.zoomCount=kV.limitZoomCount(kV.zoomCount);if(kV.zoomCount===0){kV.timer=null;return}kV.zoomMap(kF,kV.zoomCount,kG);kV.timer=null},30);return}this._animationLayer.stopAnimation();kV.timer&&clearTimeout(kV.timer);kV.timer=setTimeout(function(){kV.zoomMap(kF,kV.zoomCount,kG);kV.timer=null},25)};bO.limitZoomCount=function(T){var kC=this,kD=kC.minZoom,e=kC.maxZoom,i=this.map.getZoom();T=Math.min(Math.max(T,-3),3);if(i+T>e){T=e-i}else{if(i+T<kD){T=kD-i}}return T};bO.zoomMap=function(kD,kK,kE,kC,i){var kN=this.map;var e=kN.getZoom();var kF=kN.getCenterIn().clone();var kO=this;var T=kO.tileMgr;var kL=e+Math.round(kK);var kI=kN.width;var kG=kN.height;i=i||{};kC=kC||new jo(0,0);if(i.fireEvent!==false&&!kO.isDispatchZoomStart){kO.isDispatchZoomStart=true;kN.dispatchEvent(new fW("onzoomstart"))}if(kN.config.zoomCenter){kD=kN.pointToPixelIn(kN.config.zoomCenter)}var kQ=kN.pixelToPointIn(kD);var kP=kN.getZoomUnits(kL);var kH=new cG(kQ.lng+kP*(kI/2-kD.x+kC.width),kQ.lat-kP*(kG/2-kD.y+kC.height));kH=kN.restrictCenter(kH,kP,kL);var kJ=kN.pointToPixelIn(kQ,{center:kH,zoom:kL});var kM=0;this.zoomAni=this._animationLayer.startAnimation({fixPosition:kD,fixMCPosition:kQ,zoomCount:kK,pixOffset:kC,onAnimationBeforeLooping:function(kT,kV){var kR=kN.getZoomUnits(kV);var kU=new cG(kQ.lng+kR*(kI/2-kD.x+kC.width*kT),kQ.lat-kR*(kG/2-kD.y+kC.height*kT));kU=kN.restrictCenter(kU,kR,kV);var kX=kN.pointToPixelIn(kQ,{center:kU,zoom:kV});var kS=0;if(kN.isRestrict===true){kS=kX.y-kD.y}if(kS!==0&&kM===0){var kW=kN.pointToPixelIn(kQ,{center:kU,zooom:kV});kM=kJ.y-kW.y}return{loopingCenter:kU,yDiff:kS,totalYDiff:kM}},onAnimationLooping:function(kS,kV,kT){if(!kT){var kR=kN.getZoomUnits(kV);kT=new cG(kQ.lng+kR*(kI/2-kD.x+kC.width*kS),kQ.lat-kR*(kG/2-kD.y+kC.height*kS));kT=kN.restrictCenter(kT)}if(kO.enableCanvas2dMap){var kU=new fW("onzooming_inner");kU.zoom=kV;kU.center=kT;kN.dispatchEvent(kU)}},onAnimationFinish:function(){kN.zoomLevel=kL;kN.centerPoint=kH;T.moveGridTiles();kN.dispatchEvent(new fW("onzooming"));if(i.fireEvent!==false){var kR=new fW("onzoomend");kR.notClearLabel=true;kN.dispatchEvent(kR)}kO.zoomCount=0;kO.maxZoomWheelDir=1;kO.minZoomWheelDir=-1;kO.isDispatchZoomStart=false;kO.zoomAni=null;if(i.callback){i.callback()}}})};function jb(e){this._map=e;this._touchZoomLayer=null;this._zoomStartFired=false}e9.extend(jb.prototype,{onReadyToDrag:function(kD,i){if(kD.button===2){return}var kC=this._map;var T=kC.temp;if(T.dragAni){T.dragAni.stop();T.dragAni=null;kC.dispatchEvent(new fW("onmoveend"))}if(!kC.config.enableDragging){return}T.pl=kC.offsetX;T.pt=kC.offsetY;if(T.curSpotsArray.length===0){kC.platform.style.cursor=kC.config.draggingCursor}else{kC.platform.style.cursor="pointer"}},onReadyToPinch:function(kD,T){if(!this._touchZoomLayer){this._touchZoomLayer=eB.get(this._map)}this._touchZoomLayer.hideNonAnimationLayers();var i=T.pinchStartPosition;if(this._map.config.fixCenterWhenPinch){var kC=this._map.getSize();i.x=kC.width/2;i.y=kC.height/2}this._touchZoomLayer.setFixPosition(i);this._touchZoomLayer.prepareLayer();this._touchZoomLayer.prepareAniParam();this._touchZoomLayer.prepareLabelLayer();this._pinchStartPosition=i;this._pinchStartPositionMC=this._map.pixelToPointIn(i)},onDragStart:function(T){if(T.button===2){return}var i=this._map;if(!i.config.enableDragging){return}i.platform.style.cursor=i.config.draggingCursor},onDragging:function(kE,T){var kD=this._map;if(!kD.config.enableDragging){return}if(kE.button===2||T.button===2){return}var kC=kD.temp;var i=40;var kF=kE.timeStamp;var kG=(kF-kC.lastLoadTileTime)>i;if(kG){kC.lastLoadTileTime=kF}kC.lastDomMoveTime=kF;if(Math.abs(T.diffX)>1||Math.abs(T.diffY)>1){if(!kC._moved){kD.dispatchEvent(e9.extend(new fW("ondragstart"),kE));kD.dispatchEvent(new fW("onmovestart"));kC._moved=true}kD.dispatchEvent(e9.extend(new fW("ondragging"),kE));kD._setPlatformPosition(T.diffX,T.diffY,{initMapOffsetX:kC.pl,initMapOffsetY:kC.pt,dispatchEvent:kG})}},onPinching:function(kG,kC){var kD=this._map;var T=this._pinchStartPositionMC;var kJ=this._pinchStartPosition;var kE=Math.log(kC.zoomRatio)/Math.log(2);if(kE!==1&&this._zoomStartFired===false){kD.dispatchEvent(new fW("onzoomstart"));this._zoomStartFired=true}var kI=kD.getZoom()+kE;if(kI>kD.getMaxZoom()){kI=kD.getMaxZoom()}else{if(kI<kD.getMinZoom()){kI=kD.getMinZoom()}}var kL=Math.pow(2,kI-kD.getZoom());var kK=kD.getZoomUnits(kI);var i=new cG(T.lng+kK*(kD.width/2-kJ.x),T.lat-kK*(kD.height/2-kJ.y));i=kD.restrictCenter(i,kK,kI);var kF=kD.pointToPixelIn(T,{center:i,zoom:kI});var kH=kF.y-kJ.y;this._touchZoomLayer.setZoom(kL,kH);var kG=new fW("onzooming_inner");kG.zoom=kI;kG.center=i;kD.dispatchEvent(kG)},onDragEnd:function(kD,i){var kC=this._map;if(!kC.config.enableDragging){return}if(kD.button===2){return}var T=kC.temp;if(T.curSpotsArray.length===0){kC.platform.style.cursor=kC.config.defaultCursor}else{kC.platform.style.cursor="pointer"}if(T._moved){kC.dispatchEvent(e9.extend(new fW("ondragend"),kD));if(!kC.config.enableInertialDragging||kD.timeStamp-T.lastDomMoveTime>100){kC.dispatchEvent(new fW("onmoveend"))}else{this._processMotion(i.velocity,i.dragDistance)}}T._moved=false},onPinchEnd:function(kF,i){var kE=this._map;var kC=Math.round(Math.log(i.zoomRatio)/Math.log(2));var T=Math.max(Math.min(kE.getZoom()+kC,kE.getMaxZoom()),kE.getMinZoom());var kG=kE.pixelToPointIn(this._pinchStartPosition);kE.zoomTo(T,kG,{noAnimation:true,fireEvent:false});kE.dispatchEvent(new fW("onzoomend"));this._zoomStartFired=false;var kD=this;setTimeout(function(){kD._touchZoomLayer.showNonAnimationLayers();kD._touchZoomLayer.setZoomFinish();kD._touchZoomLayer.showLabel()},30)},_processMotion:function(kC,kL){var kI=this._map;var kN=kI.temp;var i=(new Date()).getTime();var e=0.5*kC;var kM=0;var kK=0;if(kL.y===0){kM=e}else{var kG=Math.abs(kL.x/kL.y);kK=Math.round(Math.sqrt(e*e/(1+kG*kG)));kM=Math.round(kG*kK)}var kJ=kL.x+kM;var kH=kL.y+kK;if(kL.x<0){kJ=kL.x-kM}if(kL.y<0){kH=kL.y-kK}if(kN.dragAni){kN.dragAni.stop();kN.dragAni=null;kI.dispatchEvent(new fW("onmoveend"))}var kE=true;var T=kI.config.isModernBrowser?60:30;var kF=0;var kD=0;kN.dragAni=new fL({duration:10000,fps:T,render:function(kQ,kP){var kO=(new Date()).getTime()-i;var kR=Math.exp(-kO/250);kF=kL.x>=0?(kJ-kM*kR):(kJ+kM*kR);kD=kL.y>=0?(kH-kK*kR):(kH+kK*kR);if(kM*kR<10&&kK*kR<10){kN.dragAni.stop();return}kI._setPlatformPosition(Math.round(kF),Math.round(kD),{initMapOffsetX:kN.pl,initMapOffsetY:kN.pt,dispatchEvent:kE})},finish:function(){kN.dragAni=null;kI._setPlatformPosition(Math.round(kF),Math.round(kD),{initMapOffsetX:kN.pl,initMapOffsetY:kN.pt});kI.dispatchEvent(new fW("onmoveend"))},onStop:function(){kN.dragAni=null;kI._setPlatformPosition(Math.round(kF),Math.round(kD),{initMapOffsetX:kN.pl,initMapOffsetY:kN.pt});kI.dispatchEvent(new fW("onmoveend"))}})}});bG.register(function(i){var e=i;if(i._keyboardInit===true){return}i._keyboardInit=true;e9.on(document,"keydown",function(T){if(e.temp.stopArrow===true){e.temp.stopArrow=false}if(e.config.enableKeyboard&&e.temp.canKeyboard){var T=window.event||T;var kC=false;if(e9.Platform.macintosh){if(T.metaKey===true){kC=true}}else{if(T.ctrlKey===true){kC=true}}switch(T.keyCode||T.which){case 189:case 109:case 173:if(!kC){e.temp.operating=true;e.dispatchEvent(new fW("onminuspress"))}break;case 61:case 187:case 107:if(!kC){e.temp.operating=true;e.dispatchEvent(new fW("onpluspress"))}break;case 33:e.temp.operating=false;e.temp.stopArrow=true;T.cancelBubble=true;T.returnValue=false;break;case 34:e.temp.operating=false;e.temp.stopArrow=true;T.cancelBubble=true;T.returnValue=false;break;case 35:e.temp.operating=false;e.temp.stopArrow=true;T.cancelBubble=true;T.returnValue=false;break;case 36:e.temp.operating=false;e.temp.stopArrow=true;T.cancelBubble=true;T.returnValue=false;break;case 37:if(e.mapType==="B_EARTH_MAP"){return}e.temp.operating=true;e.temp.arrow|=1;e._arrow();T.cancelBubble=true;T.returnValue=false;break;case 38:if(e.mapType==="B_EARTH_MAP"){return}e.temp.operating=true;e.temp.arrow|=2;e._arrow();T.cancelBubble=true;T.returnValue=false;break;case 39:if(e.mapType==="B_EARTH_MAP"){return}e.temp.operating=true;e.temp.arrow|=4;e._arrow();T.cancelBubble=true;T.returnValue=false;break;case 40:if(e.mapType==="B_EARTH_MAP"){return}e.temp.operating=true;e.temp.arrow|=8;e._arrow();T.cancelBubble=true;T.returnValue=false;break}}});e9.on(document,"keyup",function(T){if(e.config.enableKeyboard){var T=window.event||T;switch(T.keyCode||T.which){case 37:e.temp.arrow=e.temp.arrow&~1;if(e.temp.arrow!==0){e._arrow()}break;case 38:e.temp.arrow=e.temp.arrow&~2;if(e.temp.arrow!==0){e._arrow()}break;case 39:e.temp.arrow=e.temp.arrow&~4;if(e.temp.arrow!==0){e._arrow()}break;case 40:e.temp.arrow=e.temp.arrow&~8;if(e.temp.arrow!==0){e._arrow()}break}}e.temp.operating=false});h5.prototype._arrow=function(){if(this.mapType===BMAP_EARTH_MAP){return}if(this._arrow.occurrent&&this._arrow._lastArrow===this.temp.arrow&&this.temp.stopArrow===true){return}var T=this;var kD=T.temp.arrow;T._arrow._lastArrow=kD;T._arrow.interval=30;T._arrow.duration=999;T._arrow.dx=T._arrow.dy=0;if(kD&1){T._arrow.dx=1}if(kD&2){T._arrow.dy=1}if(kD&4){T._arrow.dx=-1}if(kD&8){T._arrow.dy=-1}if(kD&1&&kD&4){T._arrow.dx=0}if(kD&2&&kD&8){T._arrow.dy=0}if(!T._arrow.occurrent){T._arrow.occurrent=true;T._arrow.time=new Date().getTime();T._arrow.beginTime=T._arrow.time;T.dispatchEvent(new fW("onmovestart"));var kC=new fL({fps:T._arrow.interval,duration:T._arrow.duration,transition:gS.linear,render:function(kK){var kF=T._arrow;var kI=T.temp.arrow;if(T._arrow._lastArrow!==kI){T._arrow._lastArrow=kI;if(kI&1){kF.dx=1}if(kI&2){kF.dy=1}if(kI&4){kF.dx=-1}if(kI&8){kF.dy=-1}if(kI&1&&kI&4){kF.dx=0}if(kI&2&&kI&8){kF.dy=0}}if(T.temp.stopArrow===true){kF.dx=0;kF.dy=0}var kJ=new Date().getTime();var kH=Math.pow((kJ-kF.beginTime)/kF.duration,2);if(!T.temp.arrow){kF.occurrent=false;kC.terminative=true;T._arrow.time=new Date().getTime();setTimeout(function(){T.dispatchEvent(new fW("onmoveend"))},40)}var kL=(kJ-kF.time);var kG=kF.dx*kL*kH>=0?Math.ceil(kF.dx*kL*kH):Math.floor(kF.dx*kL*kH);var kE=kF.dy*kL*kH>=0?Math.ceil(kF.dy*kL*kH):Math.floor(kF.dy*kL*kH);if(kG!==0&&kE!==0){kG=Math.round(kG*0.7);kE=Math.round(kE*0.7)}kF.time=kJ;T._setPlatformPosition(kG,kE)},finish:function(){T._arrow.time=new Date().getTime();setTimeout(function(){T._arrowPan()},T._arrow.interval)}})}};h5.prototype._arrowPan=function(){var kE=this;var kC=kE._arrow;if(kE.temp.stopArrow){kC.dx=0;kC.dy=0}if(!kE.temp.arrow){kC.occurrent=false;kE.dispatchEvent(new fW("onmoveend"));return}var kF=new Date().getTime();var kG=(kF-kC.time);var kD=Math.ceil(kC.dx*kG);var T=Math.ceil(kC.dy*kG);kC.time=kF;kE._setPlatformPosition(kD,T);setTimeout(function(){kE._arrowPan()},kC.interval)}});jG.prototype.zoom=function(kD,kC){var kF=kC?kC.width:0;var kE=kC?kC.height:0;var kQ=this.map;var kS=kQ.config;var kR=this;var kP={x:kD.x-parseInt(kR.tilesDiv.style.left,10)-kQ.offsetX,y:kD.y-parseInt(kR.tilesDiv.style.top,10)-kQ.offsetY};if(kQ.overlayDiv){kQ.overlayDiv.style.visibility="hidden"}var e;for(var kM=0,kL=kR.tileLayers.length;kM<kL;kM++){e=kR.tileLayers[kM];if(!e.baseLayer){e.tilesDiv.style.visibility="hidden"}}if(!this.zoomsDiv){this.zoomsDiv=this.tilesDiv.cloneNode(true)}else{if(this.zoomsDiv.parentNode&&!this._zTimeLine){this.zoomsDiv.parentNode.removeChild(this.zoomsDiv);this.zoomsDiv=null;this.zoomsDiv=this.tilesDiv.cloneNode(true)}}var T=this.zoomsDiv;var kJ=T.style;kJ.display="block";this.tilesDiv.style.visibility="hidden";kQ.platform.insertBefore(T,kQ.platform.firstChild);var kO=[];var kG=kQ.zoomLevel-kQ.lastLevel;if(!kR._diff){kR._diff=kG}else{if(kQ.zoomLevel-kQ.lastLevel>0){kR._diff++}else{kR._diff--}}if(this._zTimeLine&&this._zTimeLine.schedule===0){this._zTimeLine.stop();this._zTimeLine=null;kG=kR._diff}var kI=Math.pow(2,kG);var kN=T.children.length;for(var kM=kN-1;kM>-1;kM--){var kH={};var kK=T.children[kM].style;kH.top=parseInt(kK.top,10)||0;kH.left=parseInt(kK.left,10)||0;kH.width=parseInt(kK.width,10);kH.height=parseInt(kK.height,10);kH.dw=kH.width*kI-kH.width;kH.dh=kH.height*kI-kH.height;kH.dx=(kH.left-kP.x)*kI-(kH.left-kP.x);kH.dy=(kH.top-kP.y)*kI-(kH.top-kP.y);kO[kM]=kH}T._ol=parseInt(T.style.left,10);T._ot=parseInt(T.style.top,10);if(this._zTimeLine){this._zTimeLine.stop();this._zTimeLine=null}this._zTimeLine=new fL({fps:20,duration:kS.enableContinuousZoom?kS.zoomerDuration:1,transition:gS.easeInQuad,render:function(kV){if(kV<0.1){return}for(var kU=kO.length-1;kU>-1;kU--){var kW=kO[kU];if(T.children[kU]){var kT=T.children[kU].style;kT.top=Math.round(kW.top+kW.dy*kV)+"px";kT.left=Math.round(kW.left+kW.dx*kV)+"px";kT.width=Math.ceil(kW.width+kW.dw*kV)+"px";kT.height=Math.ceil(kW.height+kW.dh*kV)+"px"}}if(kF||kE){kJ.left=T._ol-(kF*kV)+"px";kJ.top=T._ot-(kE*kV)+"px"}},finish:function(){if(kQ.getZoom()===3&&kQ.getMapType()==="B_NORMAL_MAP"){kQ.centerPoint.lat=0}kR.moveGridTiles(true);if(kQ.overlayDiv){setTimeout(function(){kQ.overlayDiv.style.visibility="visible"},10)}for(var kU=0,kT=kR.tileLayers.length;kU<kT;kU++){e=kR.tileLayers[kU];if(!e.baseLayer){e.tilesDiv.style.visibility=""}}kR.tilesDiv.style.visibility="";delete kR._diff;kQ.dispatchEvent(new fW("onzoomend"));T=null;kR._zTimeLine=null}})};');
